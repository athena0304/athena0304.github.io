<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.4.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Athena">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Athena">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Athena">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Athena</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?15fcb8c2aa27ecb358060d2600aa2502";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Athena</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">é›¯å­å†™å­—çš„åœ°æ–¹</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />é¦–é¡µ</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />å…³äº</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />æ ‡ç­¾</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />å½’æ¡£</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    
  
  
  
    
      
    
    <a href="https://github.com/athena0304" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#222; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
    
      </a>
    



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/19/æ—¥æœ¬ä¹‹æµ·æ¸¸é¦†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›¯å­">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Athena">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/19/æ—¥æœ¬ä¹‹æµ·æ¸¸é¦†/" itemprop="url">
                  æ—¥æœ¬ä¹‹æµ·æ¸¸é¦†
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-19 16:13:52 / ä¿®æ”¹æ—¶é—´ï¼š16:19:58" itemprop="dateCreated datePublished" datetime="2018-11-19T16:13:52+08:00">2018-11-19</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å‰å‰ååå»äº†äº”æ¬¡æ—¥æœ¬äº†ï¼Œæ€»è§‰å¾—è¯¥æ‹ä¸€æ‹ã€‚ç„¶è€Œè¯´åƒçš„å§ï¼Œæ„Ÿè§‰å¤ªå¤šäº†ï¼Œä¸å¥½æ•´ç†ï¼Œå°±å…ˆä»æµ·æ¸¸é¦†ä¸‹æ‰‹å§ã€‚</p>
<p>é›¯å­å‰åå»äº†æ—¥æœ¬çš„ä¸‰ä¸ªæµ·æ¸¸é¦†ï¼Œåˆ†åˆ«æ˜¯å¤§é˜ªæµ·æ¸¸é¦†ã€ç¦å†ˆæµ·æ´‹ä¸–ç•Œæµ·ä¹‹ä¸­é“ã€é¹¿å„¿å²›æµ·æ¸¸é¦†ã€‚æ¯ä¸ªæµ·æ¸¸é¦†éƒ½å¾ˆæœ‰ç‰¹è‰²ï¼Œä½“éªŒç»å¯¹æ˜¯æˆ‘åœ¨å›½å†…æ²¡ä½“éªŒè¿‡çš„ã€‚</p>
<p>å›½å†…è¿‘ä¸¤å¹´æˆ‘å»è¿‡å¤§è¿å’Œé’å²›çš„ä¸¤ä¸ªæµ·æ´‹é¦†ï¼Œçœ‹è¿‡ä¹‹åé™¤äº†å¯¹ä¼é¹…å°è±¡å¾ˆæ·±ä»¥å¤–ï¼Œåˆ«çš„éƒ½è®°ä¸å¾—äº†ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/16/vue-markdown-loaderæºç è§£æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›¯å­">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Athena">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/16/vue-markdown-loaderæºç è§£æ/" itemprop="url">
                  vue-markdown-loaderæºç è§£æ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-16 11:48:15" itemprop="dateCreated datePublished" datetime="2018-11-16T11:48:15+08:00">2018-11-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2018-11-28 12:18:34" itemprop="dateModified" datetime="2018-11-28T12:18:34+08:00">2018-11-28</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>é¡¹ç›®ä¸­é‡åˆ°äº†éœ€è¦å•ç‹¬åŠ è½½æŸä¸ª markdown æ–‡ä»¶æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ï¼Œç±»ä¼¼äºæ“ä½œæŒ‡å¼•çš„æ„Ÿè§‰ï¼Œäºæ˜¯æ‰¾åˆ°äº† vue-markdown-loader è¿™ä¸ªå·¥å…·ï¼Œè§‰å¾—å¾ˆå¥½ç”¨ï¼Œäºæ˜¯æˆ‘æ‰“ç®—å¼€ä¸ªä¸“é¢˜çœ‹ä¸€ä¸‹é‡Œé¢éƒ½åšäº†äº›ä»€ä¹ˆï¼Œæœ‰åŠ©äºå¯¹ webpack loader çš„ç†è§£ã€‚</p>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>è¿™é‡Œéœ€è¦å…ˆäº†è§£ webpack loader çš„åŸç†ï¼Œåé¢çš„ä»£ç éœ€è¦é…åˆ webpack çš„<a href="https://webpack.js.org/api/loaders/" target="_blank" rel="noopener">å®˜ç½‘</a>å¯¹ç…§ç€æ¥çœ‹ã€‚ä¸­æ–‡ç‰ˆåœ¨<a href="https://webpack.docschina.org/concepts/loaders" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ loader æ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆ loader å…¶å®å°±æ˜¯ä¸€ä¸ª JavaScript moduleï¼Œå¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚<a href="https://github.com/webpack/loader-runner" target="_blank" rel="noopener">loader runner</a> ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°†å‰ä¸€ä¸ª loader æ‰§è¡Œçš„ç»“æœæˆ–è€…æºæ–‡ä»¶ä½œä¸ºå‚æ•°ä¼ é€’è¿›æ¥ã€‚å‡½æ•°ä¸­çš„ this ä¸Šä¸‹æ–‡ç”± webpack å¡«å……ï¼Œloader runner æœ‰ä¸€äº›å®ç”¨çš„æ–¹æ³•å¯ä»¥å…è®¸ loader æ”¹å˜å…¶è§¦å‘æ–¹å¼ä¸ºå¼‚æ­¥ï¼Œæˆ–è€…è·å– query å‚æ•°ã€‚</p>
<p>åœ¨è¿™é‡Œæ‘˜å½•ä¸€ä¸‹ loader çš„ç‰¹æ€§ï¼š</p>
<ul>
<li>loader æ”¯æŒé“¾å¼ä¼ é€’ã€‚loader é“¾ä¸­æ¯ä¸ª loaderï¼Œéƒ½å¯¹å‰ä¸€ä¸ª loader å¤„ç†åçš„èµ„æºè¿›è¡Œè½¬æ¢ã€‚loader é“¾ä¼šæŒ‰ç…§ç›¸åçš„é¡ºåºæ‰§è¡Œã€‚ç¬¬ä¸€ä¸ª loader å°†ï¼ˆåº”ç”¨è½¬æ¢åçš„èµ„æºä½œä¸ºï¼‰è¿”å›ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ª loaderï¼Œä¾æ¬¡è¿™æ ·æ‰§è¡Œä¸‹å»ã€‚æœ€ç»ˆï¼Œåœ¨é“¾ä¸­æœ€åä¸€ä¸ª loaderï¼Œè¿”å› webpack æ‰€é¢„æœŸçš„ JavaScriptã€‚</li>
<li>loader å¯ä»¥æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥çš„ã€‚</li>
<li>loader è¿è¡Œåœ¨ Node.js ä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ‰§è¡Œä»»ä½•å¯èƒ½çš„æ“ä½œã€‚</li>
<li>loader æ¥æ”¶æŸ¥è¯¢å‚æ•°ã€‚ç”¨äºå¯¹ loader ä¼ é€’é…ç½®ã€‚</li>
<li>loader ä¹Ÿèƒ½å¤Ÿä½¿ç”¨ <code>options</code> å¯¹è±¡è¿›è¡Œé…ç½®ã€‚</li>
<li>é™¤äº†ä½¿ç”¨ <code>package.json</code> å¸¸è§çš„ <code>main</code> å±æ€§ï¼Œè¿˜å¯ä»¥å°†æ™®é€šçš„ npm æ¨¡å—å¯¼å‡ºä¸º loaderï¼Œåšæ³•æ˜¯åœ¨ <code>package.json</code> é‡Œå®šä¹‰ä¸€ä¸ª <code>loader</code> å­—æ®µã€‚</li>
<li>æ’ä»¶(plugin)å¯ä»¥ä¸º loader å¸¦æ¥æ›´å¤šç‰¹æ€§ã€‚</li>
<li>loader èƒ½å¤Ÿäº§ç”Ÿé¢å¤–çš„ä»»æ„æ–‡ä»¶ã€‚</li>
</ul>
<p>äº†è§£åŸç†ä¹‹åï¼Œæˆ‘ä»¬è¿˜è¦å†çœ‹ä¸€ç¯‡æ–‡æ¡£ï¼Œ<a href="https://webpack.docschina.org/contribute/writing-a-loader/" target="_blank" rel="noopener">å¦‚ä½•ç¼–å†™ä¸€ä¸ªloader</a>ã€‚</p>
<h3 id="è°ƒè¯•å·¥å…·"><a href="#è°ƒè¯•å·¥å…·" class="headerlink" title="è°ƒè¯•å·¥å…·"></a>è°ƒè¯•å·¥å…·</h3><p>å¦‚æœä½ æƒ³æ›´æ–¹ä¾¿çš„è°ƒè¯•ä»£ç ï¼Œéœ€è¦é…ç½®ä¸€ä¸‹è°ƒè¯•ç¯å¢ƒï¼Œè¿™é‡Œæˆ‘ç”¨çš„ VSCode è‡ªå¸¦çš„è°ƒè¯•å·¥å…·ï¼ˆæˆ‘æ‰¾äº†ä¸€åœˆç°é˜¶æ®µè§‰å¾—è¿™ç§æ–¹å¼æœ€é è°±ï¼‰</p>
<p>åœ¨ debug æ¨¡å¼ä¸‹ç‚¹å‡»é…ç½®æŒ‰é’®ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ª <code>.vscode/launch.json</code> çš„æ–‡ä»¶ï¼Œé‡Œé¢çš„é…ç½®æ”¹æˆå¦‚ä¸‹å³å¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"node"</span>,</span><br><span class="line">      <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"å¯åŠ¨ç¨‹åº"</span>,</span><br><span class="line">      <span class="attr">"program"</span>: <span class="string">"$&#123;workspaceFolder&#125;/node_modules/webpack/bin/webpack.js"</span>,</span><br><span class="line">      <span class="attr">"cwd"</span>: <span class="string">"$&#123;workspaceFolder&#125;/example"</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ program è®¾ç½®æˆ webpack æœ¬èº«çš„æ–‡ä»¶æ‰§è¡Œçš„ä½ç½®ï¼Œcwd è®¾ç½®æˆæ‰§è¡Œ webpack æ‰€åœ¨çš„æ ¹ç›®å½•ã€‚ç‚¹å‡»å¯åŠ¨ç¨‹åºæŒ‰é’®å°±å¯ä»¥æ–­ç‚¹è°ƒè¯•äº†ï¼Œæƒ³çœ‹å•¥çœ‹å•¥ã€‚</p>
<p>ä¸‹é¢å°±å¯ä»¥å¼€å§‹çœ‹æºç äº†ã€‚</p>
<h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>é¦–å…ˆçœ‹ä¸‹ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ example</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ index.html</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ src</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ app.vue</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ custom.css</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ entry.js</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ markdown.md</span><br><span class="line">â”‚Â Â  â””â”€â”€ webpack.config.js</span><br><span class="line">â”œâ”€â”€ index.js</span><br><span class="line">â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ core.js</span><br><span class="line">â”‚Â Â  â””â”€â”€ markdown-compiler.js</span><br><span class="line">â”œâ”€â”€ package-lock.json</span><br><span class="line">â””â”€â”€ package.json</span><br></pre></td></tr></table></figure>
<p>ç»“æ„å¾ˆæ¸…æ™°ï¼Œä¸œè¥¿ä¹Ÿä¸ç®—å¤ªå¤šï¼Œæ¶‰åŠåˆ°çš„æºç å°±æ˜¯ <code>index.js</code>å’Œ <code>lib</code> ä¸‹çš„ä¸¤ä¸ª js æ–‡ä»¶ï¼Œ<code>example</code> é‡Œé¢çš„æ˜¯ç¤ºä¾‹ã€‚</p>
<p>é‚£æˆ‘ä»¬å°±å…ˆä» <code>index.js</code> å¼€å§‹çœ‹èµ·å§ã€‚</p>
<p>å°±ä¸€å¥è¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">'./lib/core'</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–‡ä»¶æ˜¯ä½ å¼•å…¥è¿™ä¸ªåŒ…çš„å…¥å£ï¼Œè¿™é‡Œç›´æ¥å»æ‰¾çš„ <code>./lib/core</code>ï¼Œäºæ˜¯æˆ‘ä»¬ç»§ç»­å» <code>./lib/core</code> çœ‹çœ‹ã€‚</p>
<h3 id="core-js"><a href="#core-js" class="headerlink" title="core.js"></a>core.js</h3><p>åœ¨å£°æ˜é˜¶æ®µï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> markdownCompilerPath = path.resolve(__dirname, <span class="string">'markdown-compiler.js'</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¼•ç”¨äº† <a href="https://www.npmjs.com/package/loader-utils" target="_blank" rel="noopener">loader-utils</a> å’ŒåŒçº§ç›®å½•ä¸‹çš„ <code>markdown-compiler.js</code></p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬é€è¡Œè§£æ <code>core.js</code> é‡Œé¢çš„ä»£ç ï¼Œé‡åˆ°ä»€ä¹ˆå°±å»æŸ¥ä»€ä¹ˆã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ï¼ˆ1ï¼‰æ˜¯å¦å¯ç¼“å­˜</span></span><br><span class="line">  <span class="keyword">this</span>.cacheable(); </span><br><span class="line">  <span class="comment">// ï¼ˆ2ï¼‰è·å– options </span></span><br><span class="line">  <span class="keyword">var</span> options = loaderUtils.getOptions(<span class="keyword">this</span>) || &#123;&#125;; </span><br><span class="line">  <span class="comment">// ï¼ˆ3ï¼‰ä¸º Compilation å¯¹è±¡æ·»åŠ  __vueMarkdownOptions__ å±æ€§</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>._compilation, <span class="string">'__vueMarkdownOptions__'</span>, &#123;</span><br><span class="line">    value: options,</span><br><span class="line">    enumerable: <span class="literal">false</span>,</span><br><span class="line">    configurable: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// (4) è·å–èµ„æºæ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">  <span class="keyword">var</span> filePath = <span class="keyword">this</span>.resourcePath;</span><br><span class="line">  <span class="comment">// (5) ç”Ÿæˆ result</span></span><br><span class="line">  <span class="keyword">var</span> result =</span><br><span class="line">    <span class="string">'module.exports = require('</span> +</span><br><span class="line">    loaderUtils.stringifyRequest(</span><br><span class="line">      <span class="keyword">this</span>,</span><br><span class="line">      <span class="string">'!!vue-loader!'</span> +</span><br><span class="line">        markdownCompilerPath +</span><br><span class="line">        <span class="string">'?raw!'</span> +</span><br><span class="line">        filePath +</span><br><span class="line">        (<span class="keyword">this</span>.resourceQuery || <span class="string">''</span>)</span><br><span class="line">    ) +</span><br><span class="line">    <span class="string">');'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(result)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶æœ€åæ˜¯å¯¼å‡ºäº†ä¸€ä¸ª resultï¼Œå‚æ•°ä¼ è¿›æ¥çš„æ˜¯ sourceï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰ loader äº§ç”Ÿè¿‡çš„ç»“æœæˆ–è€…æ˜¯æºæ–‡ä»¶ï¼Œæœ‰ä¸ªä¸Šä¸‹æ–‡ thisã€‚</p>
<p><strong>ï¼ˆ1ï¼‰æ˜¯å¦å¯ç¼“å­˜</strong></p>
<p><code>this.cacheable();</code> å¯¹åº”çš„æ˜¯<a href="https://webpack.docschina.org/api/loaders/#this-cacheable" target="_blank" rel="noopener">æ˜¯å¦å¯ç¼“å­˜</a>ã€‚</p>
<blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œloader çš„å¤„ç†ç»“æœä¼šè¢«æ ‡è®°ä¸ºå¯ç¼“å­˜ã€‚è°ƒç”¨è¿™ä¸ªæ–¹æ³•ç„¶åä¼ å…¥ <code>false</code>ï¼Œå¯ä»¥å…³é—­ loader çš„ç¼“å­˜ã€‚</p>
<p>ä¸€ä¸ªå¯ç¼“å­˜çš„ loader åœ¨è¾“å…¥å’Œç›¸å…³ä¾èµ–æ²¡æœ‰å˜åŒ–æ—¶ï¼Œå¿…é¡»è¿”å›ç›¸åŒçš„ç»“æœã€‚è¿™æ„å‘³ç€ loader é™¤äº† <code>this.addDependency</code> é‡ŒæŒ‡å®šçš„ä»¥å¤–ï¼Œä¸åº”è¯¥æœ‰å…¶å®ƒä»»ä½•å¤–éƒ¨ä¾èµ–ã€‚</p>
</blockquote>
<p><strong>ï¼ˆ2ï¼‰è·å– options</strong> </p>
<p>å‚è€ƒ loader-utils çš„<a href="https://www.npmjs.com/package/loader-utils#getoptions" target="_blank" rel="noopener">æ–‡æ¡£</a></p>
<p>æ˜¯æ£€ç´¢è°ƒç”¨ loader çš„ options çš„æ¨èæ–¹å¼ã€‚</p>
<p>æœ¬æ–‡ä¸­ä¸º<code>{}</code></p>
<p><strong>ï¼ˆ3ï¼‰ä¸º Compilation å¯¹è±¡æ·»åŠ <code>__vueMarkdownOptions__</code> å±æ€§</strong></p>
<p><strong>ï¼ˆ4ï¼‰è·å–èµ„æºæ–‡ä»¶çš„è·¯å¾„</strong></p>
<p>è·å–åˆ°çš„è·¯å¾„æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;vue-markdown-loader/example/src/markdown.md&quot;</span><br></pre></td></tr></table></figure>
<p><strong>ï¼ˆ5ï¼‰ç”Ÿæˆ result</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;module.exports = require(&quot;!!vue-loader!../../lib/markdown-compiler.js?raw!./markdown.md&quot;);&quot;</span><br></pre></td></tr></table></figure>
<p><strong>å‚æ•° source</strong></p>
<p>è¿™é‡Œä¼ è¿›æ¥çš„ source å°±æ˜¯åŸå§‹æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;# Hello`&lt;span&gt;&#123;&#123;sss&#125;&#125;&lt;/span&gt;`&gt; This is test.- How are you?- Fine, Thank you, and you?- I&apos;m fineï¼Œ too. Thank you.- ğŸŒš```javascriptimport Vue from &apos;vue&apos;Vue.config.debug = true```&lt;div class=&quot;test&quot;&gt;  &#123;&#123; model &#125;&#125; test&lt;/div&gt;&lt;compo&gt;&#123;&#123; model &#125;&#125;&lt;/compo&gt;&lt;div  class=&quot;abc&quot;  @click=&quot;show = false&quot;&gt;  å•Šå“ˆå“ˆå“ˆ&lt;/div&gt;&gt; All script or style tags in html mark will be extracted.Script will be excuted, and style will be added to document head.&gt; Notice if there is a string instance which contains special word &quot;&amp;lt;/script&gt;&quot;, it will fetch a SyntaxError.&gt; Due to the complexity to solve it, just don&apos;t do that.```html&lt;style scoped&gt;  .test &#123;    background-color: green;  &#125;&lt;/style&gt;&lt;style scoped&gt;  .abc &#123;    background-color: yellow;  &#125;&lt;/style&gt;&lt;script&gt;  let a=1&lt;2;  let b=&quot;&lt;-forget it-/script&gt;&quot;;  console.log(&quot;***This script tag is successfully extracted and excuted.***&quot;)  module.exports = &#123;    components: &#123;      compo: &#123;        render(h) &#123;          return h(&apos;div&apos;, &#123;            style: &#123;              background: &apos;red&apos;            &#125;          &#125;, this.$slots.default);        &#125;      &#125;    &#125;,    data () &#123;      return &#123;        model: &apos;abc&apos;      &#125;    &#125;  &#125;&lt;/script&gt;jjjjjjjjjjjjjjjjjjjjjj&lt;template&gt;  &lt;div&gt;&lt;/div&gt;&lt;/template&gt;```&lt;div&gt;&lt;/div&gt;sadfsfså¤§å®¶å“¦å“¦å¥½å•Šè°éƒ½å‘ç”Ÿåœ°æ–¹ä¸Šçš„å†¯ç»å³°s&gt; sahhhh&lt;compo&gt;&#123;&#123; model &#125;&#125;&lt;/compo&gt;```html&lt;compo&gt;&#123;&#123;model &#125;&#125;&#123;&#123;model &#125;&#125;&#123;&#123;model &#125;&#125;&#123;&#123;model &#125;&#125;&#123;&#123; model &#125;&#125;&lt;/compo&gt;```&lt;style src=&quot;./custom.css&quot;&gt;&lt;/style&gt;## å¼•å…¥ style æ–‡ä»¶&lt;div class=&quot;custom&quot;&gt;  åŸè°…è‰²&lt;/div&gt;&quot;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ require é‡Œçš„å‚æ•°ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œè¿™ä¸ª vue-markdown-loader loader é¦–å…ˆä¼šåŠ è½½ <code>.md</code> æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ <code>markdown-compiler.js?raw</code> æ¥å¤„ç†è¯¥æ–‡ä»¶ï¼Œå†é€šè¿‡ <code>vue-loader</code> å¤„ç†ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»§ç»­å» <code>markdown-compiler.js</code> é‡Œä¸€æ¢ç©¶ç«Ÿã€‚</p>
<h3 id="markdown-compiler-js"><a href="#markdown-compiler-js" class="headerlink" title="markdown-compiler.js"></a>markdown-compiler.js</h3><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹å¼•å…¥å£°æ˜éƒ¨åˆ†ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"><span class="keyword">var</span> hljs = <span class="built_in">require</span>(<span class="string">'highlight.js'</span>);</span><br><span class="line"><span class="keyword">var</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>);</span><br><span class="line"><span class="keyword">var</span> markdown = <span class="built_in">require</span>(<span class="string">'markdown-it'</span>);</span><br><span class="line"><span class="keyword">var</span> Token = <span class="built_in">require</span>(<span class="string">'markdown-it/lib/token'</span>);</span><br></pre></td></tr></table></figure>
<p>å†çœ‹ä¸‹é¢çš„ä»£ç ä¹‹å‰ï¼Œæœ‰å¿…è¦äº†è§£ä¸€ä¸‹ä¸Šé¢å¼•å…¥çš„ä¸œè¥¿</p>
<h4 id="markdown-it"><a href="#markdown-it" class="headerlink" title="markdown-it"></a><a href="https://www.npmjs.com/package/markdown-it" target="_blank" rel="noopener">markdown-it</a></h4><p>å°† markdown è½¬æ¢æˆ html çš„æœ¬å°Šã€‚</p>
<p>æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼šrenderå‡½æ•°å’Œä¼ é€’ options</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node.js, "classic" way:</span></span><br><span class="line"><span class="keyword">var</span> MarkdownIt = <span class="built_in">require</span>(<span class="string">'markdown-it'</span>),</span><br><span class="line">    md = <span class="keyword">new</span> MarkdownIt();</span><br><span class="line"><span class="keyword">var</span> result = md.render(<span class="string">'# markdown-it rulezz!'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// node.js, the same, but with sugar:</span></span><br><span class="line"><span class="keyword">var</span> md = <span class="built_in">require</span>(<span class="string">'markdown-it'</span>)();</span><br><span class="line"><span class="keyword">var</span> result = md.render(<span class="string">'# markdown-it rulezz!'</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// full options list (defaults)</span></span><br><span class="line"><span class="keyword">var</span> md = <span class="built_in">require</span>(<span class="string">'markdown-it'</span>)(&#123;</span><br><span class="line">  html:         <span class="literal">false</span>,        <span class="comment">// Enable HTML tags in source</span></span><br><span class="line">  xhtmlOut:     <span class="literal">false</span>,        <span class="comment">// Use '/' to close single tags (&lt;br /&gt;).</span></span><br><span class="line">                              <span class="comment">// This is only for full CommonMark compatibility.</span></span><br><span class="line">  breaks:       <span class="literal">false</span>,        <span class="comment">// Convert '\n' in paragraphs into &lt;br&gt;</span></span><br><span class="line">  langPrefix:   <span class="string">'language-'</span>,  <span class="comment">// CSS language prefix for fenced blocks. Can be</span></span><br><span class="line">                              <span class="comment">// useful for external highlighters.</span></span><br><span class="line">  linkify:      <span class="literal">false</span>,        <span class="comment">// Autoconvert URL-like text to links</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Enable some language-neutral replacement + quotes beautification</span></span><br><span class="line">  typographer:  <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Double + single quotes replacement pairs, when typographer enabled,</span></span><br><span class="line">  <span class="comment">// and smartquotes on. Could be either a String or an Array.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// For example, you can use 'Â«Â»â€â€œ' for Russian, 'â€â€œâ€šâ€˜' for German,</span></span><br><span class="line">  <span class="comment">// and ['Â«\xA0', '\xA0Â»', 'â€¹\xA0', '\xA0â€º'] for French (including nbsp).</span></span><br><span class="line">  quotes: <span class="string">'â€œâ€â€˜â€™'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Highlighter function. Should return escaped HTML,</span></span><br><span class="line">  <span class="comment">// or '' if the source string is not changed and should be escaped externaly.</span></span><br><span class="line">  <span class="comment">// If result starts with &lt;pre... internal wrapper is skipped.</span></span><br><span class="line">  highlight: <span class="function"><span class="keyword">function</span> (<span class="params"><span class="regexp">/*str, lang*/</span></span>) </span>&#123; <span class="keyword">return</span> <span class="string">''</span>; &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="highlight-js"><a href="#highlight-js" class="headerlink" title="highlight.js"></a><a href="https://highlightjs.org/" target="_blank" rel="noopener">highlight.js</a></h4><p>è¯­æ³•é«˜äº®å·¥å…·</p>
<h4 id="cheerio"><a href="#cheerio" class="headerlink" title="cheerio"></a><a href="https://www.npmjs.com/package/cheerio" target="_blank" rel="noopener">cheerio</a></h4><p>Fast, flexible &amp; lean implementation of core jQuery designed specifically for the server.</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆçœ‹å‡ ä¸ªå£°æ˜çš„å‡½æ•°ï¼š</p>
<h4 id="addVuePreviewAttr"><a href="#addVuePreviewAttr" class="headerlink" title="addVuePreviewAttr"></a>addVuePreviewAttr</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * `&lt;pre&gt;&lt;/pre&gt;` =&gt; `&lt;pre v-pre&gt;&lt;/pre&gt;`</span></span><br><span class="line"><span class="comment"> * `&lt;code&gt;&lt;/code&gt;` =&gt; `&lt;code v-pre&gt;&lt;/code&gt;`</span></span><br><span class="line"><span class="comment"> * @param  &#123;string&#125; str</span></span><br><span class="line"><span class="comment"> * @return &#123;string&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> addVuePreviewAttr = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/(&lt;pre|&lt;code)/g</span>, <span class="string">'$1 v-pre'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°å°±æ˜¯æŸ¥æ‰¾ html æ ‡ç­¾ä¸­æ‰€æœ‰ <code>&lt;pre</code> æˆ–è€… <code>&lt;code</code>ï¼Œæ›¿æ¢æˆ  <code>&lt;pre v-pre</code> å’Œ <code>&lt;code v-pre</code></p>
<h4 id="renderHighlight"><a href="#renderHighlight" class="headerlink" title="renderHighlight"></a>renderHighlight</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * renderHighlight</span></span><br><span class="line"><span class="comment"> * @param  &#123;string&#125; str</span></span><br><span class="line"><span class="comment"> * @param  &#123;string&#125; lang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> renderHighlight = <span class="function"><span class="keyword">function</span>(<span class="params">str, lang</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(lang &amp;&amp; hljs.getLanguage(lang))) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> hljs.highlight(lang, str, <span class="literal">true</span>).value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿”å›é€šè¿‡ highlight.js é«˜äº®åçš„æ•°æ®</p>
<h4 id="renderVueTemplate"><a href="#renderVueTemplate" class="headerlink" title="renderVueTemplate"></a>renderVueTemplate</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * html =&gt; vue file template</span></span><br><span class="line"><span class="comment"> * @param  &#123;[type]&#125; html [description]</span></span><br><span class="line"><span class="comment"> * @return &#123;[type]&#125;      [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> renderVueTemplate = <span class="function"><span class="keyword">function</span>(<span class="params">html, wrapper</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç”¨ cheerio æå–å‚æ•°ä¼ è¿›æ¥çš„è¦è¿›è¡Œå¤„ç†çš„ html</span></span><br><span class="line">  <span class="keyword">var</span> $ = cheerio.load(html, &#123;</span><br><span class="line">    decodeEntities: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦è§£ç æ–‡æ¡£å®ä½“ï¼Œé»˜è®¤ä¸º false</span></span><br><span class="line">    lowerCaseAttributeNames: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦å°†æ‰€æœ‰å±æ€§åè®¾ç½®æˆå°å†™ï¼Œä¼šå¯¹é€Ÿåº¦æœ‰å½±å“ï¼Œé»˜è®¤ä¸º false</span></span><br><span class="line">    lowerCaseTags: <span class="literal">false</span> <span class="comment">// æ˜¯å¦å°†æ‰€æœ‰æ ‡ç­¾è½¬æ¢æˆå°å†™</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// å°†åŸ html ä¸­çš„ style å’Œç¬¬ä¸€ä¸ª script æ ‡ç­¾ç¼“å­˜èµ·æ¥</span></span><br><span class="line">  <span class="keyword">var</span> output = &#123;</span><br><span class="line">    style: $.html(<span class="string">'style'</span>),</span><br><span class="line">    <span class="comment">// get only the first script child. Causes issues if multiple script files in page.</span></span><br><span class="line">    script: $.html($(<span class="string">'script'</span>).first())</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">  $(<span class="string">'style'</span>).remove();</span><br><span class="line">  $(<span class="string">'script'</span>).remove();</span><br><span class="line">  <span class="comment">// ç”Ÿæˆæœ€åçš„ç»“æœ</span></span><br><span class="line">  result =</span><br><span class="line">    <span class="string">`&lt;template&gt;&lt;<span class="subst">$&#123;wrapper&#125;</span>&gt;`</span> +</span><br><span class="line">    $.html() +</span><br><span class="line">    <span class="string">`&lt;/<span class="subst">$&#123;wrapper&#125;</span>&gt;&lt;/template&gt;\n`</span> +</span><br><span class="line">    output.style +</span><br><span class="line">    <span class="string">'\n'</span> +</span><br><span class="line">    output.script;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯æ•´ä¸ª loader çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯æŠŠ html åŒ…è£¹ä¸€å±‚ vue çš„è¯­æ³•å˜æˆä¸€ä¸ª vue çš„ç»„ä»¶ï¼Œç„¶åå†è®©åé¢çš„ vue-loader æ¥æ”¶ã€‚è¿™é‡Œç”¨åˆ°äº† cheerio æ¥åšä¸€äº›ç®€å•çš„ DOM æ“ä½œã€‚</p>
<p>è¯´å®Œäº†å‡½æ•°å£°æ˜ï¼Œå°±ç»§ç»­æ¥çœ‹æ•´ä¸ªå¤„ç†è¿‡ç¨‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// (1) æ˜¯å¦å¯ç¼“å­˜</span></span><br><span class="line">  <span class="keyword">this</span>.cacheable &amp;&amp; <span class="keyword">this</span>.cacheable();</span><br><span class="line">  <span class="keyword">var</span> parser, preprocess;</span><br><span class="line">  <span class="comment">// ï¼ˆ2ï¼‰è·å–å‚æ•°ï¼Œæ­¤æ—¶æŠŠå¤–é¢ä¼ è¿›æ¥çš„è§£ææˆ Object &#123;raw: true&#125;(æ¥è‡ªcore.js)</span></span><br><span class="line">  <span class="keyword">var</span> params = loaderUtils.getOptions(<span class="keyword">this</span>) || &#123;&#125;;</span><br><span class="line">  <span class="comment">// ï¼ˆ3ï¼‰è·å– __vueMarkdownOptions__(æ¥è‡ªcore.js)</span></span><br><span class="line">  <span class="keyword">var</span> vueMarkdownOptions = <span class="keyword">this</span>._compilation.__vueMarkdownOptions__;</span><br><span class="line">  <span class="comment">// ï¼ˆ4ï¼‰ç»§æ‰¿ vueMarkdownOptions çš„åŸå‹ï¼Œèµ‹å€¼ç»™opts</span></span><br><span class="line">  <span class="keyword">var</span> opts = vueMarkdownOptions ? <span class="built_in">Object</span>.create(vueMarkdownOptions.__proto__) : &#123;&#125;; <span class="comment">// inherit prototype</span></span><br><span class="line">  <span class="keyword">var</span> preventExtract = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// ï¼ˆ5ï¼‰åˆå¹¶æ‰€æœ‰æ¥æºçš„å‚æ•°ã€å±æ€§ï¼Œæ±‡æ€»ç»™opts</span></span><br><span class="line">  opts = <span class="built_in">Object</span>.assign(opts, params, vueMarkdownOptions); <span class="comment">// assign attributes</span></span><br><span class="line">  <span class="comment">// ï¼ˆ6ï¼‰åˆ¤æ–­ options ä¸­ preventExtract æ˜¯éƒ½ä¸º true</span></span><br><span class="line">  <span class="keyword">if</span> (opts.preventExtract) &#123;</span><br><span class="line">    <span class="keyword">delete</span> opts.preventExtract;</span><br><span class="line">    preventExtract = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ï¼ˆ7ï¼‰åˆ¤æ–­ options ä¸­ render çš„ç±»å‹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> opts.render === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="comment">// ï¼ˆ8ï¼‰å¦‚æœæ˜¯ functionï¼Œparser å°±æ˜¯ opts</span></span><br><span class="line">    parser = opts;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ï¼ˆ9ï¼‰å¦‚æœä¸æ˜¯ functionï¼Œä¸º opts æ·»åŠ ä¸€äº›å±æ€§ï¼Œä»¥åŠåé¢çš„ä¸€ç³»åˆ—æ“ä½œã€‚opts æœ€åæ˜¯ä½œä¸º option ä¼ å…¥ markdown-it ä¸­çš„ã€‚</span></span><br><span class="line">    opts = <span class="built_in">Object</span>.assign(</span><br><span class="line">      &#123;</span><br><span class="line">        preset: <span class="string">'default'</span>,</span><br><span class="line">        html: <span class="literal">true</span>,</span><br><span class="line">        highlight: renderHighlight,</span><br><span class="line">        wrapper: <span class="string">'section'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      opts</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// ï¼ˆ10ï¼‰åˆå§‹åŒ– æ’ä»¶ plugins</span></span><br><span class="line">    <span class="keyword">var</span> plugins = opts.use;</span><br><span class="line">    <span class="comment">// ï¼ˆ11ï¼‰åˆå§‹åŒ– é¢„å¤„ç† preprocess</span></span><br><span class="line">    preprocess = opts.preprocess;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> opts.use;</span><br><span class="line">    <span class="keyword">delete</span> opts.preprocess;</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// ï¼ˆ12ï¼‰åœ¨è¿™é‡Œåˆå§‹åŒ– markdown-it</span></span><br><span class="line">    parser = markdown(opts.preset, opts);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ï¼ˆ13ï¼‰æ·»åŠ  rulerï¼šä» html token ä¸­æå– script å’Œ style</span></span><br><span class="line">    <span class="comment">//add ruler:extract script and style tags from html token content</span></span><br><span class="line">    !preventExtract &amp;&amp;</span><br><span class="line">      parser.core.ruler.push(<span class="string">'extract_script_or_style'</span>, <span class="function"><span class="keyword">function</span> <span class="title">replace</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        state</span></span></span><br><span class="line"><span class="function"><span class="params">      </span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> tag_reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&lt;(script|style)(?:[^&lt;]|&lt;)+&lt;/\\1&gt;'</span>, <span class="string">'g'</span>);</span><br><span class="line">        <span class="keyword">let</span> newTokens = [];</span><br><span class="line">        state.tokens</span><br><span class="line">          .filter(<span class="function"><span class="params">token</span> =&gt;</span> token.type == <span class="string">'fence'</span> &amp;&amp; token.info == <span class="string">'html'</span>)</span><br><span class="line">          .forEach(<span class="function"><span class="params">token</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> tokens = (token.content.match(tag_reg) || []).map(<span class="function"><span class="params">content</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">let</span> t = <span class="keyword">new</span> Token(<span class="string">'html_block'</span>, <span class="string">''</span>, <span class="number">0</span>);</span><br><span class="line">              t.content = content;</span><br><span class="line">              <span class="keyword">return</span> t;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">if</span> (tokens.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">              newTokens.push.apply(newTokens, tokens);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        state.tokens.push.apply(state.tokens, newTokens);</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="comment">// ï¼ˆ14ï¼‰å¦‚æœæœ‰æ’ä»¶ï¼Œå°±åº”ç”¨ä¸€ä¸‹</span></span><br><span class="line">    <span class="keyword">if</span> (plugins) &#123;</span><br><span class="line">      plugins.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">plugin</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(plugin)) &#123;</span><br><span class="line">          parser.use.apply(parser, plugin);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          parser.use(plugin);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ï¼ˆ15ï¼‰è¦†ç›–é»˜è®¤çš„ parser rulesï¼Œåœ¨ 'code' å’Œ 'pre' æ ‡ç­¾ä¸Šæ·»åŠ  v-pre å±æ€§</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * override default parser rules by adding v-pre attribute on 'code' and 'pre' tags</span></span><br><span class="line"><span class="comment">   * @param &#123;Array&lt;string&gt;&#125; rules rules to override</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">overrideParserRules</span>(<span class="params">rules</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (parser &amp;&amp; parser.renderer &amp;&amp; parser.renderer.rules) &#123;</span><br><span class="line">      <span class="keyword">var</span> parserRules = parser.renderer.rules;</span><br><span class="line">      rules.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">rule</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (parserRules &amp;&amp; parserRules[rule]) &#123;</span><br><span class="line">          <span class="keyword">var</span> defaultRule = parserRules[rule];</span><br><span class="line">          parserRules[rule] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> addVuePreviewAttr(defaultRule.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>));</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ï¼ˆ16ï¼‰è¦†ç›–è¿™ä¸‰ç§é»˜è®¤è§„åˆ™</span></span><br><span class="line">  overrideParserRules([<span class="string">'code_inline'</span>, <span class="string">'code_block'</span>, <span class="string">'fence'</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ï¼ˆ17ï¼‰å¦‚æœæœ‰é¢„å¤„ç†ï¼Œæ‰§è¡Œä¸€ä¸‹</span></span><br><span class="line">  <span class="keyword">if</span> (preprocess) &#123;</span><br><span class="line">    source = preprocess.call(<span class="keyword">this</span>, parser, source);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ï¼ˆ18ï¼‰å°† source ä¸­æ‰€æœ‰çš„ @ æ›¿æ¢æˆ '__at__'</span></span><br><span class="line">  source = source.replace(<span class="regexp">/@/g</span>, <span class="string">'__at__'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> content = parser.render(source).replace(<span class="regexp">/__at__/g</span>, <span class="string">'@'</span>);</span><br><span class="line">  <span class="keyword">var</span> result = renderVueTemplate(content, opts.wrapper);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (opts.raw) &#123;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'module.exports = '</span> + <span class="built_in">JSON</span>.stringify(result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/Users/athena/Library/Application Support/typora-user-images/image-20181121120525127.png" alt="image-20181121120525127"></p>
<p><strong>ï¼ˆ6ï¼‰preventExtract</strong></p>
<p>preventExtract æ˜¯ vue-markdown-loader æä¾›çš„ä¸€ä¸ª<a href="https://www.npmjs.com/package/vue-markdown-loader?activeTab=readme#preventextract" target="_blank" rel="noopener">é€‰é¡¹</a></p>
<blockquote>
<p>Since <code>v2.0.0</code>, this loader will automatically extract script and style tags from html token content (#26). If you do not need, you can set this option</p>
</blockquote>
<p><strong>ï¼ˆ13ï¼‰æ·»åŠ  rulerï¼šä» html token ä¸­æå– script å’Œ style</strong></p>
<p>èµ°åˆ°è¿™é‡Œï¼Œå°±éœ€è¦å¯¹ token æœ‰ä¸€ä¸ªè®¤è¯†æ‰è¡Œï¼Œæ‰€ä»¥å»ºè®®å…ˆçœ‹ä¸€ä¸‹<a href="https://www.jianshu.com/p/fb0ee355915c" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ã€‚æˆ‘æ‘˜å½•ä¸€éƒ¨åˆ†ï¼š</p>
<blockquote>
<p>å½“ä½ åˆ›å»ºäº†ä¸€ä¸ª <code>md = require(&#39;markdown-it&#39;)()</code> å¯¹è±¡ä¹‹åï¼Œå°±å¯ä»¥ç”¨å®ƒæ¥æ¸²æŸ“ MD æ–‡æ¡£äº†ï¼Œä¾‹å¦‚: <code>md.render(&quot;# I&#39;m H1 &quot;)</code>ã€‚è¿™ä¸ªæ¸²æŸ“è¿‡ç¨‹åˆ†ä¸ºä¸»è¦çš„ä¸¤æ­¥:</p>
<ol>
<li>å°† MD æ–‡æ¡£ Parsing ä¸º Tokensã€‚</li>
<li>æ¸²æŸ“è¿™ä¸ª Tokensã€‚</li>
</ol>
<p>Parsing çš„è¿‡ç¨‹æ˜¯ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª Core Parserï¼Œè¿™ä¸ª Core Parser åŒ…å«ä¸€ç³»åˆ—çš„ç¼ºçœ Rulesã€‚è¿™äº› Rules å°†é¡ºåºæ‰§è¡Œï¼Œæ¯ä¸ª Rule éƒ½åœ¨å‰é¢çš„ Tokens çš„åŸºç¡€ä¸Šï¼Œè¦ä¹ˆä¿®æ”¹åŸæ¥çš„ Tokenï¼Œè¦ä¹ˆæ·»åŠ æ–°çš„ Tokenã€‚è¿™ä¸ª Rules çš„é“¾æ¡è¢«ç§°ä¸º Core Chainã€‚</p>
<p>åœ¨æ‰€æœ‰ Tokens éƒ½è·å¾—ä¹‹åï¼Œå°±å¯ä»¥æ¸²æŸ“äº†ã€‚æ¸²æŸ“å°±æ˜¯æŠŠç‰¹å®š Token è½¬å˜ä¸ºç‰¹å®šçš„ HTML çš„è¿‡ç¨‹ã€‚</p>
<p>Markdown-It å…è®¸ä½ ä¸ºç‰¹å®šçš„ Token Type æŒ‚è½½è‡ªå·±çš„æ¸²æŸ“å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç§°ä¸º Renderer Ruleã€‚Markdown-It å·²ç»å®šä¹‰äº†å‡ ä¸ª ç¼ºçœçš„ Renderer Rules</p>
</blockquote>
<p><strong>ï¼ˆ14ï¼‰å¦‚æœæœ‰æ’ä»¶ï¼Œå°±åº”ç”¨ä¸€ä¸‹</strong></p>
<p><a href="https://markdown-it.github.io/markdown-it/#MarkdownIt.use" target="_blank" rel="noopener">MarkdownIt.use</a></p>
<p>åœ¨å½“å‰çš„è§£æå®ä¾‹ä¸­åº”ç”¨æŒ‡å®šçš„æ’ä»¶ã€‚</p>
<p>æœ€ç»ˆè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&lt;template&gt;&lt;section&gt;&lt;h1&gt;Hello&lt;/h1&gt;&lt;p&gt;&lt;code v-pre=&quot;&quot;&gt;&amp;lt;span&amp;gt;&#123;&#123;sss&#125;&#125;&amp;lt;/span&amp;gt;&lt;/code&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;This is test.&lt;/p&gt;&lt;/blockquote&gt;&lt;ul&gt;&lt;li&gt;How are you?&lt;/li&gt;&lt;li&gt;Fine, Thank you, and you?&lt;/li&gt;&lt;li&gt;I&apos;m fineï¼Œ too. Thank you.&lt;/li&gt;&lt;li&gt;ğŸŒš&lt;/li&gt;&lt;/ul&gt;&lt;pre v-pre=&quot;&quot;&gt;&lt;code v-pre=&quot;&quot; class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; Vue &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;vue&apos;&lt;/span&gt;Vue.config.debug = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;div class=&quot;test&quot;&gt;  &#123;&#123; model &#125;&#125; test&lt;/div&gt;&lt;p&gt;&lt;compo&gt;&#123;&#123; model &#125;&#125;&lt;/compo&gt;&lt;/p&gt;&lt;div class=&quot;abc&quot; @click=&quot;show = false&quot;&gt;  å•Šå“ˆå“ˆå“ˆ&lt;/div&gt;&lt;blockquote&gt;&lt;p&gt;All script or style tags in html mark will be extracted.Script will be excuted, and style will be added to document head.Notice if there is a string instance which contains special word &amp;quot;&amp;lt;/script&amp;gt;&amp;quot;, it will fetch a SyntaxError.Due to the complexity to solve it, just don&apos;t do that.&lt;/p&gt;&lt;/blockquote&gt;&lt;pre v-pre=&quot;&quot;&gt;&lt;code v-pre=&quot;&quot; class=&quot;language-html&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;style&lt;/span&gt; &lt;span class=&quot;hljs-attr&quot;&gt;scoped&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;css&quot;&gt;  &lt;span class=&quot;hljs-selector-class&quot;&gt;.test&lt;/span&gt; &#123;    &lt;span class=&quot;hljs-attribute&quot;&gt;background-color&lt;/span&gt;: green;  &#125;&lt;/span&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;style&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;style&lt;/span&gt; &lt;span class=&quot;hljs-attr&quot;&gt;scoped&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;css&quot;&gt;  &lt;span class=&quot;hljs-selector-class&quot;&gt;.abc&lt;/span&gt; &#123;    &lt;span class=&quot;hljs-attribute&quot;&gt;background-color&lt;/span&gt;: yellow;  &#125;&lt;/span&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;style&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;javascript&quot;&gt;  &lt;span class=&quot;hljs-keyword&quot;&gt;let&lt;/span&gt; a=&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;;  &lt;span class=&quot;hljs-keyword&quot;&gt;let&lt;/span&gt; b=&lt;span class=&quot;hljs-string&quot;&gt;&quot;&amp;lt;-forget it-/script&amp;gt;&quot;&lt;/span&gt;;  &lt;span class=&quot;hljs-built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;hljs-string&quot;&gt;&quot;***This script tag is successfully extracted and excuted.***&quot;&lt;/span&gt;)  &lt;span class=&quot;hljs-built_in&quot;&gt;module&lt;/span&gt;.exports = &#123;    &lt;span class=&quot;hljs-attr&quot;&gt;components&lt;/span&gt;: &#123;      &lt;span class=&quot;hljs-attr&quot;&gt;compo&lt;/span&gt;: &#123;        render(h) &#123;          &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; h(&lt;span class=&quot;hljs-string&quot;&gt;&apos;div&apos;&lt;/span&gt;, &#123;            &lt;span class=&quot;hljs-attr&quot;&gt;style&lt;/span&gt;: &#123;              &lt;span class=&quot;hljs-attr&quot;&gt;background&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&apos;red&apos;&lt;/span&gt;            &#125;          &#125;, &lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;.$slots.default);        &#125;      &#125;    &#125;,    data () &#123;      &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &#123;        &lt;span class=&quot;hljs-attr&quot;&gt;model&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&apos;abc&apos;&lt;/span&gt;      &#125;    &#125;  &#125;&lt;/span&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;jjjjjjjjjjjjjjjjjjjjjj&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;template&lt;/span&gt;&amp;gt;&lt;/span&gt;  &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;template&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;div&gt;&lt;/div&gt;&lt;p&gt;sadfsfs&lt;/p&gt;&lt;p&gt;å¤§å®¶å“¦å“¦å¥½å•Šè°éƒ½å‘ç”Ÿåœ°æ–¹ä¸Šçš„å†¯ç»å³°s&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;sahhhh&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;compo&gt;&#123;&#123; model &#125;&#125;&lt;/compo&gt;&lt;/p&gt;&lt;pre v-pre=&quot;&quot;&gt;&lt;code v-pre=&quot;&quot; class=&quot;language-html&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;compo&lt;/span&gt;&amp;gt;&lt;/span&gt;&#123;&#123;model &#125;&#125;&#123;&#123;model &#125;&#125;&#123;&#123;model &#125;&#125;&#123;&#123;model &#125;&#125;&#123;&#123; model &#125;&#125;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;compo&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;å¼•å…¥ style æ–‡ä»¶&lt;/h2&gt;&lt;div class=&quot;custom&quot;&gt;  åŸè°…è‰²&lt;/div&gt;&lt;/section&gt;&lt;/template&gt;&lt;style src=&quot;./custom.css&quot;&gt;&lt;/style&gt;&lt;style scoped&gt;  .test &#123;    background-color: green;  &#125;&lt;/style&gt;&lt;style scoped&gt;  .abc &#123;    background-color: yellow;  &#125;&lt;/style&gt;&lt;script&gt;  let a=1&lt;2;  let b=&quot;&lt;-forget it-/script&gt;&quot;;  console.log(&quot;***This script tag is successfully extracted and excuted.***&quot;)  module.exports = &#123;    components: &#123;      compo: &#123;        render(h) &#123;          return h(&apos;div&apos;, &#123;            style: &#123;              background: &apos;red&apos;            &#125;          &#125;, this.$slots.default);        &#125;      &#125;    &#125;,    data () &#123;      return &#123;        model: &apos;abc&apos;      &#125;    &#125;  &#125;&lt;/script&gt;&quot;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸­é—´å“ªæ­¥ä¸å¤ªæ˜ç™½ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œæ–­ç‚¹è°ƒè¯•ã€‚æ€»çš„æ€è·¯è¿˜æ˜¯å¾ˆæ¸…æ™°çš„ï¼Œå°±æ˜¯æŠŠ <code>.md</code> æ–‡ä»¶é€šè¿‡ <code>markdown-it</code> è½¬æˆ <code>html</code>ï¼Œä¸­é—´é€šè¿‡é€‰é¡¹è®¾ç½®é«˜äº®ï¼Œç„¶åå†åŒ…è£¹ä¸Š vue ç»„ä»¶çš„è¯­æ³•å½¢å¼å³å¯ï¼Œåç»­å†åº”ç”¨ <code>vue-loader</code> åšåé¢çš„å¤„ç†ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/06/3åŸºäºelement-uiå°è£…çš„ç»„ä»¶å‘å¸ƒnpmåŒ…/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›¯å­">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Athena">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/06/3åŸºäºelement-uiå°è£…çš„ç»„ä»¶å‘å¸ƒnpmåŒ…/" itemprop="url">
                  ä½¿ç”¨Vue CLI 3å°†åŸºäºelement-uiäºŒæ¬¡å°è£…çš„ç»„ä»¶å‘å¸ƒåˆ°npm
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-06 19:00:19 / ä¿®æ”¹æ—¶é—´ï¼š19:11:14" itemprop="dateCreated datePublished" datetime="2018-11-06T19:00:19+08:00">2018-11-06</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h2><p>é¦–å…ˆç”¨<a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener">Vue CLI 3</a>æ¥åˆå§‹åŒ–é¡¹ç›®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn global add @vue/cli</span><br><span class="line">vue create qiyun-el-ui</span><br><span class="line">vue ui</span><br></pre></td></tr></table></figure></p>
<h3 id="å®‰è£…element-ui"><a href="#å®‰è£…element-ui" class="headerlink" title="å®‰è£…element-ui"></a>å®‰è£…element-ui</h3><p>è¿™é‡Œä½¿ç”¨å®˜æ–¹æä¾›çš„çš„æ’ä»¶å®‰è£…ï¼š<br><a href="http://element.eleme.io/#/zh-CN/component/quickstart#shi-yong-vue-cli-at-3" target="_blank" rel="noopener">http://element.eleme.io/#/zh-CN/component/quickstart#shi-yong-vue-cli-at-3</a></p>
<p><a href="https://github.com/ElementUI/vue-cli-plugin-element" target="_blank" rel="noopener">https://github.com/ElementUI/vue-cli-plugin-element</a></p>
<p>åœ¨æ’ä»¶åˆ—è¡¨æœç´¢element<br><img src="https://user-images.githubusercontent.com/10095631/43555082-b9414998-962a-11e8-83ab-cda066a61093.png" alt="image"><br>åœ¨è¿™é‡Œæˆ‘é€‰çš„æ‰‹åŠ¨å¯¼å…¥ï¼Œå›¾ä¸­æ˜¯å…¨éƒ¨å¯¼å…¥<br><img src="https://user-images.githubusercontent.com/10095631/43555119-f486f034-962a-11e8-9862-dcaca0e3ebb3.png" alt="image"></p>
<p>è¿™æ ·åœ¨é¡¹ç›®ä¸­ï¼Œå°±ä¼šæ–°å»ºä¸€ä¸ªpluginsæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸ªelement.js æ–‡ä»¶ï¼Œå¦‚æœæƒ³æ‰‹åŠ¨å¼•å…¥ï¼Œå°±åœ¨è¿™é‡Œæ·»åŠ è¦ä¾èµ–çš„ç»„ä»¶ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†è°ƒè¯•ç»„ä»¶ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">  Button, </span><br><span class="line">  Dialog </span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'element-ui'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Button)</span><br><span class="line">Vue.use(Dialog)</span><br></pre></td></tr></table></figure></p>
<p>ç”±äºæˆ‘ä»¬æ˜¯åŸºäº<code>element-ui</code>çš„éƒ¨åˆ†ç»„ä»¶åšçš„äºŒæ¬¡å°è£…ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯æŒ‰éœ€å¼•å…¥æ‰€ä¾èµ–çš„ç»„ä»¶æ¯”è¾ƒå¥½ã€‚</p>
<h2 id="ç¼–å†™ç»„ä»¶"><a href="#ç¼–å†™ç»„ä»¶" class="headerlink" title="ç¼–å†™ç»„ä»¶"></a>ç¼–å†™ç»„ä»¶</h2><p>åœ¨ <code>src</code> çš„åŒçº§ä¸‹é¢æ–°å»º <code>packages</code> ç›®å½•ï¼Œåœ¨è¿™é‡Œæ·»åŠ è‡ªå·±å°è£…çš„è¦å‘å¸ƒçš„ç»„ä»¶ã€‚<br>ä¾‹å¦‚ï¼Œæ–°å»º <code>qe-modal</code> æ–‡ä»¶å¤¹ï¼Œå†æ¥ç€æ–°å»º <code>src</code> æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ–°å»º <code>qe-modal.vue</code>ï¼Œåœ¨è¿™é‡Œå†™ç»„ä»¶çš„ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-dialog</span><br><span class="line">    :title=&quot;title&quot;</span><br><span class="line">    :visible=&quot;dialogVisible&quot;</span><br><span class="line">    @close=&quot;$emit(&apos;update:dialogVisible&apos;, false)&quot;</span><br><span class="line">    :width=&quot;width&quot;&gt;</span><br><span class="line">    &lt;slot name=&quot;modal-body&quot;&gt;&lt;/slot&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">      &lt;slot name=&quot;modal-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;$emit(&apos;update:dialogVisible&apos;, false)&quot; size=&quot;small&quot;&gt;å– æ¶ˆ&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;$emit(&apos;confirm&apos;)&quot; size=&quot;small&quot; :disabled=&quot;confirmDisable || beforeSendDisable&quot;&gt;&#123;&#123; beforeSendDisable? &quot;å¤„ç†ä¸­...&quot; : &quot;ç¡® å®š&quot; &#125;&#125;&lt;/el-button&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &apos;qeModal&apos;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    dialogVisible: Boolean,</span><br><span class="line">    title: String,</span><br><span class="line">    width: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &apos;580px&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    beforeSendDisable: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    confirmDisable: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>qe-modal</code> æ ¹ç›®å½•ä¸‹æ–°å»º <code>index.js</code> ï¼Œé‡Œé¢æ³¨å†Œå•ç‹¬çš„è¯¥ç»„ä»¶ï¼Œæ–¹ä¾¿ä½¿ç”¨æ—¶å¯ä»¥å•ç‹¬å¼•ç”¨ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> qeModal <span class="keyword">from</span> <span class="string">'./src/qe-modal'</span></span><br><span class="line"></span><br><span class="line">qeModal.install = <span class="function"><span class="keyword">function</span>(<span class="params">Vue</span>) </span>&#123;</span><br><span class="line">  Vue.component(qeModal.name, qeModal)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> qeModal</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·ä¸€ä¸ªç»„ä»¶å°±æ·»åŠ å®Œæˆäº†ï¼Œç„¶åéœ€è¦åœ¨ <code>packages</code> çš„æ ¹ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªæ€»çš„ <code>index.js</code>ï¼Œè¿™é‡Œæ˜¯å…¨å±€æ³¨å†Œçš„åœ°æ–¹ï¼Œä½¿ç”¨æ—¶å¯ä»¥å…¨å±€å¼•å…¥ï¼Œå…¶å®å°±è·Ÿ <code>element-ui</code> çš„ä¸¤ç§æ–¹å¼ä¸€æ ·ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> qeModal <span class="keyword">from</span> <span class="string">'./qe-modal'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> components = [</span><br><span class="line">  qeModal</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> install = <span class="function"><span class="keyword">function</span>(<span class="params">Vue</span>) </span>&#123;</span><br><span class="line">  components.forEach(<span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">    Vue.component(component.name, component);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">window</span>.Vue) &#123;</span><br><span class="line">  install(<span class="built_in">window</span>.Vue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  install,</span><br><span class="line">  qeModal</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åé¢å†æ·»åŠ ç»„ä»¶ï¼Œåœ¨è¿™é‡Œä¹Ÿè¦å†æ³¨å†Œä¸€ä¸‹ï¼Œè€Œ<code>element-ui</code> æºç ä¸­æ˜¯åŠ¨æ€å¼•å…¥çš„ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ç»„ä»¶è¿˜æ²¡é‚£ä¹ˆå¤šï¼Œå¯ä»¥å…ˆä¸€ä¸ªä¸ªæ‰‹åŠ¨å¼•å…¥ï¼Œå¦‚æœåé¢æ•°é‡å¤šäº†ï¼Œä¸å¥½ç»´æŠ¤ï¼Œå¯ä»¥å‚è€ƒ <code>element-ui</code>  çš„æºç å®ç°ï¼Œæˆ‘åœ¨<a href="https://athena0304.github.io/element-analysis/build/bin/build-entry.js.html" target="_blank" rel="noopener">è¿™é‡Œ</a>åšäº†ä¸€äº›ç®€å•çš„è§£é‡Šã€‚</p>
<h2 id="é…ç½®-npm"><a href="#é…ç½®-npm" class="headerlink" title="é…ç½® npm"></a>é…ç½® npm</h2><p>åœ¨ package.json é‡Œé¢çš„ script é‡Œé¢åŠ ä¸€ä¸ª libé€‰é¡¹ï¼Œæ–¹ä¾¿æ¯æ¬¡æ„å»ºï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="comment">// ...,</span></span><br><span class="line">    <span class="string">"lib"</span>: <span class="string">"vue-cli-service build --target lib --name qiyun-el-ui --dest lib ./packages/index.js"</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­ <code>--name</code> åé¢æ˜¯ä½ æœ€åæƒ³è¦ç”Ÿæˆæ–‡ä»¶çš„åå­—ï¼Œå¹¶ç”¨ <code>--dest lib</code> ä¿®æ”¹äº†æ„å»ºçš„ç›®å½•ã€‚<br>ç„¶ååœ¨ <code>package.json</code> é‡Œé¢æ·»åŠ ä¸€äº›npmåŒ…å‘å¸ƒçš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚ä½œè€…ã€ç‰ˆæœ¬ç­‰ï¼š<br>å…¶ä¸­æœ€é‡è¦çš„æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;main&quot;: &quot;lib/qiyun-el-ui.common.js&quot;,</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„è·¯å¾„è¦å’Œä¸Šé¢æ„å»ºå‡ºæ¥çš„ç›®å½•å’Œæ–‡ä»¶åå¯¹åº”ä¸Šã€‚</p>
<p>é‡Œé¢çš„é…ç½®é¡¹ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†ä¸ªä¾‹å­ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"maucash"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"maucashä¸­å¸¸ç”¨ç»„ä»¶æŠ½å–"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.2"</span>,</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">"kuangshp &lt;kuangshp@126.com&gt;"</span>,</span><br><span class="line">  <span class="comment">// å¼€æºåè®®</span></span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"MIT"</span>,</span><br><span class="line">  <span class="comment">// å› ä¸ºç»„ä»¶åŒ…æ˜¯å…¬ç”¨çš„ï¼Œæ‰€ä»¥privateä¸ºfalse</span></span><br><span class="line">  <span class="string">"private"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// é…ç½®mainç»“ç‚¹ï¼Œå¦‚æœä¸é…ç½®ï¼Œæˆ‘ä»¬åœ¨å…¶ä»–é¡¹ç›®ä¸­å°±ä¸ç”¨import XX from 'åŒ…å'æ¥å¼•ç”¨äº†ï¼Œåªèƒ½ä»¥åŒ…åä½œä¸ºèµ·ç‚¹æ¥æŒ‡å®šç›¸å¯¹çš„è·¯å¾„</span></span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"dist/maucash.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"cross-env NODE_ENV=development webpack-dev-server --open --hot"</span>,</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"cross-env NODE_ENV=production webpack --progress --hide-modules"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"axios"</span>: <span class="string">"^0.18.0"</span>,</span><br><span class="line">    <span class="string">"iview"</span>: <span class="string">"^2.14.1"</span>,</span><br><span class="line">    <span class="string">"style-loader"</span>: <span class="string">"^0.23.1"</span>,</span><br><span class="line">    <span class="string">"url-loader"</span>: <span class="string">"^1.1.2"</span>,</span><br><span class="line">    <span class="string">"vue"</span>: <span class="string">"^2.5.11"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// æŒ‡å®šä»£ç æ‰€åœ¨çš„ä»“åº“åœ°å€</span></span><br><span class="line">  <span class="string">"repository"</span>: &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"git"</span>,</span><br><span class="line">    <span class="string">"url"</span>: <span class="string">"git+git@git.wolaidai.com:maucash/maucash.git"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// æŒ‡å®šæ‰“åŒ…å,åŒ…ä¸­å­˜åœ¨çš„æ–‡ä»¶å¤¹</span></span><br><span class="line">  <span class="string">"files"</span>: [</span><br><span class="line">    <span class="string">"dist"</span>,</span><br><span class="line">    <span class="string">"src"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// æŒ‡å®šå…³é”®è¯</span></span><br><span class="line">  <span class="string">"keywords"</span>: [</span><br><span class="line">    <span class="string">"vue"</span>,</span><br><span class="line">    <span class="string">"maucash"</span>,</span><br><span class="line">    <span class="string">"code"</span>,</span><br><span class="line">    <span class="string">"maucash code"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// é¡¹ç›®å®˜ç½‘çš„åœ°å€</span></span><br><span class="line">  <span class="string">"homepage"</span>: <span class="string">"https://github.com/kuangshp/maucash"</span>,</span><br><span class="line">  <span class="string">"browserslist"</span>: [</span><br><span class="line">    <span class="string">"&gt; 1%"</span>,</span><br><span class="line">    <span class="string">"last 2 versions"</span>,</span><br><span class="line">    <span class="string">"not ie &lt;= 8"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"babel-core"</span>: <span class="string">"^6.26.0"</span>,</span><br><span class="line">    <span class="string">"babel-loader"</span>: <span class="string">"^7.1.2"</span>,</span><br><span class="line">    <span class="string">"babel-plugin-transform-runtime"</span>: <span class="string">"^6.23.0"</span>,</span><br><span class="line">    <span class="string">"babel-preset-env"</span>: <span class="string">"^1.6.0"</span>,</span><br><span class="line">    <span class="string">"babel-preset-stage-3"</span>: <span class="string">"^6.24.1"</span>,</span><br><span class="line">    <span class="string">"cross-env"</span>: <span class="string">"^5.0.5"</span>,</span><br><span class="line">    <span class="string">"css-loader"</span>: <span class="string">"^0.28.7"</span>,</span><br><span class="line">    <span class="string">"file-loader"</span>: <span class="string">"^1.1.4"</span>,</span><br><span class="line">    <span class="string">"node-sass"</span>: <span class="string">"^4.5.3"</span>,</span><br><span class="line">    <span class="string">"sass-loader"</span>: <span class="string">"^6.0.6"</span>,</span><br><span class="line">    <span class="string">"vue-loader"</span>: <span class="string">"^13.0.5"</span>,</span><br><span class="line">    <span class="string">"vue-template-compiler"</span>: <span class="string">"^2.4.4"</span>,</span><br><span class="line">    <span class="string">"webpack"</span>: <span class="string">"^3.6.0"</span>,</span><br><span class="line">    <span class="string">"webpack-dev-server"</span>: <span class="string">"^2.9.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="å‘å¸ƒåˆ°npm"><a href="#å‘å¸ƒåˆ°npm" class="headerlink" title="å‘å¸ƒåˆ°npm"></a>å‘å¸ƒåˆ°npm</h2><p>åˆ°è¿™å—åé¢çš„ç½‘ä¸Šæœ‰å¾ˆå¤šæ›´ç»†è‡´çš„æ•™ç¨‹ï¼Œæˆ‘å°±ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†ã€‚ä¸‹é¢ç»™å‡ºä¸¤ä¸ªæ–‡ç« çš„é“¾æ¥ï¼Œä¾›å‚è€ƒã€‚</p>
<p>1ã€åˆ°<a href="https://www.npmjs.com/" target="_blank" rel="noopener">npm</a>ä¸Šæ³¨å†Œä¸€ä¸ªè´¦å·</p>
<p>2ã€ç™»å½•<br><code>npm login</code></p>
<p>3ã€æ·»åŠ ç”¨æˆ·ä¿¡æ¯<br><code>npm adduser</code></p>
<p>4ã€å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“(npm)ä¸Š<br><code>npm publish</code></p>
<p>5ã€åˆ é™¤è¿œç¨‹ä»“åº“çš„åŒ…<br><code>npx force-unpublish package-name &#39;åŸå› æè¿°&#39;</code></p>
<p>å‚è€ƒï¼š<br><a href="https://juejin.im/post/5bc44175f265da0a906f9869" target="_blank" rel="noopener">https://juejin.im/post/5bc44175f265da0a906f9869</a><br><a href="https://www.jb51.net/article/148692.htm" target="_blank" rel="noopener">Vue cli3 åº“æ¨¡å¼æ­å»ºç»„ä»¶åº“å¹¶å‘å¸ƒåˆ° npmçš„æµç¨‹<em>vue.js</em>è„šæœ¬ä¹‹å®¶</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/04/newvscreate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›¯å­">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Athena">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/04/newvscreate/" itemprop="url">
                  ç®€å•ç†è§£ä¸€ä¸‹ Object.create() ä¸ new ä¹‹é—´çš„åŒºåˆ«
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-04 16:19:51 / ä¿®æ”¹æ—¶é—´ï¼š16:20:15" itemprop="dateCreated datePublished" datetime="2018-11-04T16:19:51+08:00">2018-11-04</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>é¦–å…ˆçœ‹ä¸€ä¸‹ <code>Object.create</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dog = &#123;</span><br><span class="line">    eat: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.eatFood)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> maddie = <span class="built_in">Object</span>.create(dog);</span><br><span class="line"><span class="built_in">console</span>.log(dog.isPrototypeOf(maddie)); <span class="comment">//true</span></span><br><span class="line">maddie.eatFood = <span class="string">'NomNomNom'</span>; </span><br><span class="line">maddie.eat(); <span class="comment">//NomNomNom</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå­—é¢é‡å¯¹è±¡ <code>dog</code>ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæ–¹æ³• <code>eat</code>ã€‚</li>
<li>ä½¿ç”¨ <code>Object.create(dog)</code> åˆå§‹åŒ– <code>maddie</code>ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œå¹¶å°†è¯¥å¯¹è±¡çš„åŸå‹è®¾ç½®æˆ <code>dog</code>ã€‚</li>
<li>æµ‹è¯• <code>dog</code> æ˜¯å¦æ˜¯ <code>maddie</code> çš„åŸå‹ã€‚</li>
<li>é€šè¿‡ <code>maddie.eatFood</code> è®¾ç½®å°†è¦è¾“å‡ºçš„å˜é‡ã€‚</li>
<li>åœ¨æ–°åˆ›å»ºçš„ <code>maddie</code> ä¸Šè°ƒç”¨ <code>eat</code> æ–¹æ³•ã€‚</li>
<li>æŸ¥æ‰¾åŸå‹é“¾ï¼Œæ‰¾åˆ° <code>dog</code> é‡Œé¢çš„ <code>eat</code> æ–¹æ³•ï¼Œæ­¤æ—¶ <code>this</code> æŒ‡å‘çš„æ˜¯ <code>maddie</code></li>
<li>æ§åˆ¶å°è¾“å‡º <code>NomNomNom</code>ã€‚</li>
</ol>
<p>ç°åœ¨å†çœ‹ä¸€ä¸‹ <code>**new**</code> æ“ä½œç¬¦ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Dog = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.eatFood = <span class="string">'NomNomNom'</span>;</span><br><span class="line">    <span class="keyword">this</span>.eat = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.eatFood)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> maddie = <span class="keyword">new</span>(Dog);</span><br><span class="line"><span class="built_in">console</span>.log(maddie <span class="keyword">instanceof</span> Dog); <span class="comment">// True</span></span><br><span class="line">maddie.eat(); <span class="comment">//NomNomNom</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œéµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œ<code>maddie</code>ã€‚</li>
<li><code>maddie</code> ç»§æ‰¿äº†æ„é€ å‡½æ•°çš„åŸå‹ã€‚</li>
<li>æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œå°† <code>this</code> è®¾ç½®æˆç¬¬ä¸€æ­¥åˆ›å»ºçš„å¯¹è±¡ã€‚</li>
<li>è¿”å›åˆ›å»ºçš„å¯¹è±¡ï¼ˆé™¤éæ„é€ å‡½æ•°è¿”å›äº†å…¶å®ƒå¯¹è±¡ï¼‰ã€‚</li>
</ol>
<p>ä¹ä¸€çœ‹ä¸Šå»ä¸¤è€…éƒ½åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åç»§æ‰¿äº†åŸå‹ï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºåŒºåˆ«ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.pupper = <span class="string">'Pupper'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Dog.prototype.pupperino = <span class="string">'Pups.'</span>;</span><br><span class="line"><span class="keyword">var</span> maddie = <span class="keyword">new</span> Dog();</span><br><span class="line"><span class="keyword">var</span> buddy = <span class="built_in">Object</span>.create(Dog.prototype);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Using Object.create()</span></span><br><span class="line"><span class="built_in">console</span>.log(buddy.pupper); <span class="comment">//Output is undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(buddy.pupperino); <span class="comment">//Output is Pups.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Using New Keyword</span></span><br><span class="line"><span class="built_in">console</span>.log(maddie.pupper); <span class="comment">//Output is Pupper</span></span><br><span class="line"><span class="built_in">console</span>.log(maddie.pupperino); <span class="comment">//Output is Pups.</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®ç‚¹å°±æ˜¯è¿™å¥è¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(buddy.pupper); <span class="comment">//Output is undefined</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å‘ç° <code>buddy.pupper</code> è¾“å‡ºçš„æ˜¯ <code>undefined</code>ã€‚å³ä½¿ <code>Object.create()</code> å°† <code>buddy</code> çš„åŸå‹è®¾ç½®æˆäº† <code>Dog</code>ï¼Œä½†æ˜¯ <code>buddy</code> è¿˜æ˜¯æ— æ³•è®¿é—®åˆ°ç‹—åœ¨å‡½æ•°ä¸­çš„ <code>**this.pupper**</code>ã€‚è¿™æ˜¯å› ä¸º <code>new Dog</code> å®é™…ä¸Šæ‰§è¡Œäº†æ„é€ å‡½æ•°ï¼Œè€Œ <code>Object.create</code> æ²¡æœ‰æ‰§è¡Œã€‚</p>
<p>åŸæ–‡ï¼š<a href="https://medium.com/@jonathanvox01/understanding-the-difference-between-object-create-and-the-new-operator-b2a2f4749358" target="_blank" rel="noopener">https://medium.com/@jonathanvox01/understanding-the-difference-between-object-create-and-the-new-operator-b2a2f4749358</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/04/understanding-design-patterns-in-javascript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›¯å­">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Athena">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/04/understanding-design-patterns-in-javascript/" itemprop="url">
                  ã€è¯‘ã€‘ç®€å•ç†è§£ JavaScript ä¸­çš„è®¾è®¡æ¨¡å¼
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-04 16:14:02 / ä¿®æ”¹æ—¶é—´ï¼š16:19:31" itemprop="dateCreated datePublished" datetime="2018-11-04T16:14:02+08:00">2018-11-04</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å½“ä½ å¼€å§‹ä¸€ä¸ªæ–°çš„é¡¹ç›®æ—¶ï¼Œä¸€èˆ¬ä¸ä¼šç«‹å³å¼€å§‹ç¼–ç ï¼Œé¦–å…ˆå¿…é¡»è¦å®šä¹‰é¡¹ç›®çš„ç›®çš„å’ŒèŒƒå›´ï¼Œç„¶ååˆ—å‡ºé¡¹ç›®çš„ç‰¹æ€§æˆ–è§„æ ¼ã€‚åœ¨å¯ä»¥å¼€å§‹ç¼–å†™ä»£ç ä¹‹åï¼Œæˆ–è€…å¦‚æœä½ æ­£åœ¨å¤„ç†ä¸€ä¸ªæ›´å¤æ‚çš„é¡¹ç›®ï¼Œé‚£ä¹ˆä½ åº”è¯¥é€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆè¯¥é¡¹ç›®çš„è®¾è®¡æ¨¡å¼ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ</h2><p>åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œè®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶è®¾è®¡ä¸­å¸¸è§é—®é¢˜çš„å¯é‡ç”¨è§£å†³æ–¹æ¡ˆã€‚è®¾è®¡æ¨¡å¼ä»£è¡¨äº†ç»éªŒä¸°å¯Œçš„è½¯ä»¶å¼€å‘äººå‘˜æ‰€ä½¿ç”¨çš„æœ€ä½³å®è·µã€‚è®¾è®¡æ¨¡å¼å¯ä»¥çœ‹ä½œæ˜¯ç¼–ç¨‹æ¨¡æ¿ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Ÿ</h3><p>å¾ˆå¤šç¨‹åºå‘˜è¦ä¹ˆè®¤ä¸ºè®¾è®¡æ¨¡å¼æµªè´¹æ—¶é—´ï¼Œè¦ä¹ˆä¸çŸ¥é“å¦‚ä½•æ°å½“åœ°åº”ç”¨å®ƒä»¬ã€‚ä½†æ˜¯ä½¿ç”¨é€‚å½“çš„è®¾è®¡æ¨¡å¼å¯ä»¥å¸®åŠ©ä½ ç¼–å†™æ›´å¥½ã€æ›´æ˜“äºç†è§£çš„ä»£ç ï¼Œä¸”æ›´å®¹æ˜“ç»´æŠ¤ã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼Œè®¾è®¡æ¨¡å¼ä¸ºè½¯ä»¶å¼€å‘äººå‘˜æä¾›äº†ä¸€ä¸ªå¯ä»¥è®¨è®ºçš„é€šç”¨è¯æ±‡è¡¨ã€‚å®ƒä»¬ä¼šç«‹å³å‘å­¦ä¹ ä»£ç çš„äººæ˜¾ç¤ºä»£ç çš„æ„å›¾ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è£…é¥°è€…æ¨¡å¼ï¼Œé‚£ä¹ˆæ–°åŠ å…¥çš„å¼€å‘äººå‘˜å°†ç«‹å³çŸ¥é“è¿™æ®µä»£ç åœ¨åšä»€ä¹ˆï¼Œæ‰€ä»¥ä»–ä»¬å¯ä»¥æ›´å…³æ³¨äºè§£å†³ä¸šåŠ¡é—®é¢˜ï¼Œè€Œä¸æ˜¯è¯•å›¾ç†è§£ä»£ç åœ¨åšä»€ä¹ˆã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº†ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Œä»¥åŠå®ƒä»¬ä¸ºä»€ä¹ˆé‡è¦ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶ JavaScript ä¸­ä½¿ç”¨çš„å„ç§è®¾è®¡æ¨¡å¼ã€‚</p>
<h2 id="æ¨¡å—æ¨¡å¼-Module-Pattern"><a href="#æ¨¡å—æ¨¡å¼-Module-Pattern" class="headerlink" title="æ¨¡å—æ¨¡å¼-Module Pattern"></a>æ¨¡å—æ¨¡å¼-Module Pattern</h2><p>æ¨¡å—æ˜¯ä¸€æ®µè‡ªåŒ…å«çš„ä»£ç ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ä¸å½±å“ä»£ç å…¶ä»–éƒ¨åˆ†çš„æƒ…å†µä¸‹æ›´æ–°æ¨¡å—ã€‚æ¨¡å—è¿˜å…è®¸æˆ‘ä»¬é€šè¿‡ä¸ºå˜é‡åˆ›å»ºå•ç‹¬çš„ä½œç”¨åŸŸæ¥é¿å…å‘½åç©ºé—´æ±¡æŸ“ã€‚å½“æ¨¡å—ä¸å…¶ä»–ä»£ç ç‰‡æ®µåˆ†ç¦»æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨å…¶ä»–é¡¹ç›®ä¸­é‡ç”¨å®ƒä»¬ã€‚</p>
<p>æ¨¡å—æ˜¯ä»»ä½•ç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„ç»„æˆéƒ¨åˆ†ï¼Œå®ƒæœ‰åŠ©äºä¿æŒä»£ç çš„æ•´æ´ã€åˆ†ç¦»å’Œç»„ç»‡ã€‚ç”¨ JavaScript åˆ›å»ºæ¨¡å—æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ¨¡å—æ¨¡å¼æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚</p>
<p>ä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸åŒï¼ŒJavaScriptæ²¡æœ‰è®¿é—®ä¿®é¥°ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸èƒ½å°†å˜é‡å£°æ˜ä¸ºç§æœ‰æˆ–å…¬å…±ã€‚å› æ­¤ï¼Œæ¨¡å—æ¨¡å¼ä¹Ÿè¢«ç”¨æ¥æ¨¡æ‹Ÿå°è£…çš„æ¦‚å¿µã€‚</p>
<p>æ¨¡å—æ¨¡å¼ä½¿ç”¨IIFE(ç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼)ã€é—­åŒ…å’Œå‡½æ•°ä½œç”¨åŸŸæ¥æ¨¡æ‹Ÿæ­¤æ¦‚å¿µã€‚ä¾‹å¦‚:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myModule = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> privateVariable = <span class="string">'Hello World'</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">privateMethod</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(privateVariable);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    publicMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      privateMethod();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line">myModule.publicMethod();</span><br></pre></td></tr></table></figure>
<p>ç”±äºå®ƒæ˜¯ IIFEï¼Œä»£ç ç«‹å³è¢«æ‰§è¡Œï¼Œè¿”å›çš„å¯¹è±¡è¢«åˆ†é…ç»™ <code>myModule</code> å˜é‡ã€‚å› ä¸ºé—­åŒ…ï¼Œæ‰€ä»¥è¿”å›çš„å¯¹è±¡ä»ç„¶å¯ä»¥è®¿é—®åœ¨IIFEä¸­å®šä¹‰çš„å‡½æ•°å’Œå˜é‡ï¼Œå³ä½¿åœ¨ IIFE ç»“æŸä¹‹åã€‚</p>
<p>åœ¨ IIFE ä¸­å®šä¹‰çš„å˜é‡å’Œå‡½æ•°åœ¨å¤–éƒ¨ä½œç”¨åŸŸæ˜¯ä¸å¯è§çš„ï¼Œäºæ˜¯å®ƒä»¬æˆä¸ºäº† <code>myModule</code> çš„ç§æœ‰å˜é‡ã€‚</p>
<p>ä»£ç æ‰§è¡Œè¿‡åï¼Œ<code>myModule</code> å˜é‡çœ‹ä¸Šå»æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myModule = &#123;</span><br><span class="line">  publicMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    privateMethod();</span><br><span class="line">  &#125;&#125;;</span><br></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>publicMethod()</code>ï¼Œç„¶åä¾æ¬¡è°ƒç”¨ <code>privateMethod()</code>ã€‚ä¾‹å¦‚:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Prints 'Hello World'</span></span><br><span class="line"><span class="built_in">module</span>.publicMethod();</span><br></pre></td></tr></table></figure>
<h2 id="æ­ç¤ºæ¨¡å—æ¨¡å¼-Revealing-Module-Pattern"><a href="#æ­ç¤ºæ¨¡å—æ¨¡å¼-Revealing-Module-Pattern" class="headerlink" title="æ­ç¤ºæ¨¡å—æ¨¡å¼-Revealing Module Pattern"></a>æ­ç¤ºæ¨¡å—æ¨¡å¼-Revealing Module Pattern</h2><p>æ­ç¤ºæ¨¡å—æ¨¡å¼æ˜¯ç”± Christian Heilmann åŸºäºæ¨¡å—æ¨¡å¼ç•¥å¾®æ”¹è¿›çš„ç‰ˆæœ¬ã€‚æ¨¡å—æ¨¡å¼çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºæ–°çš„å…¬å…±å‡½æ•°ï¼Œä»…ä»…æ˜¯ç”¨æ¥è°ƒç”¨ç§æœ‰å‡½æ•°å’Œå˜é‡ã€‚</p>
<p>åœ¨è¿™ä¸ªæ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å°†è¿”å›å¯¹è±¡çš„å±æ€§æ˜ å°„åˆ°æˆ‘ä»¬æƒ³è¦å…¬å¼€çš„ç§æœ‰å‡½æ•°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒè¢«ç§°ä¸ºæ­ç¤ºæ¨¡å—æ¨¡å¼ã€‚ä¾‹å¦‚:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myRevealingModule = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> privateVar = <span class="string">'Peter'</span>;</span><br><span class="line">  <span class="keyword">const</span> publicVar  = <span class="string">'Hello World'</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">privateFunction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Name: '</span>+ privateVar);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">publicSetName</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    privateVar = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">publicGetName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    privateFunction();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/** reveal methods and variables by assigning them to object properties */</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">    setName: publicSetName,</span><br><span class="line">    greeting: publicVar,</span><br><span class="line">    getName: publicGetName</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line">myRevealingModule.setName(<span class="string">'Mark'</span>);</span><br><span class="line"><span class="comment">// prints Name: Mark</span></span><br><span class="line">myRevealingModule.getName();</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ¨¡å¼ä½¿æˆ‘ä»¬æ›´å®¹æ˜“ç†è§£å“ªäº›å‡½æ•°å’Œå˜é‡å¯ä»¥å…¬å¼€è®¿é—®ï¼Œæœ‰åŠ©äºä»£ç çš„å¯è¯»æ€§ã€‚</p>
<p>æ‰§è¡Œä»£ç ä¹‹åï¼Œ<code>myRevealingModule</code> å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myRevealingModule = &#123;</span><br><span class="line">  setName: publicSetName,</span><br><span class="line">  greeting: publicVar,</span><br><span class="line">  getName: publicGetName</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>myRevealingModule.setName(&#39;Mark&#39;)</code>ï¼Œå®ƒæ˜¯å¯¹å†…éƒ¨ <code>publicSetName</code> çš„å¼•ç”¨ï¼Œè¿˜å¯ä»¥è°ƒç”¨ <code>myRevealingModule.getName()</code> ï¼Œæ˜¯å¯¹å†…éƒ¨ <code>publicGetName</code> çš„å¼•ç”¨ã€‚ä¾‹å¦‚:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">myRevealingModule.setName(<span class="string">'Mark'</span>);</span><br><span class="line"><span class="comment">// prints Name: Mark</span></span><br><span class="line">myRevealingModule.getName();</span><br></pre></td></tr></table></figure>
<h3 id="æ­ç¤ºæ¨¡å—æ¨¡å¼ç›¸æ¯”æ¨¡å—æ¨¡å¼çš„ä¼˜åŠ¿ï¼š"><a href="#æ­ç¤ºæ¨¡å—æ¨¡å¼ç›¸æ¯”æ¨¡å—æ¨¡å¼çš„ä¼˜åŠ¿ï¼š" class="headerlink" title="æ­ç¤ºæ¨¡å—æ¨¡å¼ç›¸æ¯”æ¨¡å—æ¨¡å¼çš„ä¼˜åŠ¿ï¼š"></a>æ­ç¤ºæ¨¡å—æ¨¡å¼ç›¸æ¯”æ¨¡å—æ¨¡å¼çš„ä¼˜åŠ¿ï¼š</h3><ul>
<li>é€šè¿‡ä¿®æ”¹ return è¯­å¥ä¸­çš„ä¸€è¡Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆå‘˜ä» public æ›´æ”¹ä¸º privateï¼Œåä¹‹äº¦ç„¶ã€‚</li>
<li>è¿”å›çš„å¯¹è±¡ä¸åŒ…å«ä»»ä½•å‡½æ•°å®šä¹‰ï¼Œæ‰€æœ‰å³ä¾§è¡¨è¾¾å¼éƒ½åœ¨IIFEä¸­å®šä¹‰ï¼Œä½¿ä»£ç æ¸…æ™°ä¸”æ˜“äºé˜…è¯»ã€‚</li>
</ul>
<h2 id="ES6æ¨¡å—-ES6-Modules"><a href="#ES6æ¨¡å—-ES6-Modules" class="headerlink" title="ES6æ¨¡å—-ES6 Modules"></a>ES6æ¨¡å—-ES6 Modules</h2><p>åœ¨ ES6 ä¹‹å‰ï¼ŒJavaScript æ²¡æœ‰å†…ç½®æ¨¡å—ï¼Œå› æ­¤å¼€å‘äººå‘˜ä¸å¾—ä¸ä¾èµ–ç¬¬ä¸‰æ–¹åº“æˆ–æ¨¡å—æ¨¡å¼æ¥å®ç°æ¨¡å—ã€‚ä½†æ˜¯åœ¨ ES6ä¸­ï¼ŒJavaScript æœ‰åŸç”Ÿæ¨¡å—ã€‚</p>
<p>ES6æ¨¡å—å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ã€‚æ¯ä¸ªæ–‡ä»¶åªèƒ½æœ‰ä¸€ä¸ªæ¨¡å—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å—ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯ç§æœ‰çš„ã€‚ä½¿ç”¨ <code>export</code> å…³é”®å­—å…¬å¼€å‡½æ•°ã€å˜é‡å’Œç±»ã€‚æ¨¡å—å†…çš„ä»£ç æ€»æ˜¯åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹è¿è¡Œã€‚</p>
<h3 id="å¯¼å‡ºæ¨¡å—"><a href="#å¯¼å‡ºæ¨¡å—" class="headerlink" title="å¯¼å‡ºæ¨¡å—"></a>å¯¼å‡ºæ¨¡å—</h3><p>å¯¼å‡ºå‡½æ•°å’Œå˜é‡å£°æ˜æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>é€šè¿‡åœ¨å‡½æ•°å’Œå˜é‡å£°æ˜å‰æ·»åŠ  <code>export</code> å…³é”®å­—ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> greeting = <span class="string">'Hello World'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Sum:'</span>, num1, num2);</span><br><span class="line">  <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">subtract</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Subtract:'</span>, num1, num2);</span><br><span class="line">  <span class="keyword">return</span> num1 - num2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// This is a private function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">privateLog</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Private Function'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é€šè¿‡åœ¨åŒ…å«è¦å¯¼å‡ºçš„å‡½æ•°å’Œå˜é‡åç§°çš„ä»£ç æœ«å°¾æ·»åŠ  <code>export</code> å…³é”®å­—ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Multiply:'</span>, num1, num2);</span><br><span class="line">  <span class="keyword">return</span> num1 * num2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">divide</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Divide:'</span>, num1, num2);</span><br><span class="line">  <span class="keyword">return</span> num1 / num2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// This is a private function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">privateLog</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Private Function'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;multiply, divide&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="å¯¼å…¥æ¨¡å—"><a href="#å¯¼å…¥æ¨¡å—" class="headerlink" title="å¯¼å…¥æ¨¡å—"></a>å¯¼å…¥æ¨¡å—</h3><p>ä¸å¯¼å‡ºæ¨¡å—ç±»ä¼¼ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨ <code>import</code> å…³é”®å­—å¯¼å…¥æ¨¡å—ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>ä¸€æ¬¡å¯¼å…¥å¤šä¸ªé¡¹</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="comment">// importing multiple items</span></span><br><span class="line"><span class="keyword">import</span> &#123; sum, multiply &#125; <span class="keyword">from</span> <span class="string">'./utils.js'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">3</span>, <span class="number">7</span>));</span><br><span class="line"><span class="built_in">console</span>.log(multiply(<span class="number">3</span>, <span class="number">7</span>));</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯¼å…¥æ‰€æœ‰å†…å®¹</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="comment">// importing all of module</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> utils <span class="keyword">from</span> <span class="string">'./utils.js'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(utils.sum(<span class="number">3</span>, <span class="number">7</span>));</span><br><span class="line"><span class="built_in">console</span>.log(utils.multiply(<span class="number">3</span>, <span class="number">7</span>));</span><br></pre></td></tr></table></figure>
<h3 id="å¯¼å…¥å’Œå¯¼å‡ºå¯ä»¥é‡å‘½å"><a href="#å¯¼å…¥å’Œå¯¼å‡ºå¯ä»¥é‡å‘½å" class="headerlink" title="å¯¼å…¥å’Œå¯¼å‡ºå¯ä»¥é‡å‘½å"></a>å¯¼å…¥å’Œå¯¼å‡ºå¯ä»¥é‡å‘½å</h3><p>å¦‚æœå¸Œæœ›é¿å…å‘½åå†²çªï¼Œå¯ä»¥åœ¨å¯¼å…¥å’Œå¯¼å‡ºæ—¶ä¿®æ”¹å‘½åï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>é‡å‘½åå¯¼å‡º</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Sum:'</span>, num1, num2);</span><br><span class="line">  <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Multiply:'</span>, num1, num2);</span><br><span class="line">  <span class="keyword">return</span> num1 * num2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;sum <span class="keyword">as</span> add, multiply&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>é‡å‘½åå¯¼å…¥</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; add, multiply <span class="keyword">as</span> mult &#125; <span class="keyword">from</span> <span class="string">'./utils.js'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">3</span>, <span class="number">7</span>));</span><br><span class="line"><span class="built_in">console</span>.log(mult(<span class="number">3</span>, <span class="number">7</span>));</span><br></pre></td></tr></table></figure>
<h2 id="å•ä¾‹æ¨¡å¼-Singleton-Pattern"><a href="#å•ä¾‹æ¨¡å¼-Singleton-Pattern" class="headerlink" title="å•ä¾‹æ¨¡å¼-Singleton Pattern"></a>å•ä¾‹æ¨¡å¼-Singleton Pattern</h2><p>å•ä¾‹å¯¹è±¡æ˜¯åªèƒ½å®ä¾‹åŒ–ä¸€æ¬¡çš„å¯¹è±¡ã€‚å¦‚æœä¸€ä¸ªç±»ä¸å­˜åœ¨ï¼Œå•ä¾‹æ¨¡å¼ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å®ä¾‹ã€‚å¦‚æœå®ä¾‹å­˜åœ¨ï¼Œå®ƒåªè¿”å›å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚å¯¹æ„é€ å‡½æ•°çš„ä»»ä½•é‡å¤è°ƒç”¨éƒ½å°†è·å–ç›¸åŒçš„å¯¹è±¡ã€‚</p>
<p>åœ¨ JavaScript ä¸­ï¼Œä¸€ç›´éƒ½æœ‰å†…ç½®çš„å•ä¾‹ã€‚æˆ‘ä»¬åªæ˜¯ä¸ç§°å®ƒä»¬ä¸ºå•ä¾‹ï¼Œè€Œæ˜¯å¯¹è±¡å­—é¢é‡ï¼ˆobject literalï¼‰ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  name: <span class="string">'Peter'</span>,</span><br><span class="line">  age: <span class="number">25</span>,</span><br><span class="line">  job: <span class="string">'Teacher'</span>,</span><br><span class="line">  greet: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å› ä¸º JavaScript ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½å ç”¨ä¸€ä¸ªå”¯ä¸€çš„å†…å­˜ä½ç½®ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ <code>user</code> å¯¹è±¡æ—¶ï¼Œå®é™…ä¸Šæ˜¯è¿”å›å¯¹è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¯•å›¾å°† <code>user</code> å˜é‡å¤åˆ¶åˆ°å¦ä¸€ä¸ªå˜é‡ä¸­å¹¶ä¿®æ”¹è¯¥å˜é‡ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user1 = user;</span><br><span class="line">user1.name = <span class="string">'Mark'</span>;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¼šçœ‹åˆ°ä¸¤ä¸ªå¯¹è±¡éƒ½è¢«ä¿®æ”¹äº†ï¼Œå› ä¸º JavaScript ä¸­çš„å¯¹è±¡æ˜¯é€šè¿‡å¼•ç”¨è€Œä¸æ˜¯å€¼ä¼ é€’çš„ã€‚æ‰€ä»¥å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// prints 'Mark'</span></span><br><span class="line"><span class="built_in">console</span>.log(user.name);</span><br><span class="line"><span class="comment">// prints 'Mark'</span></span><br><span class="line"><span class="built_in">console</span>.log(user1.name);</span><br><span class="line"><span class="comment">// prints true</span></span><br><span class="line"><span class="built_in">console</span>.log(user === user1);</span><br></pre></td></tr></table></figure>
<p>å•ä¾‹æ¨¡å¼å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°å®ç°ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> instance = <span class="literal">null</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">User</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(instance) &#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  instance = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">'Peter'</span>;</span><br><span class="line">  <span class="keyword">this</span>.age = <span class="number">25</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> user1 = <span class="keyword">new</span> User();</span><br><span class="line"><span class="keyword">const</span> user2 = <span class="keyword">new</span> User();</span><br><span class="line"><span class="comment">// prints true</span></span><br><span class="line"><span class="built_in">console</span>.log(user1 === user2);</span><br></pre></td></tr></table></figure>
<p>å½“è°ƒç”¨è¿™ä¸ªæ„é€ å‡½æ•°æ—¶ï¼Œæ£€æŸ¥ <code>instance</code> å¯¹è±¡æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå¯¹è±¡ä¸å­˜åœ¨ï¼Œåˆ™å°† <code>this</code> å˜é‡èµ‹ç»™ <code>instance</code> å˜é‡ã€‚å¦‚æœå¯¹è±¡å­˜åœ¨ï¼Œåˆ™åªè¿”å›é‚£ä¸ªå¯¹è±¡ã€‚</p>
<p>å•ä¾‹æ¨¡å¼ä¹Ÿå¯ä»¥ä½¿ç”¨æ¨¡å—æ¨¡å¼æ¥å®ç°ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> singleton = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> instance;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name: <span class="string">'Peter'</span>,</span><br><span class="line">      age: <span class="number">24</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getInstance: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(!instance) &#123;</span><br><span class="line">        instance = init();</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="keyword">const</span> instanceA = singleton.getInstance();</span><br><span class="line"><span class="keyword">const</span> instanceB = singleton.getInstance();</span><br><span class="line"><span class="comment">// prints true</span></span><br><span class="line"><span class="built_in">console</span>.log(instanceA === instanceB);</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>singleton.getInstance</code> æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚å¦‚æœå®ä¾‹å·²ç»å­˜åœ¨ï¼Œæ­¤æ–¹æ³•åªè¿”å›è¯¥å®ä¾‹ï¼Œå¦‚æœå®ä¾‹ä¸å­˜åœ¨ï¼Œåˆ™é€šè¿‡è°ƒç”¨ <code>init()</code> å‡½æ•°åˆ›å»ºæ–°å®ä¾‹ã€‚</p>
<h2 id="å·¥å‚æ¨¡å¼-Factory-Pattern"><a href="#å·¥å‚æ¨¡å¼-Factory-Pattern" class="headerlink" title="å·¥å‚æ¨¡å¼-Factory Pattern"></a>å·¥å‚æ¨¡å¼-Factory Pattern</h2><p>å·¥å‚æ¨¡å¼ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç¡®åˆ‡ç±»æˆ–æ„é€ å‡½æ•°ã€‚</p>
<p>å·¥å‚æ¨¡å¼ç”¨äºåˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸å…¬å¼€å®ä¾‹åŒ–é€»è¾‘ã€‚å½“æˆ‘ä»¬éœ€è¦æ ¹æ®ç‰¹å®šæ¡ä»¶ç”Ÿæˆä¸åŒçš„å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ¨¡å¼ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="keyword">this</span>.doors = options.doors || <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">this</span>.state = options.state || <span class="string">'brand new'</span>;</span><br><span class="line">    <span class="keyword">this</span>.color = options.color || <span class="string">'white'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Truck</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="keyword">this</span>.doors = options.doors || <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">this</span>.state = options.state || <span class="string">'used'</span>;</span><br><span class="line">    <span class="keyword">this</span>.color = options.color || <span class="string">'black'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VehicleFactory</span> </span>&#123;</span><br><span class="line">  createVehicle(options) &#123;</span><br><span class="line">    <span class="keyword">if</span>(options.vehicleType === <span class="string">'car'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Car(options);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(options.vehicleType === <span class="string">'truck'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Truck(options);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª <code>Car</code> å’Œä¸€ä¸ª <code>Truck</code> ç±»ï¼ˆå¸¦æœ‰ä¸€äº›é»˜è®¤å€¼ï¼‰ï¼Œç”¨äºåˆ›å»ºæ–°çš„ <code>car</code> å’Œ <code>truck</code> å¯¹è±¡ã€‚æˆ‘è¿˜å®šä¹‰äº†ä¸€ä¸ª <code>VehicleFactory</code> ç±»ï¼Œå®ƒæ ¹æ® <code>options</code> å¯¹è±¡ä¸­æ¥æ”¶åˆ°çš„ <code>vehicleType</code> å±æ€§åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> factory = <span class="keyword">new</span> VehicleFactory();</span><br><span class="line"><span class="keyword">const</span> car = factory.createVehicle(&#123;</span><br><span class="line">  vehicleType: <span class="string">'car'</span>,</span><br><span class="line">  doors: <span class="number">4</span>,</span><br><span class="line">  color: <span class="string">'silver'</span>,</span><br><span class="line">  state: <span class="string">'Brand New'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> truck= factory.createVehicle(&#123;</span><br><span class="line">  vehicleType: <span class="string">'truck'</span>,</span><br><span class="line">  doors: <span class="number">2</span>,</span><br><span class="line">  color: <span class="string">'white'</span>,</span><br><span class="line">  state: <span class="string">'used'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Prints Car &#123;doors: 4, state: "Brand New", color: "silver"&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(car);</span><br><span class="line"><span class="comment">// Prints Truck &#123;doors: 2, state: "used", color: "white"&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(truck);</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åŸºäº <code>VehicleFactory</code> ç±»åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ <code>factory</code>ã€‚ç„¶åé€šè¿‡è°ƒç”¨ <code>factory.createVehicle</code>ï¼Œä¼ å…¥å¸¦æœ‰ <code>vehicleType</code> å±æ€§çš„ <code>options</code> å¯¹è±¡å‚æ•°ï¼Œåˆ›å»ºäº†æ–°çš„ <code>car</code> å’Œ <code>truck</code> å¯¹è±¡ã€‚</p>
<h2 id="è£…é¥°è€…æ¨¡å¼-Decorator-Pattern"><a href="#è£…é¥°è€…æ¨¡å¼-Decorator-Pattern" class="headerlink" title="è£…é¥°è€…æ¨¡å¼-Decorator Pattern"></a>è£…é¥°è€…æ¨¡å¼-Decorator Pattern</h2><p>è£…é¥°è€…æ¨¡å¼ç”¨äºæ‰©å±•å¯¹è±¡çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€ä¿®æ”¹ç°æœ‰çš„ç±»æˆ–æ„é€ å‡½æ•°ã€‚æ­¤æ¨¡å¼å¯ç”¨äºå‘å¯¹è±¡æ·»åŠ ç‰¹æ€§ï¼Œè€Œæ— éœ€ä¿®æ”¹åº•å±‚ä»£ç ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„ä¾‹å­å¦‚ä¸‹:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="comment">// Default values</span></span><br><span class="line">  <span class="keyword">this</span>.color = <span class="string">'White'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Creating a new Object to decorate</span></span><br><span class="line"><span class="keyword">const</span> tesla= <span class="keyword">new</span> Car(<span class="string">'Tesla Model 3'</span>);</span><br><span class="line"><span class="comment">// Decorating the object with new functionality</span></span><br><span class="line">tesla.setColor = <span class="function"><span class="keyword">function</span>(<span class="params">color</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.color = color;</span><br><span class="line">&#125;</span><br><span class="line">tesla.setPrice = <span class="function"><span class="keyword">function</span>(<span class="params">price</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.price = price;</span><br><span class="line">&#125;</span><br><span class="line">tesla.setColor(<span class="string">'black'</span>);</span><br><span class="line">tesla.setPrice(<span class="number">49000</span>);</span><br><span class="line"><span class="comment">// prints black</span></span><br><span class="line"><span class="built_in">console</span>.log(tesla.color);</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ¨¡å¼çš„ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­æ˜¯ï¼š</p>
<p>æ¯”æ–¹è¯´ï¼Œä¸€è¾†è½¦çš„ä»·æ ¼å–å†³äºå®ƒæœ‰å¤šå°‘åŠŸèƒ½ã€‚å¦‚æœæ²¡æœ‰è£…é¥°è€…æ¨¡å¼ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ä¸ºä¸åŒçš„ç‰¹æ€§ç»„åˆåˆ›å»ºä¸åŒçš„ç±»ï¼Œæ¯ä¸ªç±»éƒ½æœ‰è®¡ç®—æˆæœ¬çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span>() </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarWithAC</span>() </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarWithAutoTransmission</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarWithPowerLocks</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarWithACandPowerLocks</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ä½¿ç”¨è£…é¥°è€…æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåŸºç±» <code>Car</code>ï¼Œå¹¶ä½¿ç”¨è£…é¥°å‡½æ•°å‘å…¶å¯¹è±¡æ·»åŠ ä¸åŒé…ç½®çš„æˆæœ¬ã€‚ä¾‹å¦‚:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">  <span class="comment">// Default Cost</span></span><br><span class="line">  <span class="keyword">this</span>.cost = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">20000</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Decorator function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">carWithAC</span>(<span class="params">car</span>) </span>&#123;</span><br><span class="line">  car.hasAC = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">const</span> prevCost = car.cost();</span><br><span class="line">  car.cost = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> prevCost + <span class="number">500</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Decorator function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">carWithAutoTransmission</span>(<span class="params">car</span>) </span>&#123;</span><br><span class="line">  car.hasAutoTransmission = <span class="literal">true</span>;</span><br><span class="line">   <span class="keyword">const</span> prevCost = car.cost();</span><br><span class="line">  car.cost = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> prevCost + <span class="number">2000</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Decorator function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">carWithPowerLocks</span>(<span class="params">car</span>) </span>&#123;</span><br><span class="line">  car.hasPowerLocks = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">const</span> prevCost = car.cost();</span><br><span class="line">  car.cost = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> prevCost + <span class="number">500</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºç±» <code>Car</code> ç”¨æ¥åˆ›å»º <code>car</code> å¯¹è±¡ã€‚ç„¶åï¼Œä¸ºè¦æ·»åŠ çš„ç‰¹æ€§åˆ›å»ºè£…é¥°å™¨ï¼Œå¹¶å°† <code>Car</code> å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ã€‚ç„¶åï¼Œæˆ‘ä»¬é‡å†™è¯¥å¯¹è±¡çš„ <code>cost</code> å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å› <code>car</code> æ›´æ–°åçš„æˆæœ¬ï¼Œå¹¶å‘è¯¥å¯¹è±¡æ·»åŠ ä¸€ä¸ªæ–°å±æ€§ï¼Œç”¨æ¥è¡¨æ˜æ·»åŠ äº†å“ªäº›ç‰¹æ€§ã€‚</p>
<p>è¦æ·»åŠ æ–°ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> car = <span class="keyword">new</span> Car();</span><br><span class="line"><span class="built_in">console</span>.log(car.cost());</span><br><span class="line">carWithAC(car);</span><br><span class="line">carWithAutoTransmission(car);</span><br><span class="line">carWithPowerLocks(car);</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¡ç®—æ±½è½¦çš„æˆæœ¬ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Calculating total cost of the car</span></span><br><span class="line"><span class="built_in">console</span>.log(car.cost());</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬å·²ç»äº†è§£äº† JavaScript ä¸­ä½¿ç”¨çš„å„ç§è®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€äº›è®¾è®¡æ¨¡å¼æ²¡æœ‰åœ¨è¿™é‡Œä»‹ç»ï¼Œå®ƒä»¬å¯ä»¥åœ¨JavaScript ä¸­å®ç°ã€‚</p>
<p>è™½ç„¶äº†è§£å„ç§è®¾è®¡æ¨¡å¼å¾ˆé‡è¦ï¼Œä½†åŒæ ·é‡è¦çš„æ˜¯ä¸è¦è¿‡åº¦ä½¿ç”¨å®ƒä»¬ã€‚åœ¨ä½¿ç”¨è®¾è®¡æ¨¡å¼ä¹‹å‰ï¼Œä½ åº”è¯¥ä»”ç»†è€ƒè™‘ä½ çš„é—®é¢˜æ˜¯å¦ç¬¦åˆè®¾è®¡æ¨¡å¼ã€‚è¦æƒ³çŸ¥é“æŸä¸ªæ¨¡å¼æ˜¯å¦é€‚åˆä½ çš„é—®é¢˜ï¼Œè¯·äº†è§£è¯¥æ¨¡å¼è§£å†³äº†å“ªäº›é—®é¢˜ï¼Œå¹¶æ£€æŸ¥ä½ æ˜¯å¦å®é™…é¢ä¸´ç±»ä¼¼çš„é—®é¢˜ã€‚</p>
<p>åŸæ–‡ï¼š<a href="https://blog.bitsrc.io/understanding-design-patterns-in-javascript-13345223f2dd" target="_blank" rel="noopener">https://blog.bitsrc.io/understanding-design-patterns-in-javascript-13345223f2dd</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/04/examples/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›¯å­">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Athena">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/04/examples/" itemprop="url">
                  ã€è¯‘ã€‘é€šè¿‡ä¾‹å­è§£é‡Š Debounce å’Œ Throttle
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-04 16:11:09 / ä¿®æ”¹æ—¶é—´ï¼š16:13:03" itemprop="dateCreated datePublished" datetime="2018-11-04T16:11:09+08:00">2018-11-04</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>Debounce</strong> å’Œ <strong>Throttle</strong> æ˜¯ä¸¤ä¸ªå¾ˆç›¸ä¼¼ä½†æ˜¯åˆä¸åŒçš„æŠ€æœ¯ï¼Œéƒ½å¯ä»¥æ§åˆ¶ä¸€ä¸ªå‡½æ•°åœ¨ä¸€æ®µæ—¶é—´å†…æ‰§è¡Œçš„æ¬¡æ•°ã€‚</p>
<p>å½“æˆ‘ä»¬åœ¨æ“ä½œ DOM äº‹ä»¶çš„æ—¶å€™ï¼Œä¸ºå‡½æ•°æ·»åŠ  debounce æˆ–è€… throttle å°±ä¼šå°¤ä¸ºæœ‰ç”¨ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘ä»¬åœ¨äº‹ä»¶å’Œå‡½æ•°æ‰§è¡Œä¹‹é—´åŠ äº†ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„æ§åˆ¶å±‚ã€‚è®°ä½ï¼Œæˆ‘ä»¬æ˜¯ä¸å»æ§åˆ¶è¿™äº› DOM äº‹ä»¶è§¦å‘çš„é¢‘ç‡çš„ï¼Œå› ä¸ºè¿™ä¸ªå¯èƒ½ä¼šæœ‰å˜åŒ–ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬ä»¥æ»šåŠ¨äº‹ä»¶ä¸¾ä¾‹ï¼š</p>
<iframe height="265" scrolling="no" title="Scroll events counter" src="//codepen.io/athena0304/embed/Yjbqar/?height=265&theme-id=0&default-tab=css,result&embed-version=2" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 100%;">See the Pen <a href="https://codepen.io/athena0304/pen/Yjbqar/" target="_blank" rel="noopener">Scroll events counter</a> by Athena (<a href="https://codepen.io/athena0304" target="_blank" rel="noopener">@athena0304</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.<br></iframe>

<p>å½“ä½¿ç”¨è§¦æ§æ¿ã€é¼ æ ‡æ»šè½®ï¼Œæˆ–è€…ç›´æ¥æ‹½åŠ¨æ»šåŠ¨æ¡ï¼Œæ¯ç§’éƒ½å¯ä»¥è½»æ˜“è§¦å‘è‡³å°‘30æ¬¡äº‹ä»¶ï¼Œè€Œä¸”åœ¨è§¦å±çš„ç§»åŠ¨ç«¯ï¼Œç”šè‡³ä¼šè¾¾åˆ°æ¯ç§’100æ¬¡ï¼Œé¢å¯¹è¿™æ ·é«˜çš„æ‰§è¡Œé¢‘ç‡ï¼Œä½ çš„æ»šåŠ¨äº‹ä»¶å¤„ç†ç¨‹åºèƒ½å¦å¾ˆå¥½åœ°åº”å¯¹ï¼Ÿ</p>
<p>åœ¨2011å¹´ï¼ŒTwitter ç½‘ç«™æå‡ºäº†ä¸€ä¸ª issueï¼šå½“å‘ä¸‹æ»šåŠ¨ Twitter ä¿¡æ¯æµçš„æ—¶å€™ï¼Œæ•´ä¸ªé¡µé¢çš„å“åº”é€Ÿåº¦éƒ½ä¼šå˜æ…¢ã€‚ John Resig åŸºäºè¯¥é—®é¢˜å‘è¡¨äº†ä¸€ç¯‡<a href="http://ejohn.org/blog/learning-from-twitter" target="_blank" rel="noopener">åšå®¢</a>ï¼Œæ–‡ä¸­æŒ‡å‡ºï¼Œç›´æ¥åœ¨ <code>scroll</code> äº‹ä»¶é‡ŒæŒ‚è½½ä¸€äº›è®¡ç®—é‡å¤§çš„å‡½æ•°æ˜¯ä»¶å¤šä¹ˆä¸æ˜æ™ºçš„è¡Œä¸ºã€‚</p>
<p>John å½“æ—¶æå‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ <code>onScroll event</code> çš„å¤–éƒ¨è®¾ç½®ä¸€ä¸ªæ¯ 250ms æ‰§è¡Œä¸€æ¬¡çš„å¾ªç¯ã€‚è¿™æ ·å¤„ç†ç¨‹åºå°±ä¸äº‹ä»¶è§£è€¦äº†ã€‚ä½¿ç”¨è¿™æ ·ä¸€ä¸ªç®€å•çš„æŠ€æœ¯å°±å¯ä»¥é¿å…ç ´åç”¨æˆ·ä½“éªŒã€‚</p>
<p>::: tip è¯‘è€…æ³¨</p>
<p>æ–‡ä¸­çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> outerPane = $details.find(<span class="string">".details-pane-outer"</span>),</span><br><span class="line">    didScroll = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">window</span>).scroll(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    didScroll = <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( didScroll ) &#123;</span><br><span class="line">        didScroll = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// Check your page position and then</span></span><br><span class="line">        <span class="comment">// Load in more results</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">250</span>);</span><br></pre></td></tr></table></figure>
<p>:::</p>
<p>å¦‚ä»Šï¼Œå¤„ç†äº‹ä»¶çš„æ–¹å¼ç¨å¾®å¤æ‚äº†ä¸€äº›ã€‚ä¸‹é¢æˆ‘ä»¬ç»“åˆç”¨ä¾‹ï¼Œä¸€ä¸€ä»‹ç» Debounceã€ Throttle å’ŒrequestAnimationFrameã€‚</p>
<h3 id="Debounce"><a href="#Debounce" class="headerlink" title="Debounce"></a>Debounce</h3><p>Debounce å…è®¸æˆ‘ä»¬å°†å¤šä¸ªè¿ç»­çš„è°ƒç”¨åˆå¹¶æˆä¸€ä¸ªã€‚</p>
<p><img src="https://css-tricks.com/wp-content/uploads/2016/04/debounce.png" alt="img"></p>
<p>æƒ³è±¡ä¸€ä¸ªè¿›ç”µæ¢¯çš„åœºæ™¯ï¼Œä½ èµ°è¿›äº†ç”µæ¢¯ï¼Œé—¨åˆšè¦å…³ä¸Šï¼Œè¿™æ—¶å¦ä¸€ä¸ªäººæƒ³è¦è¿›æ¥ï¼Œäºæ˜¯ç”µæ¢¯æ²¡æœ‰ç§»åŠ¨æ¥¼å±‚ï¼ˆå¤„ç†å‡½æ•°ï¼‰ï¼Œè€Œæ˜¯å°†é—¨æ‰“å¼€è®©é‚£ä¸ªäººè¿›æ¥ã€‚è¿™æ—¶åˆæœ‰ä¸€ä¸ªäººè¦è¿›æ¥ï¼Œå°±åˆä¼šä¸Šæ¼”åˆšæ‰é‚£ä¸€å¹•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”µæ¢¯å»¶è¿Ÿäº†å®ƒçš„å‡½æ•°ï¼ˆç§»åŠ¨æ¥¼å±‚ï¼‰æ‰§è¡Œï¼Œä½†æ˜¯ä¼˜åŒ–äº†èµ„æºã€‚</p>
<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå°è¯•å¿«é€Ÿç‚¹å‡»æŒ‰é’®æˆ–è€…åœ¨ä¸Šé¢æ»‘åŠ¨ï¼š</p>
<iframe height="265" scrolling="no" title="Debounce. Trailing" src="//codepen.io/athena0304/embed/NBVjRB/?height=265&theme-id=0&default-tab=css,result&embed-version=2" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 100%;">See the Pen <a href="https://codepen.io/athena0304/pen/NBVjRB/" target="_blank" rel="noopener">Debounce. Trailing</a> by Athena (<a href="https://codepen.io/athena0304" target="_blank" rel="noopener">@athena0304</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.<br></iframe>

<p>ä½ å¯ä»¥çœ‹åˆ°è¿ç»­å¿«é€Ÿäº‹ä»¶æ˜¯æ€æ ·è¢«ä¸€ä¸ªå•ç‹¬çš„ debounce äº‹ä»¶æ‰€æ›¿ä»£çš„ã€‚ä½†æ˜¯å¦‚æœäº‹ä»¶è§¦å‘æ—¶é—´é—´éš”è¾ƒé•¿ï¼Œå°±ä¸ä¼šå‘ç”Ÿ debounceã€‚</p>
<h4 id="Leading-è¾¹ç¼˜-æˆ–è€…-â€œimmediateâ€"><a href="#Leading-è¾¹ç¼˜-æˆ–è€…-â€œimmediateâ€" class="headerlink" title="Leading è¾¹ç¼˜ (æˆ–è€… â€œimmediateâ€)"></a>Leading è¾¹ç¼˜ (æˆ–è€… â€œimmediateâ€)</h4><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½ ä¼šå‘ç° debounce äº‹ä»¶ä¼šç­‰åˆ°å¿«é€Ÿäº‹ä»¶åœæ­¢å‘ç”Ÿåæ‰ä¼šè§¦å‘å‡½æ•°æ‰§è¡Œã€‚ä¸ºä»€ä¹ˆä¸åœ¨æ¯æ¬¡ä¸€å¼€å§‹å°±ç«‹å³è§¦å‘å‡½æ•°æ‰§è¡Œå‘¢ï¼Œè¿™æ ·å®ƒçš„è¡¨ç°å°±å’ŒåŸå§‹çš„æ²¡æœ‰å»æŠ–çš„å¤„ç†å™¨ä¸€æ ·äº†ã€‚ç›´åˆ°å¿«é€Ÿè°ƒç”¨å‡ºç°åœé¡¿çš„æ—¶å€™ï¼Œæ‰ä¼šå†æ¬¡è§¦å‘ã€‚</p>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨ <code>leading</code> æ ‡è¯†ç¬¦çš„ä¾‹å­ï¼š</p>
<p><img src="https://css-tricks.com/wp-content/uploads/2016/04/debounce-leading.png" alt="img"></p>
<p>åœ¨ underscore.js ä¸­ï¼Œè¯¥é€‰é¡¹å«ä½œ <code>immediate</code> ï¼Œè€Œä¸æ˜¯  <code>leading</code>ã€‚</p>
<p>è‡ªå·±è¯•ä¸€ä¸‹ï¼š</p>
<iframe height="265" scrolling="no" title="Debounce. Leading" src="//codepen.io/athena0304/embed/mGbgGo/?height=265&theme-id=0&default-tab=css,result&embed-version=2" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 100%;">See the Pen <a href="https://codepen.io/athena0304/pen/mGbgGo/" target="_blank" rel="noopener">Debounce. Leading</a> by Athena (<a href="https://codepen.io/athena0304" target="_blank" rel="noopener">@athena0304</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.<br></iframe>



<h4 id="Debounce-çš„å®ç°"><a href="#Debounce-çš„å®ç°" class="headerlink" title="Debounce çš„å®ç°"></a>Debounce çš„å®ç°</h4><p>Debounce çš„æ¦‚å¿µå’Œå®ç°æœ€æ—©æ˜¯ç”± <a href="http://unscriptable.com/2009/03/20/debouncing-javascript-methods/" target="_blank" rel="noopener">John Hann</a> åœ¨2009å¹´æå‡ºæ¥çš„ã€‚</p>
<p>ä¸ä¹…ä¹‹åï¼ŒBen Alman å°±å†™äº†ä¸€ä¸ª <a href="http://benalman.com/projects/jquery-throttle-debounce-plugin/" target="_blank" rel="noopener">jQuery æ’ä»¶</a>ï¼ˆç°åœ¨å·²ç»ä¸å†ç»´æŠ¤äº†ï¼‰ï¼Œä¸€å¹´ä¹‹å Jeremy Ashkenas æŠŠå®ƒæ·»åŠ è¿›äº† underscore.jsã€‚å†åæ¥è¢«æ·»åŠ è¿› Lodashã€‚</p>
<p>è¿™ä¸‰ä¸ªå®ç°åœ¨å†…éƒ¨æœ‰ä¸€ç‚¹ä¸åŒï¼Œä½†æ˜¯æ¥å£å‡ ä¹æ˜¯ç›¸åŒçš„ã€‚</p>
<p>æ›¾ç»æœ‰ä¸€æ®µæ—¶é—´ï¼Œunderscore é‡‡å–äº† Lodash é‡Œé¢çš„ debounce/throttle å®ç°ï¼Œä½†æ˜¯åæ¥æˆ‘åœ¨2013å¹´å‘ç°äº†  <code>_.debounce</code> å‡½æ•°çš„ä¸€ä¸ª bugã€‚ä»é‚£æ—¶èµ·ï¼Œè¿™ä¸¤ç§å®ç°å°±å‡ºç°åˆ†åŒ–äº†ã€‚</p>
<p>Lodash ä¸º  <code>_.debounce</code> å’Œ <code>_.throttle</code>  æ·»åŠ äº†æ›´å¤šçš„ç‰¹æ€§ã€‚æœ€åˆçš„  <code>immediate</code> æ ‡è¯†ç¬¦è¢« <code>leading</code> å’Œ <code>trailing</code>æ‰€æ›¿ä»£ã€‚ä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªé€‰é¡¹ï¼Œä¹Ÿå¯ä»¥ä¸¤ä¸ªéƒ½è¦ã€‚é»˜è®¤æƒ…å†µä¸‹ <code>trailing</code> æ˜¯è¢«å¼€å¯çš„ã€‚</p>
<p>æ–°çš„  <code>maxWait</code> é€‰é¡¹ï¼ˆç›®å‰åªå­˜åœ¨äºLodashï¼‰åœ¨æœ¬æ–‡ä¸­æ²¡æœ‰æåŠï¼Œä½†æ˜¯å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„é€‰é¡¹ã€‚å®é™…ä¸Šï¼Œthrottle å‡½æ•°å°±æ˜¯ä½¿ç”¨  <code>_.debounce</code> å¸¦ç€ <code>maxWait</code> çš„é€‰é¡¹æ¥å®šä¹‰çš„ï¼Œä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹<a href="https://github.com/lodash/lodash/blob/4.8.0-npm/throttle.js" target="_blank" rel="noopener">æºç </a>ã€‚</p>
<h4 id="Debounce-ä¸¾ä¾‹"><a href="#Debounce-ä¸¾ä¾‹" class="headerlink" title="Debounce ä¸¾ä¾‹"></a>Debounce ä¸¾ä¾‹</h4><h5 id="Resize-ä¸¾ä¾‹"><a href="#Resize-ä¸¾ä¾‹" class="headerlink" title="Resize ä¸¾ä¾‹"></a>Resize ä¸¾ä¾‹</h5><p>é€šè¿‡æ‹–æ‹½æµè§ˆå™¨çª—å£ï¼Œå¯ä»¥è§¦å‘å¾ˆå¤šæ¬¡ <code>resize</code> äº‹ä»¶ã€‚</p>
<p>ä¾‹å­å¦‚ä¸‹ï¼š</p>
<iframe height="265" scrolling="no" title="Debounce Resize Event Example" src="//codepen.io/athena0304/embed/KxPLZy/?height=265&theme-id=0&default-tab=js,result&embed-version=2" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 100%;">See the Pen <a href="https://codepen.io/athena0304/pen/KxPLZy/" target="_blank" rel="noopener">Debounce Resize Event Example</a> by Athena (<a href="https://codepen.io/athena0304" target="_blank" rel="noopener">@athena0304</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.<br></iframe><br>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨ resize äº‹ä»¶ä¸Šä½¿ç”¨çš„æ˜¯é»˜è®¤çš„  <code>trailing</code> é€‰é¡¹ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦å…³å¿ƒç”¨æˆ·åœæ­¢è°ƒæ•´æµè§ˆå™¨åçš„æœ€ç»ˆç»“æœå°±å¯ä»¥äº†ã€‚<br><br>##### æ•²å‡»é”®ç›˜ï¼Œé€šè¿‡ Ajax è¯·æ±‚è‡ªåŠ¨å¡«å……è¡¨å•<br><br>ä¸ºä»€ä¹ˆè¦åœ¨ç”¨æˆ·è¿˜åœ¨è¾“å…¥çš„æ—¶å€™æ¯éš” 50ms å°±å‘é€ä¸€æ¬¡ Ajaxè¯·æ±‚ï¼Ÿ<code>_.debounce</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬é¿å…é¢å¤–çš„å¼€é”€ï¼Œåªæœ‰å½“ç”¨æˆ·åœæ­¢è¾“å…¥äº†å†å‘é€è¯·æ±‚ã€‚<br><br>è¿™é‡Œæ²¡æœ‰å¿…è¦è®¾ç½®  <code>leading</code>ï¼Œæˆ‘ä»¬æ˜¯æƒ³è¦ç­‰åˆ°æœ€åä¸€ä¸ªå­—ç¬¦è¾“å…¥å®Œå†æ‰§è¡Œå‡½æ•°çš„ã€‚<br><br><iframe height="265" scrolling="no" title="Debouncing keystrokes Example" src="//codepen.io/athena0304/embed/NLKVZw/?height=265&theme-id=0&default-tab=js,result&embed-version=2" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 100%;">See the Pen <a href="https://codepen.io/athena0304/pen/NLKVZw/" target="_blank" rel="noopener">Debouncing keystrokes Example</a> by Athena (<a href="https://codepen.io/athena0304" target="_blank" rel="noopener">@athena0304</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.<br></iframe><br>è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯è¡¨å•æ ¡éªŒï¼Œå½“ç”¨æˆ·è¾“å…¥å®Œå†è¿›è¡Œæ ¡éªŒã€æç¤ºä¿¡æ¯ç­‰ã€‚<br><br>#### å¦‚ä½•ä½¿ç”¨ debounce å’Œ throttleï¼Œä»¥åŠå¸¸è§é—®é¢˜<br><br>è¯´äº†è¿™ä¹ˆå¤šï¼Œä½ å¯èƒ½å·²ç»æƒ³è‡ªå·±æ¥å†™ debounce/throttle å‡½æ•°äº†ï¼Œæˆ–è€…æ˜¯ä»ç½‘ä¸Šéšä¾¿ä¸€ç¯‡åšå®¢ä¸Šæ‹·è´ä¸€ä»½ä¸‹æ¥ã€‚<strong>ä½†æ˜¯æˆ‘ç»™ä½ çš„å»ºè®®æ˜¯ç›´æ¥ä½¿ç”¨ underscore æˆ–è€… Lodashã€‚</strong> å¦‚æœä½ åªæ˜¯éœ€è¦ <code>_.debounce</code> å’Œ <code>_.throttle</code> å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://lodash.com/custom-builds" target="_blank" rel="noopener">Lodash custom builder</a> æ¥è¾“å‡ºä¸€ä¸ªè‡ªå®šä¹‰çš„å‹ç¼©åä¸º 2KB çš„åº“ã€‚å¯ä»¥ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æ¥è¿›è¡Œæ„å»ºï¼š<br><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i -g lodash-cli</span><br><span class="line">lodash include = debounce, throttle</span><br></pre></td></tr></table></figure><br><br>ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€å¥½æ˜¯ä½¿ç”¨æ¨¡å—åŒ–çš„å½¢å¼ï¼Œé€šè¿‡ webpack/browserify/rollup æ¥å¼•ç”¨ï¼Œå¦‚ <code>lodash/throttle</code> å’Œ <code>lodash/debounce</code> æˆ– <code>lodash.throttle</code> å’Œ <code>lodash.debounce</code> ã€‚<br><br>ä½¿ç”¨ <code>_.debounce</code> å‡½æ•°çš„ä¸€ä¸ªå¸¸è§é”™è¯¯å°±æ˜¯å¤šæ¬¡è°ƒç”¨å®ƒï¼š<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'scroll'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   _.debounce(doSomething, <span class="number">300</span>); </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'scroll'</span>, _.debounce(doSomething, <span class="number">200</span>));</span><br></pre></td></tr></table></figure><br><br>ä¸º debounced å‡½æ•°åˆ›å»ºä¸€ä¸ªå˜é‡å¯ä»¥è®©æˆ‘ä»¬è°ƒç”¨ç§æœ‰å‡½æ•° <code>debounced_version.cancel()</code>ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œlodash å’Œ underscore.js éƒ½å¯ä»¥ä¾›ä½ ä½¿ç”¨ã€‚<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> debounced_version = _.debounce(doSomething, <span class="number">200</span>);</span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'scroll'</span>, debounced_version);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœä½ éœ€è¦çš„è¯</span></span><br><span class="line">debounced_version.cancel();</span><br></pre></td></tr></table></figure><br><br>### Throttle<br><br>ä½¿ç”¨ <code>_.throttle</code> åˆ™ä¸å…è®¸å‡½æ•°æ¯ X æ¯«ç§’çš„æ‰§è¡Œæ¬¡æ•°è¶…è¿‡ä¸€æ¬¡ã€‚<br><br>Throttle å’Œ debounce æœ€ä¸»è¦çš„åŒºåˆ«å°±æ˜¯ throttle ä¿è¯å‡½æ•°æ¯ X æ¯«ç§’è‡³å°‘æ‰§è¡Œä¸€æ¬¡ã€‚<br><br>å’Œ debounce ä¸€æ ·ï¼Œ throttle ä¹Ÿç”¨åœ¨äº† Ben çš„æ’ä»¶ã€underscore.js å’Œ lodashé‡Œé¢ã€‚<br><br>#### Throttling ä¸¾ä¾‹<br><br>##### æ— é™æ»šåŠ¨<br><br>è¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„ä¾‹å­ã€‚ç”¨æˆ·åœ¨ä¸€ä¸ªæ— é™æ»šåŠ¨çš„é¡µé¢é‡Œå‘ä¸‹æ»šåŠ¨ï¼Œä½ éœ€è¦çŸ¥é“å½“å‰æ»šåŠ¨çš„ä½ç½®è·ç¦»åº•éƒ¨è¿˜æœ‰å¤šè¿œï¼Œå¦‚æœæ¥è¿‘åº•éƒ¨äº†ï¼Œæˆ‘ä»¬å°±å¾—é€šè¿‡ Ajax è¯·æ±‚è·å–æ›´å¤šçš„å†…å®¹ï¼Œå°†å…¶æ·»åŠ åˆ°é¡µé¢é‡Œã€‚<br><br>æ­¤æ—¶æˆ‘ä»¬ä¹‹å‰çš„ <code>_.debounce</code> å°±æ´¾ä¸ä¸Šä½œç”¨äº†ã€‚ä½¿ç”¨ debounce åªæœ‰å½“ç”¨æˆ·åœæ­¢æ»šåŠ¨æ—¶æ‰èƒ½è§¦å‘ï¼Œè€Œæˆ‘ä»¬éœ€è¦çš„æ˜¯åœ¨ç”¨æˆ·æ»šåŠ¨åˆ°åº•éƒ¨ä¹‹å‰å°±å¼€å§‹è·å–å†…å®¹ã€‚<br><br>ä½¿ç”¨ <code>_.throttle</code> å°±èƒ½ç¡®ä¿å®æ—¶æ£€æŸ¥è·ç¦»åº•éƒ¨è¿˜æœ‰å¤šè¿œã€‚<br><br>### requestAnimationFrame (rAF)<br><br><code>requestAnimationFrame</code> æ˜¯å¦ä¸€ç§é™åˆ¶å‡½æ•°æ‰§è¡Œé€Ÿåº¦çš„æ–¹æ³•ã€‚<br><br>å®ƒå¯ä»¥è¢«çœ‹åš <code>_.throttle(dosomething, 16)</code>ã€‚ä½†å®ƒæœ‰ç€æ›´é«˜çš„ä¿çœŸåº¦ï¼Œå› ä¸ºå®ƒæ˜¯æµè§ˆå™¨çš„åŸç”Ÿ APIï¼Œæœ‰ç€æ›´å¥½çš„ç²¾åº¦ã€‚<br><br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ rAF APIï¼Œä½œä¸º throttle å‡½æ•°çš„æ›¿ä»£ï¼Œè€ƒè™‘ä¸‹é¢çš„ä¼˜ç¼ºç‚¹ï¼š<br><br>#### ä¼˜ç‚¹<br><br>- ç›®æ ‡æ˜¯ 60fpsï¼ˆæ¯å¸§ 16msï¼‰ï¼Œä½†æ˜¯ä¼šåœ¨æµè§ˆå™¨å†…éƒ¨å†³å®šå¦‚ä½•å®‰æ’æ¸²æŸ“çš„æœ€ä½³æ—¶æœºã€‚<br>- éå¸¸ç®€å•ï¼Œè€Œä¸”æ˜¯æ ‡å‡† APIï¼Œåœ¨æœªæ¥ä¹Ÿä¸ä¼šæ”¹å˜ã€‚æ›´å°‘çš„ç»´æŠ¤æˆæœ¬ã€‚<br><br>#### ç¼ºç‚¹<br><br>- rAFs çš„å¼€å§‹/å–æ¶ˆç”±æˆ‘ä»¬è‡ªå·±æ¥ç®¡ç†ï¼Œè€Œä¸åƒ  <code>.debounce</code> å’Œ <code>.throttle</code> æ˜¯åœ¨å†…éƒ¨ç®¡ç†çš„ã€‚<br>- å¦‚æœæµè§ˆå™¨çš„ tab é¡µé¢ä¸æ´»è·ƒäº†ï¼Œå®ƒå°±ä¸ä¼šå†æ‰§è¡Œã€‚<br>- è™½ç„¶æ‰€æœ‰çš„ç°ä»£æµè§ˆå™¨éƒ½æä¾›äº† rAFï¼Œ ä½†æ˜¯ IE9ã€Opera Mini å’Œä¸€äº›è€çš„å®‰å“ç‰ˆæœ¬è¿˜ä¸æ”¯æŒã€‚å¦‚æœéœ€è¦ï¼Œç°åœ¨è¿˜æ˜¯è¦ä½¿ç”¨ <a href="http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/" target="_blank" rel="noopener">polyfill</a> ã€‚<br>- Node.js ä¸æ”¯æŒ rAFï¼Œæ‰€ä»¥ä¸èƒ½åœ¨æœåŠ¡ç«¯ç”¨äº throttle æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ã€‚<br><br>æ ¹æ®ç»éªŒï¼Œå¦‚æœä½ çš„ JavaScript å‡½æ•°æ˜¯åœ¨ç»˜åˆ¶æˆ–è€…ç›´æ¥æ”¹å˜å±æ€§ï¼Œæ‰€æœ‰æ¶‰åŠåˆ°å…ƒç´ ä½ç½®é‡æ–°è®¡ç®—çš„ï¼Œæˆ‘ä¼šå»ºè®®ä½¿ç”¨  <code>requestAnimationFrame</code>ï¼Œ<br><br>å¦‚æœæ˜¯å¤„ç† Ajax è¯·æ±‚ï¼Œæˆ–è€…å†³å®šæ˜¯å¦æ·»åŠ /åˆ é™¤æŸä¸ª classï¼ˆå¯èƒ½ä¼šè§¦å‘ä¸€ä¸ª CSS åŠ¨ç”»ï¼‰ï¼Œæˆ‘ä¼šè€ƒè™‘ <code>_.debounce</code> å’Œ <code>_.throttle</code>ï¼Œè¿™é‡Œå¯ä»¥è®¾ç½®æ›´ä½ä¸€äº›çš„æ‰§è¡Œé€Ÿåº¦ï¼ˆä¾‹å¦‚ 200msï¼Œè€Œä¸æ˜¯16msï¼‰ã€‚<br><br>è¿™æ—¶ä½ å¯èƒ½ä¼šæƒ³ï¼Œä¸ºä»€ä¸æŠŠ rAF é›†æˆåˆ° underscore æˆ– lodash é‡Œå‘¢ï¼Œé‚£ä»–ä¿©éƒ½æ˜¯æ‹’ç»çš„ï¼Œå› ä¸ºè¿™åªæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä½¿ç”¨åœºæ™¯ï¼Œè€Œä¸”å·²ç»è¶³å¤Ÿç®€å•ï¼Œå¯ä»¥è¢«ç›´æ¥è°ƒç”¨ã€‚<br><br>#### rAF ä¸¾ä¾‹<br><br>å—<a href="http://www.html5rocks.com/en/tutorials/speed/animations/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>çš„å¯å‘ï¼Œåœ¨è¿™é‡Œæˆ‘ä¼šä¸¾ä¸€ä¸ªæ»šåŠ¨çš„ä¾‹å­ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­æœ‰æ¯ä¸ªæ­¥éª¤çš„é€»è¾‘è§£é‡Šã€‚<br><br>æˆ‘åšäº†ä¸€ä¸ªå¯¹æ¯”å®éªŒï¼Œä¸€è¾¹æ˜¯ rAFï¼Œä¸€è¾¹æ˜¯ 16ms é—´éš”çš„ <code>_.throttle</code>ã€‚å®ƒä»¬æ€§èƒ½å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ rAF å¯èƒ½ä¼šåœ¨æ›´å¤æ‚çš„åœºæ™¯ä¸‹æ€§èƒ½æ›´é«˜ä¸€äº›ã€‚<br><br><iframe height="265" scrolling="no" title="Scroll comparison requestAnimationFrame vs throttle" src="//codepen.io/dcorb/embed/pgOKKw/?height=265&theme-id=0&default-tab=js,result&embed-version=2" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 100%;">See the Pen <a href="https://codepen.io/dcorb/pen/pgOKKw/" target="_blank" rel="noopener">Scroll comparison requestAnimationFrame vs throttle</a> by Corbacho (<a href="https://codepen.io/dcorb" target="_blank" rel="noopener">@dcorb</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.<br></iframe>

<p>è¿˜æœ‰ä¸€ä¸ªæ›´é«˜çº§çš„ä¾‹å­ï¼Œåœ¨ headroom.js ä¸­ï¼Œé€»è¾‘è¢«<a href="https://github.com/WickyNilliams/headroom.js/blob/3282c23bc69b14f21bfbaf66704fa37b58e3241d/src/Debouncer.js" target="_blank" rel="noopener">è§£è€¦</a>äº†ï¼Œå¹¶ä¸”åŒ…è£¹åœ¨äº†å¯¹è±¡ä¸­ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä½¿ç”¨ debounceã€throttle å’Œ  <code>requestAnimationFrame</code>  æ¥ä¼˜åŒ–ä½ çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚æ¯ç§æŠ€æœ¯éƒ½æœ‰äº›è®¸çš„ä¸åŒï¼Œä½†æ˜¯ä¸‰ä¸ªéƒ½æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œè€Œä¸”èƒ½å¤Ÿäº’è¡¥ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<ul>
<li><strong>debounce</strong>ï¼šå°†ä¸€ç³»åˆ—è¿…é€Ÿè§¦å‘çš„äº‹ä»¶ï¼ˆä¾‹å¦‚æ•²å‡»é”®ç›˜ï¼‰åˆå¹¶æˆä¸€ä¸ªå•ç‹¬çš„äº‹ä»¶ã€‚</li>
<li><strong>throttle</strong>ï¼šç¡®ä¿ä¸€ä¸ªæŒç»­çš„æ“ä½œæµä»¥æ¯ X æ¯«ç§’æ‰§è¡Œä¸€æ¬¡çš„é€Ÿåº¦æ‰§è¡Œã€‚ä¾‹å¦‚æ¯ 200ms æ£€æŸ¥ä¸€ä¸‹æ»šåŠ¨æ¡çš„ä½ç½®æ¥è§¦å‘æŸä¸ª CSS åŠ¨ç”»ã€‚</li>
<li><strong>requestAnimationFrame</strong>ï¼šthrottleçš„ä¸€ä¸ªæ›¿ä»£å“ã€‚é€‚ç”¨äºéœ€è¦è®¡ç®—å…ƒç´ åœ¨å±å¹•ä¸Šçš„ä½ç½®å’Œæ¸²æŸ“çš„æ—¶å€™ï¼Œèƒ½å¤Ÿä¿è¯åŠ¨ç”»æˆ–è€…å˜åŒ–çš„å¹³æ»‘æ€§ã€‚æ³¨æ„ï¼šIE9 ä¸æ”¯æŒã€‚</li>
</ul>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://css-tricks.com/debouncing-throttling-explained-examples/" target="_blank" rel="noopener">https://css-tricks.com/debouncing-throttling-explained-examples/</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/03/è¯æ³•ç¯å¢ƒ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›¯å­">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Athena">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/03/è¯æ³•ç¯å¢ƒ/" itemprop="url">
                  è¯æ³•ç¯å¢ƒ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-03 19:43:19" itemprop="dateCreated datePublished" datetime="2018-11-03T19:43:19+08:00">2018-11-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2018-11-09 13:12:55" itemprop="dateModified" datetime="2018-11-09T13:12:55+08:00">2018-11-09</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="8-å¯æ‰§è¡Œä»£ç å’Œæ‰§è¡Œä¸Šä¸‹æ–‡"><a href="#8-å¯æ‰§è¡Œä»£ç å’Œæ‰§è¡Œä¸Šä¸‹æ–‡" class="headerlink" title="8 å¯æ‰§è¡Œä»£ç å’Œæ‰§è¡Œä¸Šä¸‹æ–‡"></a>8 å¯æ‰§è¡Œä»£ç å’Œæ‰§è¡Œä¸Šä¸‹æ–‡</h3><h3 id="8-1-è¯æ³•ç¯å¢ƒ"><a href="#8-1-è¯æ³•ç¯å¢ƒ" class="headerlink" title="8.1 è¯æ³•ç¯å¢ƒ"></a>8.1 è¯æ³•ç¯å¢ƒ</h3><p>è¯æ³•ç¯å¢ƒæ˜¯ä¸€ç§è§„èŒƒç±»å‹ï¼Œç”¨äºæ ¹æ®ECMAScriptä»£ç çš„è¯æ³•åµŒå¥—ç»“æ„å®šä¹‰æ ‡è¯†ç¬¦ä¸ç‰¹å®šå˜é‡å’Œå‡½æ•°çš„å…³è”ã€‚è¯æ³•ç¯å¢ƒç”±ç¯å¢ƒè®°å½•å’Œå¯¹å¤–éƒ¨è¯æ³•ç¯å¢ƒçš„å¼•ç”¨ï¼ˆå¯èƒ½ä¸ºnullï¼‰ç»„æˆã€‚é€šå¸¸ï¼Œè¯æ³•ç¯å¢ƒä¸ECMAScriptä»£ç çš„ç‰¹å®šè¯­æ³•ç»“æ„ç›¸å…³è”ï¼Œä¾‹å¦‚FunctionDeclarationã€BlockStatementæˆ–Try Catchè¯­å¥ï¼Œæ¯æ¬¡è®¡ç®—è¿™äº›ä»£ç æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¯æ³•ç¯å¢ƒã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/01/äº‹ä»¶é¡ºåº/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›¯å­">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Athena">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/01/äº‹ä»¶é¡ºåº/" itemprop="url">
                  äº‹ä»¶é¡ºåº
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-01 11:32:50 / ä¿®æ”¹æ—¶é—´ï¼š11:34:12" itemprop="dateCreated datePublished" datetime="2018-11-01T11:32:50+08:00">2018-11-01</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Event-order"><a href="#Event-order" class="headerlink" title="Event order"></a>Event order</h1><p>On the <a href="https://www.quirksmode.org/js/introevents.html" target="_blank" rel="noopener">Introduction to events</a> page I asked a question that at first sight seems incomprehensible: â€œIf an element and one of its ancestors have an event handler for the same event, which one should fire first?â€ Not surprisingly, this depends on the browser.</p>
<p>The basic problem is very simple. Suppose you have a element inside an element</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------</span><br><span class="line">| element1                        |</span><br><span class="line">|   -------------------------     |</span><br><span class="line">|   |element2               |     |</span><br><span class="line">|   -------------------------     |</span><br><span class="line">|                                 |</span><br><span class="line">-----------------------------------</span><br></pre></td></tr></table></figure>
<p>and both have an onClick event handler. If the user clicks on element2 he causes a click event in both element1 and element2. But which event fires first? Which event handler should be executed first? What, in other words, is the <em>event order</em>?</p>
<h3 id="Two-models"><a href="#Two-models" class="headerlink" title="Two models"></a>Two models</h3><p>Not surprisingly, back in the bad old days Netscape and Microsoft came to different conclusions.</p>
<ul>
<li>Netscape said that the event on element1 takes place first. This is called event <em>capturing</em>.</li>
<li>Microsoft maintained that the event on element2 takes precedence. This is called event <em>bubbling</em>.</li>
</ul>
<p>The two event orders are radically opposed. Explorer only supports event bubbling. Mozilla, Opera 7 and Konqueror support both. Older Operaâ€™s and iCab support neither.</p>
<h4 id="Event-capturing"><a href="#Event-capturing" class="headerlink" title="Event capturing"></a>Event capturing</h4><p>When you use event capturing</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">               | |</span><br><span class="line">---------------| |-----------------</span><br><span class="line">| element1     | |                |</span><br><span class="line">|   -----------| |-----------     |</span><br><span class="line">|   |element2  \ /          |     |</span><br><span class="line">|   -------------------------     |</span><br><span class="line">|        Event CAPTURING          |</span><br><span class="line">-----------------------------------</span><br></pre></td></tr></table></figure>
<p>the event handler of element1 fires first, the event handler of element2 fires last.</p>
<h4 id="Event-bubbling"><a href="#Event-bubbling" class="headerlink" title="Event bubbling"></a>Event bubbling</h4><p>When you use event bubbling</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">               / \</span><br><span class="line">---------------| |-----------------</span><br><span class="line">| element1     | |                |</span><br><span class="line">|   -----------| |-----------     |</span><br><span class="line">|   |element2  | |          |     |</span><br><span class="line">|   -------------------------     |</span><br><span class="line">|        Event BUBBLING           |</span><br><span class="line">-----------------------------------</span><br></pre></td></tr></table></figure>
<p>the event handler of element2 fires first, the event handler of element1 fires last.</p>
<h3 id="W3C-model"><a href="#W3C-model" class="headerlink" title="W3C model"></a>W3C model</h3><p>W3C has very sensibly decided to take a middle position in this struggle. Any event taking place in the <a href="http://www.w3.org/TR/2000/REC-DOM-Level-2-Events-20001113/" target="_blank" rel="noopener">W3C event model</a> is first captured until it reaches the target element and then bubbles up again.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">                 | |  / \</span><br><span class="line">-----------------| |--| |-----------------</span><br><span class="line">| element1       | |  | |                |</span><br><span class="line">|   -------------| |--| |-----------     |</span><br><span class="line">|   |element2    \ /  | |          |     |</span><br><span class="line">|   --------------------------------     |</span><br><span class="line">|        W3C event model                 |</span><br><span class="line">------------------------------------------</span><br></pre></td></tr></table></figure>
<p>You, the web developer, can choose whether to register an event handler in the capturing or in the bubbling phase. This is done through the <code>addEventListener()</code> method explained on the <a href="https://www.quirksmode.org/js/events_advanced.html" target="_blank" rel="noopener">Advanced models</a> page. If its last argument is <code>true</code> the event handler is set for the capturing phase, if it is<code>false</code> the event handler is set for the bubbling phase.</p>
<p>Suppose you do</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element1.addEventListener(&apos;click&apos;,doSomething2,true)</span><br><span class="line">element2.addEventListener(&apos;click&apos;,doSomething,false)</span><br></pre></td></tr></table></figure>
<p>If the user clicks on element2 the following happens:</p>
<ol>
<li>The <code>click</code> event starts in the capturing phase. The event looks if any ancestor element of element2 has a <code>onclick</code> event handler for the capturing phase.</li>
<li>The event finds one on element1. <code>doSomething2()</code> is executed.</li>
<li>The event travels down to the target itself, no more event handlers for the capturing phase are found. The event moves to its bubbling phase and executes <code>doSomething()</code>, which is registered to element2 for the bubbling phase.</li>
<li>The event travels upwards again and checks if any ancestor element of the target has an event handler for the bubbling phase. This is not the case, so nothing happens.</li>
</ol>
<p>The reverse would be</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element1.addEventListener(&apos;click&apos;,doSomething2,false)</span><br><span class="line">element2.addEventListener(&apos;click&apos;,doSomething,false)</span><br></pre></td></tr></table></figure>
<p>Now if the user clicks on element2 the following happens:</p>
<ol>
<li>The <code>click</code> event starts in the capturing phase. The event looks if any ancestor element of element2 has a <code>onclick</code> event handler for the capturing phase and doesnâ€™t find any.</li>
<li>The event travels down to the target itself. The event moves to its bubbling phase and executes <code>doSomething()</code>, which is registered to element2 for the bubbling phase.</li>
<li>The event travels upwards again and checks if any ancestor element of the target has an event handler for the bubbling phase.</li>
<li>The event finds one on element1. Now <code>doSomething2()</code> is executed.</li>
</ol>
<h4 id="Compatibility-with-traditional-model"><a href="#Compatibility-with-traditional-model" class="headerlink" title="Compatibility with traditional model"></a>Compatibility with traditional model</h4><p>In the browsers that support the W3C DOM, a traditional event registration</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element1.onclick = doSomething2;</span><br></pre></td></tr></table></figure>
<p>is seen as a registration in the <em>bubbling phase</em>.</p>
<h3 id="Use-of-event-bubbling"><a href="#Use-of-event-bubbling" class="headerlink" title="Use of event bubbling"></a>Use of event bubbling</h3><p>Few web developers consciously use event capturing or bubbling. In Web pages as they are made today, it is simply not necessary to let a bubbling event be handled by several different event handlers. Users might get confused by several things happening after one mouse click, and usually you want to keep your event handling scripts separated. When the user clicks on an element, something happens, when he clicks on another element, something else happens.</p>
<p>Of course this might change in the future, and itâ€™s good to have models available that are forward compatible. But the main practical use of event capturing and bubbling today is the registration of default functions.</p>
<h3 id="It-always-happens"><a href="#It-always-happens" class="headerlink" title="It always happens"></a>It always happens</h3><p>What you first need to understand is that event capturing or bubbling always happens. If you define a general onclick event handler for your entire document</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">document.onclick = doSomething;</span><br><span class="line">if (document.captureEvents) document.captureEvents(Event.CLICK);</span><br></pre></td></tr></table></figure>
<p>any <code>click</code> event on any element in the document will eventually bubble up to the document and thus fire this general event handler. Only when a previous event handling script explicitly orders the event to stop bubbling, it will not propagate to the document.</p>
<h3 id="Uses"><a href="#Uses" class="headerlink" title="Uses"></a>Uses</h3><p>Because any event ends up on the document, default event handlers become possible. Suppose you have this page:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------</span><br><span class="line">| document                         |</span><br><span class="line">|   ---------------  ------------  |</span><br><span class="line">|   | element1    |  | element2 |  |</span><br><span class="line">|   ---------------  ------------  |</span><br><span class="line">|                                  |</span><br><span class="line">------------------------------------</span><br><span class="line"></span><br><span class="line">element1.onclick = doSomething;</span><br><span class="line">element2.onclick = doSomething;</span><br><span class="line">document.onclick = defaultFunction;</span><br></pre></td></tr></table></figure>
<p>Now if the user clicks on element1 or 2, <code>doSomething()</code> is executed. You can stop the event propagation here, if you wish. If you donâ€™t the event bubbles up to <code>defaultFunction()</code>. If the user clicks anywhere else <code>defaultFunction()</code> is also executed. This might be useful sometimes.</p>
<p>Setting documentâ€“wide event handlers is necessary in dragâ€“andâ€“drop scripts. Typically a <code>mousedown</code> event on a layer selects this layer and makes it respond to the <code>mousemove</code> event. Though the <code>mousedown</code> is usually registered on the layer to avoid browser bugs, both other event handlers must be documentâ€“wide.</p>
<p>Remember the First Law of Browserology: anything can happen, and it usually does when youâ€™re least prepared for it. So it may happen that the user moves his mouse very wildly and the script doesnâ€™t keep up so that the mouse is not over the layer any more.</p>
<ul>
<li>If the <code>onmousemove</code> event handler is registered to the layer, the layer doesnâ€™t react to the mouse movement any more, causing confusion.</li>
<li>If the <code>onmouseup</code> event handler is registered on the layer, this event isnâ€™t caught either so that the layer keeps reacting to the mouse movements even after the user thinks he dropped the layer. This causes even more confusion.</li>
</ul>
<p>So in this case event bubbling is very useful because registering your event handlers on document level makes sure theyâ€™re always executed.</p>
<h3 id="Turning-it-off"><a href="#Turning-it-off" class="headerlink" title="Turning it off"></a>Turning it off</h3><p>But usually you want to turn all capturing and bubbling off to keep functions from interfering with each other. Besides, if your document structure is very complex (lots of nested tables and such) you may save system resources by turning off bubbling. The browser has to go through every single ancestor element of the event target to see if it has an event handler. Even if none are found, the search still takes time.</p>
<p>In the Microsoft model you must set the eventâ€™s <code>cancelBubble</code> property to true.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.event.cancelBubble = true</span><br></pre></td></tr></table></figure>
<p>In the W3C model you must call the eventâ€™s <code>stopPropagation()</code> method. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e.stopPropagation()</span><br></pre></td></tr></table></figure>
<p>This stops all propagation of the event in the bubbling phase. For a complete cross-browser experience do</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function doSomething(e)</span><br><span class="line">&#123;</span><br><span class="line">	if (!e) var e = window.event;</span><br><span class="line">	e.cancelBubble = true;</span><br><span class="line">	if (e.stopPropagation) e.stopPropagation();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Setting the <code>cancelBubble</code> property in browsers that donâ€™t support it doesnâ€™t hurt. The browser shrugs and creates the property. Of course it doesnâ€™t actually cancel the bubbling, but the assignment itself is safe.</p>
<h3 id="currentTarget"><a href="#currentTarget" class="headerlink" title="currentTarget"></a>currentTarget</h3><p>As weâ€™ve seen earlier, an event has a <code>target</code> or <code>srcElement</code> that contains a reference to the element the event happened on. In our example this is element2, since the user clicked on it.</p>
<p>It is very important to understand that during the capturing and bubbling phases (if any) this target does not change: it always remains a reference to element2.</p>
<p>But suppose we register these event handlers:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element1.onclick = doSomething;</span><br><span class="line">element2.onclick = doSomething;</span><br></pre></td></tr></table></figure>
<p>If the user clicks on element2 <code>doSomething()</code> is executed twice. But how do you know which HTML element is currently handling the event? <code>target/srcElement</code> donâ€™t give a clue, they always refer to element2 since it is the original source of the event.</p>
<p>To solve this problem W3C has added the <code>currentTarget</code> property. It contains a reference to the HTML element the event is currently being handled by: exactly what we need. Unfortunately the Microsoft model doesnâ€™t contain a similar property.</p>
<p>You can also use <a href="https://www.quirksmode.org/js/this.html" target="_blank" rel="noopener">the <code>this</code> keyword</a>. In the example above it refers to the HTML element the event is handled on, just like <code>currentTarget</code>.</p>
<h3 id="Problems-of-the-Microsoft-model"><a href="#Problems-of-the-Microsoft-model" class="headerlink" title="Problems of the Microsoft model"></a>Problems of the Microsoft model</h3><p>But when you use the Microsoft event registration model the <code>this</code> keyword doesnâ€™t refer to the HTML element. Combined with the lack of a <code>currentTarget</code>â€“like property in the Microsoft model, this means that if you do</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element1.attachEvent(&apos;onclick&apos;,doSomething)</span><br><span class="line">element2.attachEvent(&apos;onclick&apos;,doSomething)</span><br></pre></td></tr></table></figure>
<p>you <em>cannot</em> know which HTML element currently handles the event. This is the most serious problem with the Microsoft event registration model and for me itâ€™s reason enough never to use it, not even in IE/Win only applications.</p>
<p>I hope Microsoft will soon add a <code>currentTarget</code>â€“like property â€” or maybe even follow the standard? Web developers need this information.</p>
<h3 id="Continue"><a href="#Continue" class="headerlink" title="Continue"></a>Continue</h3><p>If you wish to go through all event pages in order, you should now continue with the <a href="https://www.quirksmode.org/js/events_mouse.html" target="_blank" rel="noopener">Mouse events</a> page.</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/29/addEventListener/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›¯å­">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Athena">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/29/addEventListener/" itemprop="url">
                  ä¸€ä¸ªç”±addEventListenerå‚æ•°é—®é¢˜æ‰€å¼•å‘çš„é˜…è¯»
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-29 21:21:31" itemprop="dateCreated datePublished" datetime="2018-10-29T21:21:31+08:00">2018-10-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2018-10-31 23:03:46" itemprop="dateModified" datetime="2018-10-31T23:03:46+08:00">2018-10-31</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä»Šå¤©æˆ‘åœ¨çœ‹ä¸€ç¯‡è®²MVCå’Œè§‚å¯Ÿè€…æ¨¡å¼çš„æ–‡ç« çš„æ—¶å€™ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªä¾‹å­ä»£ç ï¼Œæ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(model) &#123;</span><br><span class="line">    <span class="keyword">this</span>.model = model;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//EVENTLISTENER INTERFACE</span></span><br><span class="line">  handleEvent(e) &#123;</span><br><span class="line">    e.stopPropagation();</span><br><span class="line">    <span class="keyword">switch</span> (e.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"click"</span>:</span><br><span class="line">        <span class="keyword">this</span>.clickHandler(e.target);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(e.target);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//GET MODEL HEADING</span></span><br><span class="line">  getModelHeading() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.model.heading;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//CHANGE THE MODEL</span></span><br><span class="line">  clickHandler(target) &#123;</span><br><span class="line">    <span class="keyword">this</span>.model.heading = <span class="string">"World"</span>;</span><br><span class="line">    <span class="keyword">this</span>.model.notifyAll();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸­é—´å®ä¾‹åŒ–äº†è¿™ä¸ªclassï¼Œä¸ºcontroller<br>DOMäº‹ä»¶ç›‘å¬çš„è°ƒç”¨ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.heading.addEventListener(<span class="string">"click"</span>, controller);</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥å‘ç°ï¼Œè¿™é‡Œçš„addEventListenerä¼ çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡æ€ä¹ˆå°±èƒ½è§£æäº‹ä»¶å‘¢ï¼Œä»¥å‰çš„æˆ‘åªçŸ¥é“ç¬¬äºŒä¸ªå‚æ•°åº”è¯¥ä¼ ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä»æ²¡ä½¿ç”¨è¿‡å¯¹è±¡çš„è¿™ç§æ–¹å¼ã€‚äºæ˜¯æŸ¥äº†ä¸€ä¸‹MDNï¼Œæœç„¶ä¸ç®€å•ã€‚</p>
<h2 id="EventTarget"><a href="#EventTarget" class="headerlink" title="EventTarget"></a>EventTarget</h2><p>è¦è¯´ addEventListenerï¼Œé¦–å…ˆè¦ä» <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget" target="_blank" rel="noopener">EventTarget</a> è¯´èµ·ã€‚</p>
<blockquote>
<p>EventTarget æ˜¯ä¸€ä¸ªç”±å¯¹è±¡å®ç°çš„æ¥å£ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥æ¥æ”¶äº‹ä»¶ï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›ä¾¦å¬å™¨ã€‚</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element" target="_blank" rel="noopener"><code>Element</code></a>ã€ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document" target="_blank" rel="noopener"><code>document</code></a>å’Œ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window" target="_blank" rel="noopener"><code>window</code></a> æ˜¯æœ€å¸¸è§çš„ event targets, ä½†å…¶å®ƒå¯¹è±¡ä¹Ÿå¯æˆä¸º event targetsï¼Œ ä¾‹å¦‚ <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener"><code>XMLHttpRequest</code></a> <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioNode" target="_blank" rel="noopener"><code>AudioNode</code></a> <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext" target="_blank" rel="noopener"><code>AudioContext</code></a> ç­‰ã€‚</p>
<p>Webå¹³å°æä¾›äº†å‡ ç§è·å–DOMäº‹ä»¶é€šçŸ¥çš„æ–¹æ³•ã€‚ä¸¤ç§å¸¸è§çš„æ–¹å¼æ˜¯ï¼šé€šç”¨ <code>addEventListener()</code> å’Œä¸€ç»„ç‰¹å®šçš„ <strong>on-event</strong> å¤„ç†ç¨‹åºã€‚</p>
</blockquote>
<p>ç„¶å MDN ç»™å‡ºäº†ä¸€ä¸ª EventTarget çš„ç®€å•å®ç°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> EventTarget = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.listeners = &#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">EventTarget.prototype.listeners = <span class="literal">null</span>;</span><br><span class="line">EventTarget.prototype.addEventListener = <span class="function"><span class="keyword">function</span>(<span class="params">type, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(type <span class="keyword">in</span> <span class="keyword">this</span>.listeners)) &#123;</span><br><span class="line">    <span class="keyword">this</span>.listeners[type] = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.listeners[type].push(callback);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">EventTarget.prototype.removeEventListener = <span class="function"><span class="keyword">function</span>(<span class="params">type, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(type <span class="keyword">in</span> <span class="keyword">this</span>.listeners)) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> stack = <span class="keyword">this</span>.listeners[type];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = stack.length; i &lt; l; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (stack[i] === callback)&#123;</span><br><span class="line">      stack.splice(i, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">EventTarget.prototype.dispatchEvent = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(event.type <span class="keyword">in</span> <span class="keyword">this</span>.listeners)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> stack = <span class="keyword">this</span>.listeners[event.type].slice();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = stack.length; i &lt; l; i++) &#123;</span><br><span class="line">    stack[i].call(<span class="keyword">this</span>, event);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> !event.defaultPrevented;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘è¿™ä¸€çœ‹ï¼Œè¿™ä¸å°±æ˜¯è¿™å‡ å¤©æ­£åœ¨ç ”ç©¶çš„è§‚å¯Ÿè€…æ¨¡å¼ä¹ˆï¼ŒEventTarget æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ˜¯è¢«è§‚å¯Ÿçš„ä¸»ä½“ï¼Œåœ¨åŸå‹ä¸Šç»‘å®šäº†ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><code>addEventListener()</code> - åœ¨ EventTarget ä¸Šæ³¨å†Œç‰¹å®šäº‹ä»¶ç±»å‹çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚</li>
<li><code>removeEventListener()</code> - ä» EventTarget ä¸­åˆ é™¤ä¸€ä¸ªäº‹ä»¶ä¾¦å¬å™¨ã€‚</li>
<li><code>dispatchEvent()</code> - å°†äº‹ä»¶åˆ†æ´¾åˆ°æ­¤ EventTargetã€‚</li>
</ul>
<p>å…¶ä¸­çš„ listener å°±æ˜¯ç›‘å¬çš„äº‹ä»¶ï¼Œç±»å‹å’Œå›è°ƒå‡½æ•°ã€‚</p>
<h2 id="EventListener"><a href="#EventListener" class="headerlink" title="EventListener"></a>EventListener</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹ <strong><a href="https://developer.mozilla.org/en-US/docs/Web/API/EventListener" target="_blank" rel="noopener">EventListener</a></strong></p>
<blockquote>
<p>EventListener æ¥å£è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥å¤„ç† EventTarget å¯¹è±¡å‘å‡ºçš„äº‹ä»¶ã€‚</p>
<p>ç”±äºéœ€è¦ä¸é—ç•™å†…å®¹å…¼å®¹ï¼ŒEventListener æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œæˆ–è€…å¸¦æœ‰ handleEvent() å±æ€§å‡½æ•°çš„å¯¹è±¡ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>Click here!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buttonElement = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡æä¾›å›è°ƒå‡½æ•°ä¸º'click'äº‹ä»¶æ·»åŠ å¤„ç†ç¨‹åºã€‚</span></span><br><span class="line"><span class="comment">// Whenever the element is clicked, a pop-up with "Element clicked!" will</span></span><br><span class="line"><span class="comment">// appear.</span></span><br><span class="line">buttonElement.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">'Element clicked through function!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// For compatibility, a non-function object with a `handleEvent` property is</span></span><br><span class="line"><span class="comment">// treated just the same as a function itself.</span></span><br><span class="line">buttonElement.addEventListener(<span class="string">'click'</span>, &#123;</span><br><span class="line">  handleEvent: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">'Element clicked through handleEvent property!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ä¸€å¼€å§‹æŠ›å‡ºçš„ï¼ŒaddEventListener çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå‡½æ•°å±æ€§ï¼Œåå­—ä¸º <code>handleEvent</code>ã€‚</p>
<p>æŒ‰ç†è¯´è¿™ç¯‡æ–‡ç« åˆ°è¿™ï¼Œå°±å·®ä¸å¤šäº†ï¼Œä½†æ˜¯æˆ‘å‘ç°å¥½å¤šè·Ÿ <code>addEventListener</code> ç›¸å…³çš„ä¸œè¥¿ï¼Œäºæ˜¯å†è¿›ä¸€æ­¥æ¢ç´¢ä¸€ä¸‹ã€‚</p>
<h2 id="addEventListener"><a href="#addEventListener" class="headerlink" title="addEventListener"></a>addEventListener</h2><p>å…ˆåˆ—ä¸€ä¸‹è¯­æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target.addEventListener(type, listener[, options]);</span><br><span class="line">target.addEventListener(type, listener[, useCapture]);</span><br><span class="line">target.addEventListener(type, listener[, useCapture, wantsUntrusted  ]); // Gecko/Mozilla only</span><br></pre></td></tr></table></figure>
<p>å†çœ‹ä¸€ä¸‹æ¯ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><p>type-è¡¨ç¤ºè¦ä¾¦å¬çš„äº‹ä»¶ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªå¤§å°å†™æ•æ„Ÿçš„å­—ç¬¦ä¸²</p>
</li>
<li><p>listener - å½“å‘ç”ŸæŒ‡å®šç±»å‹çš„äº‹ä»¶æ—¶æ¥æ”¶é€šçŸ¥ï¼ˆå®ç° Event æ¥å£çš„å¯¹è±¡ï¼‰çš„å¯¹è±¡ã€‚è¿™å¿…é¡»æ˜¯å®ç° EventListener æ¥å£çš„å¯¹è±¡ï¼Œæˆ– JavaScript å‡½æ•°ã€‚</p>
</li>
<li><p>options</p>
<p>æŒ‡å®šäº‹ä»¶ä¾¦å¬å™¨ç‰¹å¾çš„é€‰é¡¹å¯¹è±¡ã€‚å¯ç”¨çš„é€‰é¡¹å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>capture</code>:  <code>Boolean</code>ï¼Œè¡¨ç¤º <code>listener</code> ä¼šåœ¨è¯¥ç±»å‹çš„äº‹ä»¶æ•è·é˜¶æ®µä¼ æ’­åˆ°è¯¥ <code>EventTarget</code> æ—¶è§¦å‘ã€‚</li>
<li><code>once</code>:  <code>Boolean</code>ï¼Œè¡¨ç¤º <code>listener åœ¨æ·»åŠ ä¹‹åæœ€å¤šåªè°ƒç”¨ä¸€æ¬¡ã€‚å¦‚æœæ˜¯</code> <code>trueï¼Œ</code> <code>listener</code> ä¼šåœ¨å…¶è¢«è°ƒç”¨ä¹‹åè‡ªåŠ¨ç§»é™¤ã€‚</li>
<li><code>passive</code>: <code>Boolean</code>ï¼Œå¦‚æœä¸ºçœŸï¼Œåˆ™è¡¨ç¤º <code>listener</code> æ°¸è¿œä¸ä¼šè°ƒç”¨ <code>preventDefault()ã€‚å¦‚æœ listener ä»ç„¶è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œå®¢æˆ·ç«¯å°†ä¼šå¿½ç•¥å®ƒå¹¶æŠ›å‡ºä¸€ä¸ªæ§åˆ¶å°è­¦å‘Šã€‚</code></li>
<li><code>mozSystemGroup</code>: åªèƒ½åœ¨ XBL æˆ–è€…æ˜¯ Firefoxâ€™ chrome ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Boolean" target="_blank" rel="noopener"><code>Boolean</code></a>ï¼Œè¡¨ç¤º <code>listener</code>è¢«æ·»åŠ åˆ° system groupã€‚</li>
</ul>
</li>
</ul>
<p>åœ¨è¯´åˆ°ç¬¬ä¸‰ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œå°±å¿…é¡»äº†è§£ DOM çš„äº‹ä»¶æµï¼Œè¿™é‡Œæˆ‘ä»¬ä»W3Cå·¥ä½œè‰æ¡ˆ <a href="http://www.w3.org/TR/DOM-Level-3-Events/#event-flow" target="_blank" rel="noopener">DOM Level 3 Events</a> å¼€å§‹äº†è§£ã€‚</p>
<ul>
<li><p>useCapture</p>
<p>ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸ºfalseã€‚æŒ‡ç¤ºåœ¨å°†æ­¤ç±»å‹çš„äº‹ä»¶åˆ†æ´¾åˆ°DOMæ ‘ä¸­å®ƒä¸‹é¢çš„ä»»ä½•EventTargetä¹‹å‰ï¼Œæ˜¯å¦ä¼šå°†æ­¤ç±»å‹çš„äº‹ä»¶åˆ†æ´¾ç»™å·²æ³¨å†Œçš„ä¾¦å¬å™¨ã€‚é€šè¿‡æ ‘å‘ä¸Šå†’æ³¡çš„äº‹ä»¶ä¸ä¼šè§¦å‘æŒ‡å®šä½¿ç”¨æ•è·çš„ä¾¦å¬å™¨ã€‚å½“ä¸¤ä¸ªå…ƒç´ éƒ½ä¸ºè¯¥äº‹ä»¶æ³¨å†Œäº†å¥æŸ„æ—¶ï¼Œäº‹ä»¶å†’æ³¡å’Œæ•è·æ˜¯ä¼ æ’­åœ¨åµŒå¥—åœ¨å¦ä¸€ä¸ªå…ƒç´ ä¸­çš„å…ƒç´ ä¸­å‘ç”Ÿçš„äº‹ä»¶çš„ä¸¤ç§æ–¹æ³•ã€‚äº‹ä»¶ä¼ æ’­æ¨¡å¼ç¡®å®šå…ƒç´ æ¥æ”¶äº‹ä»¶çš„é¡ºåºã€‚</p>
</li>
</ul>
<h2 id="DOM-Event-Architecture"><a href="#DOM-Event-Architecture" class="headerlink" title="DOM Event Architecture"></a>DOM Event Architecture</h2><h3 id="æœ¯è¯­è¡¨"><a href="#æœ¯è¯­è¡¨" class="headerlink" title="æœ¯è¯­è¡¨"></a>æœ¯è¯­è¡¨</h3><p>åœ¨çœ‹è§„èŒƒæ­£æ–‡ä¹‹å‰ï¼Œä¸å¾—ä¸è¯´ï¼Œè¿˜å¾—çœ‹ä¸€ä¸‹ä¸€äº›æœ¯è¯­å’Œç¿»è¯‘çš„å¯¹åº”ï¼Œä¸ç„¶ç”¨ä»¥è¢«è¿™äº›åå­—ææ‡µã€‚</p>
<h4 id="Event-äº‹ä»¶"><a href="#Event-äº‹ä»¶" class="headerlink" title="Event-äº‹ä»¶"></a>Event-äº‹ä»¶</h4><p>çœ‹ä¸€ä¸‹<a href="https://dom.spec.whatwg.org/#interface-event" target="_blank" rel="noopener">æ¥å£æè¿°</a>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[Constructor(DOMString type, optional EventInit eventInitDict),</span><br><span class="line"> Exposed=(Window,Worker,AudioWorklet)]</span><br><span class="line">interface Event &#123;</span><br><span class="line">  readonly attribute DOMString type;</span><br><span class="line">  readonly attribute EventTarget? target;</span><br><span class="line">  readonly attribute EventTarget? srcElement; // historical</span><br><span class="line">  readonly attribute EventTarget? currentTarget;</span><br><span class="line">  sequence&lt;EventTarget&gt; composedPath();</span><br><span class="line"></span><br><span class="line">  const unsigned short NONE = 0;</span><br><span class="line">  const unsigned short CAPTURING_PHASE = 1;</span><br><span class="line">  const unsigned short AT_TARGET = 2;</span><br><span class="line">  const unsigned short BUBBLING_PHASE = 3;</span><br><span class="line">  readonly attribute unsigned short eventPhase;</span><br><span class="line"></span><br><span class="line">  void stopPropagation();</span><br><span class="line">           attribute boolean cancelBubble; // historical alias of .stopPropagation</span><br><span class="line">  void stopImmediatePropagation();</span><br><span class="line"></span><br><span class="line">  readonly attribute boolean bubbles;</span><br><span class="line">  readonly attribute boolean cancelable;</span><br><span class="line">           attribute boolean returnValue;  // historical</span><br><span class="line">  void preventDefault();</span><br><span class="line">  readonly attribute boolean defaultPrevented;</span><br><span class="line">  readonly attribute boolean composed;</span><br><span class="line"></span><br><span class="line">  [Unforgeable] readonly attribute boolean isTrusted;</span><br><span class="line">  readonly attribute DOMHighResTimeStamp timeStamp;</span><br><span class="line"></span><br><span class="line">  void initEvent(DOMString type, optional boolean bubbles = false, optional boolean cancelable = false); // historical</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dictionary EventInit &#123;</span><br><span class="line">  boolean bubbles = false;</span><br><span class="line">  boolean cancelable = false;</span><br><span class="line">  boolean composed = false;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>äº‹ä»¶å¯¹è±¡ç®€å•åœ°ç§°ä¸ºäº‹ä»¶ã€‚å®ƒå…è®¸å‘é€å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…çš„ä¿¡å·ï¼Œä¾‹å¦‚ï¼Œå›¾åƒå·²ç»å®Œæˆä¸‹è½½ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event = new Event(type [, eventInitDict])</span><br></pre></td></tr></table></figure>
<p>è¿”å›ä¸€ä¸ªæ–°äº‹ä»¶ï¼Œå…¶ <code>type</code> å±æ€§å€¼è®¾ç½®ä¸º typeã€‚eventInitDictargument å…è®¸é€šè¿‡åŒåå¯¹è±¡æˆå‘˜è®¾ç½® <code>bubbles</code> å’Œ <code>cancelable</code> å±æ€§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . type</span><br></pre></td></tr></table></figure>
<p>è¿”å›äº‹ä»¶çš„ç±»å‹ï¼Œ e.g. â€œ<code>click</code>â€œ, â€œ<code>hashchange</code>â€œ, or â€œ<code>submit</code>â€œ.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . target</span><br></pre></td></tr></table></figure>
<p>è¿”å›å‘é€äº‹ä»¶çš„å¯¹è±¡(å…¶ç›®æ ‡)ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . currentTarget</span><br></pre></td></tr></table></figure>
<p>è¿”å›å½“å‰æ­£åœ¨è°ƒç”¨å…¶äº‹ä»¶ä¾¦å¬å™¨å›è°ƒçš„å¯¹è±¡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . composedPath()</span><br></pre></td></tr></table></figure>
<p>Returns the <a href="https://dom.spec.whatwg.org/#event-path-item" target="_blank" rel="noopener">item</a> objects of eventâ€™s <a href="https://dom.spec.whatwg.org/#event-path" target="_blank" rel="noopener">path</a> (objects on which listeners will be invoked), except for any <a href="https://dom.spec.whatwg.org/#concept-node" target="_blank" rel="noopener">nodes</a> in <a href="https://dom.spec.whatwg.org/#concept-shadow-tree" target="_blank" rel="noopener">shadow trees</a> of which the <a href="https://dom.spec.whatwg.org/#concept-shadow-root" target="_blank" rel="noopener">shadow root</a>â€™s <a href="https://dom.spec.whatwg.org/#shadowroot-mode" target="_blank" rel="noopener">mode</a> is â€œ<code>closed</code>â€œ that are not reachable from eventâ€™s <code>currentTarget</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . eventPhase</span><br></pre></td></tr></table></figure>
<p>Returns the <a href="https://dom.spec.whatwg.org/#concept-event" target="_blank" rel="noopener">event</a>â€™s phase, which is one of <code>NONE</code>, <code>CAPTURING_PHASE</code>, <code>AT_TARGET</code>, and <code>BUBBLING_PHASE</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . stopPropagation()</span><br></pre></td></tr></table></figure>
<p>åœ¨æ ‘ä¸­åˆ†æ´¾æ—¶ï¼Œè°ƒç”¨æ­¤æ–¹æ³•å¯é˜²æ­¢äº‹ä»¶åˆ°è¾¾å½“å‰å¯¹è±¡ä»¥å¤–çš„ä»»ä½•å¯¹è±¡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . stopImmediatePropagation()</span><br></pre></td></tr></table></figure>
<p>Invoking this method prevents event from reaching any registered <a href="https://dom.spec.whatwg.org/#concept-event-listener" target="_blank" rel="noopener">event listeners</a> after the current one finishes running and, when <a href="https://dom.spec.whatwg.org/#concept-event-dispatch" target="_blank" rel="noopener">dispatched</a> in a <a href="https://dom.spec.whatwg.org/#concept-tree" target="_blank" rel="noopener">tree</a>, also prevents eventfrom reaching any other objects.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . bubbles</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®äº‹ä»¶åˆå§‹åŒ–çš„æ–¹å¼è¿”å› true æˆ– falseã€‚å¦‚æœäº‹ä»¶ä»¥ç›¸åçš„æ ‘é¡ºåºé€šè¿‡ç›®æ ‡çš„ç¥–å…ˆï¼Œåˆ™ä¸ºçœŸï¼Œå¦åˆ™ä¸ºå‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . cancelable</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®äº‹ä»¶åˆå§‹åŒ–çš„æ–¹å¼è¿”å› true æˆ– falseã€‚å®ƒçš„è¿”å›å€¼å¹¶ä¸æ€»æ˜¯æœ‰æ„ä¹‰ï¼Œä½†æ˜¯ true å¯ä»¥æŒ‡ç¤ºåœ¨äº‹ä»¶è¢«åˆ†æ´¾æœŸé—´ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ preventDefault() æ–¹æ³•æ¥å–æ¶ˆéƒ¨åˆ†æ“ä½œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . preventDefault()</span><br></pre></td></tr></table></figure>
<p>If invoked when the <code>cancelable</code> attribute value is true, and while executing a listener for the event with <code>passive</code> set to false, signals to the operation that caused event to be <a href="https://dom.spec.whatwg.org/#concept-event-dispatch" target="_blank" rel="noopener">dispatched</a> that it needs to be canceled.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . defaultPrevented</span><br></pre></td></tr></table></figure>
<p>Returns true if <code>preventDefault()</code> was invoked successfully to indicate cancelation, and false otherwise.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . composed</span><br></pre></td></tr></table></figure>
<p>Returns true or false depending on how event was initialized. True if event invokes listeners past a <code>ShadowRoot</code> <a href="https://dom.spec.whatwg.org/#boundary-point-node" target="_blank" rel="noopener">node</a> that is the <a href="https://dom.spec.whatwg.org/#concept-tree-root" target="_blank" rel="noopener">root</a> of its <a href="https://dom.spec.whatwg.org/#event-target" target="_blank" rel="noopener">target</a>, and false otherwise.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . isTrusted</span><br></pre></td></tr></table></figure>
<p>Returns true if event was <a href="https://dom.spec.whatwg.org/#concept-event-dispatch" target="_blank" rel="noopener">dispatched</a> by the user agent, and false otherwise.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event . timeStamp</span><br></pre></td></tr></table></figure>
<p>Returns the eventâ€™s timestamp as the number of milliseconds measured relative to the <a href="https://w3c.github.io/hr-time/#dfn-time-origin" target="_blank" rel="noopener">time origin</a>.</p>
<h4 id="dispatch-åˆ†æ´¾ã€æ´¾å‘ã€åˆ†å‘"><a href="#dispatch-åˆ†æ´¾ã€æ´¾å‘ã€åˆ†å‘" class="headerlink" title="dispatch-åˆ†æ´¾ã€æ´¾å‘ã€åˆ†å‘"></a><a href="https://www.w3.org/TR/DOM-Level-3-Events/#dispatch" target="_blank" rel="noopener">dispatch</a>-åˆ†æ´¾ã€æ´¾å‘ã€åˆ†å‘</h4><p>åˆ›å»ºä¸€ä¸ªäº‹ä»¶ï¼Œè¯¥äº‹ä»¶å…·æœ‰ä¸å…¶ç±»å‹å’Œä¸Šä¸‹æ–‡ç›¸åŒ¹é…çš„å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä»¥æŒ‡å®šçš„æ–¹å¼é€šè¿‡DOMæ ‘è¿›è¡Œä¼ æ’­ã€‚å¯ä»¥ä¸æœ¯è¯­ fire äº’æ¢ï¼Œä¾‹å¦‚ï¼Œè§¦å‘ä¸€ä¸ªå•å‡»äº‹ä»¶ï¼ˆfire a click eventï¼‰æˆ–åˆ†æ´¾ä¸€ä¸ªåŠ è½½äº‹ä»¶ï¼ˆdispatch a load eventï¼‰ã€‚</p>
<h4 id="event-target-äº‹ä»¶ç›®æ ‡"><a href="#event-target-äº‹ä»¶ç›®æ ‡" class="headerlink" title="event target-äº‹ä»¶ç›®æ ‡"></a><a href="https://www.w3.org/TR/DOM-Level-3-Events/#event-target" target="_blank" rel="noopener">event target</a>-äº‹ä»¶ç›®æ ‡</h4><p>äº‹ä»¶çš„ç›®æ ‡å¯¹è±¡ï¼Œä½¿ç”¨äº‹ä»¶æ´¾å‘å’ŒDOMäº‹ä»¶æµã€‚<strong>äº‹ä»¶ç›®æ ‡</strong>æ˜¯ event çš„ target å±æ€§çš„å€¼ã€‚ä¹Ÿå°±æ˜¯ event.targetã€‚</p>
<h4 id="propagation-path-ä¼ æ’­è·¯å¾„"><a href="#propagation-path-ä¼ æ’­è·¯å¾„" class="headerlink" title="propagation path-ä¼ æ’­è·¯å¾„"></a><a href="https://www.w3.org/TR/DOM-Level-3-Events/#propagation-path" target="_blank" rel="noopener">propagation path</a>-ä¼ æ’­è·¯å¾„</h4><p><strong>å½“å‰äº‹ä»¶ç›®æ ‡</strong>çš„æœ‰åºé›†åˆï¼Œäº‹ä»¶å¯¹è±¡å°†åœ¨è¿›å‡ºäº‹ä»¶ç›®æ ‡çš„è¿‡ç¨‹ä¸­æŒ‰é¡ºåºä¼ é€’ã€‚å½“äº‹ä»¶ä¼ æ’­æ—¶ï¼Œ<strong>ä¼ æ’­è·¯å¾„</strong>ä¸­çš„æ¯ä¸ªå½“å‰äº‹ä»¶ç›®æ ‡ä¾æ¬¡è®¾ç½®ä¸ºcurrentTargetã€‚<strong>ä¼ æ’­è·¯å¾„</strong>æœ€åˆç”±äº‹ä»¶ç±»å‹å®šä¹‰çš„ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶é˜¶æ®µç»„æˆï¼Œä½†å¯èƒ½ä¼šè¢«ä¸­æ–­ã€‚ä¹Ÿç§°ä¸ºäº‹ä»¶ç›®æ ‡é“¾ã€‚</p>
<h4 id="current-event-target-å½“å‰äº‹ä»¶ç›®æ ‡"><a href="#current-event-target-å½“å‰äº‹ä»¶ç›®æ ‡" class="headerlink" title="current event target-å½“å‰äº‹ä»¶ç›®æ ‡"></a><a href="https://www.w3.org/TR/DOM-Level-3-Events/#current-event-target" target="_blank" rel="noopener">current event target</a>-å½“å‰äº‹ä»¶ç›®æ ‡</h4><p>åœ¨äº‹ä»¶æµä¸­ï¼Œ<strong>å½“å‰äº‹ä»¶ç›®æ ‡</strong>æ˜¯ä¸å½“å‰æ´¾å‘çš„äº‹ä»¶å¤„ç†ç¨‹åºå…³è”çš„å¯¹è±¡ã€‚æ­¤å¯¹è±¡å¯èƒ½æ˜¯ç›®æ ‡äº‹ä»¶æœ¬èº«æˆ–å…¶ç¥–å…ˆä¹‹ä¸€ã€‚å½“äº‹ä»¶é€šè¿‡äº‹ä»¶æµçš„å„ä¸ªé˜¶æ®µä»ä¸€ä¸ªå¯¹è±¡ä¼ æ’­åˆ°å¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ<strong>å½“å‰äº‹ä»¶ç›®æ ‡</strong>ä¼šå‘ç”Ÿå˜åŒ–ã€‚<strong>å½“å‰äº‹ä»¶ç›®æ ‡</strong>æ˜¯ currentTarget å±æ€§çš„å€¼ã€‚</p>
<h4 id="event-handler-event-listener-äº‹ä»¶å¤„ç†ç¨‹åº-äº‹ä»¶ä¾¦å¬å™¨"><a href="#event-handler-event-listener-äº‹ä»¶å¤„ç†ç¨‹åº-äº‹ä»¶ä¾¦å¬å™¨" class="headerlink" title="event handler/event listener-äº‹ä»¶å¤„ç†ç¨‹åº/äº‹ä»¶ä¾¦å¬å™¨"></a><a href="https://www.w3.org/TR/DOM-Level-3-Events/#event-handler" target="_blank" rel="noopener">event handler/event listener</a>-äº‹ä»¶å¤„ç†ç¨‹åº/äº‹ä»¶ä¾¦å¬å™¨</h4><p>å®ç°EventListeneræ¥å£å¹¶æä¾›handleEvent()å›è°ƒæ–¹æ³•çš„å¯¹è±¡ã€‚äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯ç‰¹å®šäºè¯­è¨€çš„ã€‚äº‹ä»¶å¤„ç†ç¨‹åºåœ¨ç‰¹å®šå¯¹è±¡(<strong>å½“å‰äº‹ä»¶ç›®æ ‡</strong>)çš„ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ï¼Œå¹¶æä¾›äº‹ä»¶å¯¹è±¡æœ¬èº«ã€‚</p>
<h4 id="phase-é˜¶æ®µ"><a href="#phase-é˜¶æ®µ" class="headerlink" title="phase-é˜¶æ®µ"></a>phase-é˜¶æ®µ</h4><p>åœ¨äº‹ä»¶çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œé˜¶æ®µæ˜¯ä¸€ç»„æ²¿ç€DOMæ ‘çš„é€»è¾‘éå†ï¼Œä» Window åˆ° <code>Document</code> å¯¹è±¡ã€æ ¹å…ƒç´ ï¼Œç„¶åä¸‹åˆ°äº‹ä»¶å¯¹è±¡ï¼ˆæ•è·é˜¶æ®µï¼‰ï¼Œå†åˆ°äº‹ä»¶å¯¹è±¡æœ¬èº«ï¼ˆç›®æ ‡é˜¶æ®µï¼‰ï¼Œç„¶åæ²¿åŸè·¯è¿”å›ï¼ˆå†’æ³¡é˜¶æ®µï¼‰ã€‚</p>
<h3 id="äº‹ä»¶åˆ†å‘å’ŒDOMäº‹ä»¶æµ-Event-dispatch-and-DOM-event-flow"><a href="#äº‹ä»¶åˆ†å‘å’ŒDOMäº‹ä»¶æµ-Event-dispatch-and-DOM-event-flow" class="headerlink" title="äº‹ä»¶åˆ†å‘å’ŒDOMäº‹ä»¶æµ-Event dispatch and DOM event flow"></a>äº‹ä»¶åˆ†å‘å’ŒDOMäº‹ä»¶æµ-Event dispatch and DOM event flow</h3><p>æœ¬ç« èŠ‚ä¼šç®€å•ä»‹ç»<strong>äº‹ä»¶åˆ†æ´¾</strong>æœºåˆ¶ï¼Œå¹¶æè¿°äº‹ä»¶æ˜¯å¦‚ä½•é€šè¿‡DOMæ ‘è¿›è¡Œä¼ æ’­çš„ã€‚åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ <code>dispatchEvent()</code> æ–¹æ³•åˆ†æ´¾äº‹ä»¶å¯¹è±¡ï¼Œäº‹ä»¶å¯¹è±¡å°†é€šè¿‡DOMäº‹ä»¶æµç¡®å®šçš„DOMæ ‘ä¼ æ’­ã€‚</p>
<p><img src="https://www.w3.org/TR/DOM-Level-3-Events/images/eventflow.svg" alt="Graphical representation of an event dispatched in a DOM tree using the DOM event flow"></p>
<p>äº‹ä»¶å¯¹è±¡è¢«åˆ†å‘åˆ°ä¸€ä¸ª<strong>äº‹ä»¶ç›®æ ‡</strong>ä¸Šã€‚ä½†æ˜¯åœ¨å¼€å§‹åˆ†æ´¾ä¹‹å‰ï¼Œå¿…é¡»å…ˆç¡®å®šäº‹ä»¶å¯¹è±¡çš„<strong>ä¼ æ’­è·¯å¾„</strong>ã€‚</p>
<p><strong>ä¼ æ’­è·¯å¾„</strong>æ˜¯äº‹ä»¶é€šè¿‡<strong>å½“å‰äº‹ä»¶ç›®æ ‡</strong>çš„æœ‰åºåˆ—è¡¨ã€‚è¿™ä¸ªä¼ æ’­è·¯å¾„åæ˜ äº†æ–‡æ¡£çš„å±‚æ¬¡æ ‘ç»“æ„ã€‚åˆ—è¡¨ä¸­çš„æœ€åä¸€é¡¹æ˜¯<strong>äº‹ä»¶ç›®æ ‡</strong>ï¼Œåœ¨è¿™ä¹‹å‰çš„éƒ½ç§°ä¸ºç›®æ ‡çš„ç¥–å…ˆé¡¹ï¼ŒæŒ¨ç€äº‹ä»¶ç›®æ ‡çš„ç§°ä½œç›®æ ‡çš„çˆ¶é¡¹ã€‚</p>
<p>ä¸€æ—¦ä¼ æ’­è·¯å¾„å†³å®šäº†ï¼Œäº‹ä»¶å¯¹è±¡å°±ä¼šç»è¿‡ä¸€ä¸ªæˆ–å¤šä¸ª<strong>äº‹ä»¶é˜¶æ®µ</strong>ã€‚æœ‰ä¸‰ä¸ªäº‹ä»¶é˜¶æ®µï¼šæ•è·é˜¶æ®µã€ç›®æ ‡é˜¶æ®µå’Œå†’æ³¡é˜¶æ®µã€‚äº‹ä»¶å¯¹è±¡ä¼šåƒä¸‹é¢æè¿°çš„è¿™æ ·æ¥å®Œæˆè¿™äº›é˜¶æ®µã€‚å¦‚æœä¸æ”¯æŒæŸä¸ªé˜¶æ®µï¼Œæˆ–è€…äº‹ä»¶å¯¹è±¡çš„ä¼ æ’­å·²ç»åœæ­¢ï¼Œåˆ™è·³è¿‡è¯¥é˜¶æ®µã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>bubbles</code> å±æ€§è®¾æˆäº† falseï¼Œå°±ä¼šè·³è¿‡å†’æ³¡é˜¶æ®µï¼Œå¦‚æœåœ¨åˆ†æ´¾ä¹‹å‰å°±è°ƒç”¨äº† <code>stopPropagation()</code>ï¼Œæ‰€æœ‰é˜¶æ®µéƒ½ä¼šè¢«è·³è¿‡ã€‚</p>
<ul>
<li><p>æ•è·é˜¶æ®µï¼ˆcapture phaseï¼‰ï¼šäº‹ä»¶å¯¹è±¡é€šè¿‡å¯¹è±¡çš„ç¥–å…ˆé¡¹ï¼Œä» Window ä¼ æ’­åˆ°ç›®æ ‡çš„çˆ¶é¡¹ã€‚è¯¥é˜¶æ®µä¹Ÿè¢«ç§°ä¸º capturing phase ï¼ˆåæ­£ä¸­æ–‡ç¿»è¯‘è¿‡æ¥éƒ½æ˜¯æ•è·é˜¶æ®µï¼‰</p>
</li>
<li><p>ç›®æ ‡é˜¶æ®µï¼ˆtarget phaseï¼‰ï¼šäº‹ä»¶å¯¹è±¡åˆ°è¾¾äº‹ä»¶å¯¹è±¡çš„äº‹ä»¶ç›®æ ‡ä¸Šé¢ã€‚è¯¥é˜¶æ®µä¹Ÿè¢«ç§°ä½œ at-target phase ï¼ˆåæ­£ç¿»è¯‘è¿‡æ¥è¿˜æ˜¯ç›®æ ‡é˜¶æ®µï¼‰ã€‚å¦‚æœäº‹ä»¶ç±»å‹æŒ‡å‡ºè¯¥äº‹ä»¶ä¸è¿›è¡Œå†’æ³¡ï¼Œåˆ™äº‹ä»¶å¯¹è±¡å°†åœ¨æ­¤é˜¶æ®µç»“æŸååœæ­¢ã€‚</p>
</li>
<li>å†’æ³¡é˜¶æ®µï¼ˆbubble phaseï¼‰ï¼šäº‹ä»¶å¯¹è±¡ä»¥ç›¸åçš„é¡ºåºé€šè¿‡ç›®æ ‡çš„ç¥–å…ˆé¡¹ä¼ æ’­ï¼Œä»ç›®æ ‡çš„çˆ¶é¡¹å¼€å§‹ï¼Œåˆ° Window ç»“æŸã€‚è¯¥é˜¶æ®µä¹Ÿè¢«ç§°ä¸º bubbling phaseï¼ˆåæ­£ç¿»è¯‘è¿‡æ¥è¿˜æ˜¯å†’æ³¡é˜¶æ®µï¼‰</li>
</ul>
<h3 id="é»˜è®¤åŠ¨ä½œå’Œå¯å–æ¶ˆäº‹ä»¶"><a href="#é»˜è®¤åŠ¨ä½œå’Œå¯å–æ¶ˆäº‹ä»¶" class="headerlink" title="é»˜è®¤åŠ¨ä½œå’Œå¯å–æ¶ˆäº‹ä»¶"></a>é»˜è®¤åŠ¨ä½œå’Œå¯å–æ¶ˆäº‹ä»¶</h3><p>äº‹ä»¶é€šå¸¸ç”±å®ç°ä½œä¸ºç”¨æˆ·æ“ä½œçš„ç»“æœè¿›è¡Œåˆ†æ´¾ï¼Œæ¯”å¦‚ä¸ºäº†å“åº”ä»»åŠ¡çš„å®Œæˆï¼Œæˆ–è€…åœ¨å¼‚æ­¥æ´»åŠ¨æœŸé—´å‘é€è¿›ç¨‹ä¿¡å·ï¼ˆä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ä¸€äº›äº‹ä»¶æ¥æ§åˆ¶å®ç°æ¥ä¸‹æ¥å¯èƒ½é‡‡å–çš„è¡Œä¸º(æˆ–æ’¤æ¶ˆå®ç°å·²ç»é‡‡å–çš„åŠ¨ä½œ)ã€‚è¿™ä¸ªç±»åˆ«ä¸­çš„äº‹ä»¶ç§°ä¸ºå¯å–æ¶ˆçš„ï¼ˆcancelableï¼‰ï¼Œå®ƒä»¬å–æ¶ˆçš„è¡Œä¸ºç§°ä¸ºé»˜è®¤è¡Œä¸ºï¼ˆdefault actionï¼‰ã€‚å¯å–æ¶ˆäº‹ä»¶å¯¹è±¡å¯ä»¥ä¸ä¸€ä¸ªæˆ–å¤šä¸ªâ€œé»˜è®¤åŠ¨ä½œâ€ç›¸å…³è”ã€‚è¦å–æ¶ˆäº‹ä»¶ï¼Œè¯·è°ƒç”¨ preventDefault() æ–¹æ³•ã€‚</p>
<blockquote>
<p>ä¾‹å­1ï¼šå½“ç”¨æˆ·æŒ‰ä¸‹æŒ‡å‘è®¾å¤‡(é€šå¸¸æ˜¯é¼ æ ‡)ä¸Šçš„æŒ‰é’®åï¼Œç«‹å³ä¼šå‘å‡ºmousedownäº‹ä»¶ã€‚å®ç°å¯èƒ½é‡‡å–çš„ä¸€ä¸ªé»˜è®¤æ“ä½œæ˜¯è®¾ç½®ä¸€ä¸ªçŠ¶æ€æœºï¼Œå…è®¸ç”¨æˆ·æ‹–åŠ¨å›¾åƒæˆ–é€‰æ‹©æ–‡æœ¬ã€‚é»˜è®¤æ“ä½œå–å†³äºæ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆâ€”â€”ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·çš„æŒ‡å‘è®¾å¤‡ä½äºæ–‡æœ¬ä¹‹ä¸Šï¼Œå¯èƒ½ä¼šå¼€å§‹æ–‡æœ¬é€‰æ‹©ã€‚å¦‚æœç”¨æˆ·çš„æŒ‡å‘è®¾å¤‡ä½äºå›¾åƒä¸Šæ–¹ï¼Œåˆ™å¯ä»¥å¼€å§‹å›¾åƒæ‹–åŠ¨æ“ä½œã€‚é˜²æ­¢mousedownäº‹ä»¶çš„é»˜è®¤æ“ä½œå°†é˜»æ­¢è¿™äº›æ“ä½œçš„å‘ç”Ÿã€‚</p>
</blockquote>
<p>é»˜è®¤æ“ä½œé€šå¸¸åœ¨äº‹ä»¶åˆ†æ´¾å®Œæˆä¹‹åæ‰§è¡Œï¼Œä½†åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥åœ¨äº‹ä»¶åˆ†æ´¾ä¹‹å‰ç«‹å³æ‰§è¡Œã€‚</p>
<p>æ€»ç»“ï¼šæ„Ÿè§‰å…‰çœ‹æ˜¯ä¸è¡Œçš„ï¼Œè¿˜æ˜¯è¦å¤šå®è·µï¼Œæ‰èƒ½æ˜ç™½ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/23/promise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é›¯å­">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Athena">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/23/promise/" itemprop="url">
                  [è¯‘]Promise-basics
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-05-23 16:33:58" itemprop="dateCreated datePublished" datetime="2018-05-23T16:33:58+08:00">2018-05-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2018-11-06 12:05:45" itemprop="dateModified" datetime="2018-11-06T12:05:45+08:00">2018-11-06</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åŸæ–‡ï¼š<a href="https://javascript.info/promise-basics" target="_blank" rel="noopener">Promise</a></p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ˜¯ä¸€ä¸ªé¡¶çº§æ­Œæ‰‹ï¼Œä½ çš„ç²‰ä¸ä»¬æˆå¤©ç®¡è¦ä½ çš„ä¸‹ä¸€å¼ ä¸“è¾‘ã€‚<br>ä¸ºäº†å¾—åˆ°è§£è„±ï¼Œä½ å‘ä»–ä»¬æ‰¿è¯ºï¼Œä¸€æ—¦ä¸“è¾‘å‘è¡Œäº†å°±ä¼šç«‹å³å¯„ç»™ä»–ä»¬ã€‚ä½ ç»™ç²‰ä¸ä»¬ä¸€å¼ è¡¨è®©ä»–ä»¬å¡«å†™åœ°å€ï¼Œè¿™æ ·ä¸€æ¥ä¸€æ—¦æ­Œæ›²å‘è¡Œäº†ï¼Œæ‰€æœ‰é¢„å®šçš„äººéƒ½èƒ½é©¬ä¸Šæ‹¿åˆ°ã€‚å¦‚æœå‘ç”Ÿäº†ä»€ä¹ˆæ„å¤–ï¼Œæ¯”å¦‚æ­Œæ›²å†ä¹Ÿä¸ä¼šå‘è¡Œäº†ï¼Œä»–ä»¬ä¹Ÿä¼šæ”¶åˆ°é€šçŸ¥ã€‚</p>
<p>è¿™æ ·å°±çš†å¤§æ¬¢å–œäº†ï¼Œå†ä¹Ÿä¸ä¼šæœ‰äººæ¥çƒ¦ä½ äº†ï¼Œç²‰ä¸ä»¬ä¹Ÿä¸ä¼šé”™è¿‡ä½ çš„ä¸“è¾‘å•æ›²ã€‚</p>
<p>ä»¥ä¸Šæ˜¯ä¸€ä¸ªçœŸå®ä¸–ç•Œçš„ç±»æ¯”ï¼Œæˆ‘ä»¬åœ¨ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ç»å¸¸ä¼šé‡åˆ°ç±»ä¼¼çš„æƒ…æ™¯ï¼š</p>
<ol>
<li>â€œç”Ÿäº§ä»£ç â€ä¼šåšä¸€äº›äº‹æƒ…ï¼Œä¼šéœ€è¦ä¸€äº›æ—¶é—´ã€‚ä¾‹å¦‚ï¼ŒåŠ è½½å¼‚æ­¥è„šæœ¬ã€‚è¿™å°±ç›¸å½“äºé‚£ä¸ªâ€œæ­Œæ‰‹â€ã€‚</li>
<li>â€œæ¶ˆè´¹ä»£ç â€åˆ™æ˜¯ç­‰å‡†å¤‡å¥½äº†ä¹‹åè·å–ç»“æœã€‚å¾ˆå¤šå‡½æ•°éƒ½å¯èƒ½éœ€è¦è¿™ä¸ªç»“æœã€‚è¿™å°±ç›¸å½“äºé‚£äº›â€œç²‰ä¸â€ã€‚</li>
<li><em>promise</em> å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„JavaScriptå¯¹è±¡ï¼Œå®ƒæŠŠå®ƒä»¬è¿æ¥èµ·æ¥ã€‚è¿™å°±ç›¸å½“äºé‚£ä¸ªâ€œåˆ—è¡¨â€ã€‚ç”Ÿäº§ä»£ç åšå‡ºæ¥ä¹‹åå‘ç»™æ¯ä¸ªäººï¼Œè¿™æ ·ä»–ä»¬å°±éƒ½èƒ½è®¢é˜…è¿™ä¸ªç»“æœäº†ã€‚</li>
</ol>
<p>è™½ç„¶è¿™ä¸ªç±»æ¯”å¹¶ä¸æ˜¯éå¸¸çš„å‡†ç¡®ï¼Œå› ä¸ºJavaScript promiseæ¯”ä¸€ä¸ªç®€å•çš„åˆ—è¡¨å¤æ‚å¾—å¤šï¼Œå®ƒä»¬æœ‰é¢å¤–çš„ç‰¹æ€§å’Œé™åˆ¶ï¼Œä½†æ˜¯è¿™ä¸ªæ¯”å–»è¿˜æ˜¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£çš„ã€‚</p>
<p>ä¸€ä¸ªpromiseå¯¹è±¡çš„æ„å»ºè¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ‰§è¡Œè€… (ç”Ÿäº§ä»£ç , "æ­Œæ‰‹")</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä¼ ç»™<code>new Promise</code>çš„å‡½æ•°å«åš<em>æ‰§è¡Œè€…</em>ã€‚å½“promiseè¢«åˆ›å»ºä¹‹åï¼Œ<em>æ‰§è¡Œè€…</em>å°±è¢«ç«‹å³è°ƒç”¨ã€‚å®ƒåŒ…æ‹¬äº†ç”Ÿäº§ä»£ç ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆè¦é€šè¿‡å¾—åˆ°ä¸€ä¸ªç»“æœæ¥ç»“æŸã€‚åŸºäºä¸Šé¢çš„ç±»æ¯”ï¼Œè¿™ä¸ªæ‰§è¡Œè€…å°±æ˜¯ä¸€ä¸ªâ€œæ­Œæ‰‹â€ã€‚</p>
<p>ç”Ÿæˆçš„<code>promise</code>å¯¹è±¡æœ‰å†…éƒ¨å±æ€§ï¼š</p>
<ul>
<li><code>state</code> â€“ åˆå§‹å€¼æ˜¯â€œpendingâ€ï¼Œä¹‹åä¼šå˜æˆâ€œfulfilledâ€æˆ–è€…â€œrejectedâ€</li>
<li><code>result</code> â€“ ä»»æ„å€¼ï¼Œåˆå§‹å€¼æ˜¯<code>undefined</code></li>
</ul>
<p>å½“æ‰§è¡Œè€…ç»“æŸè¿™ä¸ªä»»åŠ¡åï¼Œå°±ä¼šè°ƒç”¨ä¸‹é¢ä¸¤ä¸ªå‡½æ•°çš„ä¸€ä¸ªï¼š</p>
<ul>
<li><code>resolve(value)</code> â€“ è¡¨æ˜ä»»åŠ¡æˆåŠŸç»“æŸ:<ul>
<li>å°† <code>state</code> ç½®æˆ <code>&quot;fulfilled&quot;</code>,</li>
<li>å°† <code>result</code> ç½®æˆ <code>value</code>.</li>
</ul>
</li>
<li><p><code>reject(error)</code> â€“ è¡¨æ˜å‘ç”Ÿäº†é”™è¯¯:</p>
<ul>
<li>å°† <code>state</code> ç½®æˆ <code>&quot;rejected&quot;</code>,</li>
<li>å°† <code>result</code> ç½®æˆ <code>error</code>.</li>
</ul>
<p><img src="http://ph762tedc.bkt.clouddn.com/FsOFGBP9V6xCF82MB9nEza1OQY4y" alt=""></p>
</li>
</ul>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ‰§è¡Œè€…çš„ä¾‹å­ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å½“promiseè¢«æ„é€ çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°å°±è¢«ç«‹å³æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">  alert(resolve); <span class="comment">// function () &#123; [native code] &#125;</span></span><br><span class="line">  alert(reject);  <span class="comment">// function () &#123; [native code] &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1ç§’ä¹‹åè¿™ä¸ªä»»åŠ¡å®Œæˆï¼Œè¾“å‡ºç»“æœ"done!"</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(<span class="string">"done!"</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºä¸¤ä»¶äº‹æƒ…ï¼š</p>
<ol>
<li>è¿™ä¸ªæ‰§è¡Œè€…è¢«ç«‹å³è‡ªåŠ¨è°ƒç”¨äº†ï¼ˆé€šè¿‡ <code>new Promise</code>ï¼‰</li>
<li>æ‰§è¡Œè€…æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š<code>resolve</code> å’Œ <code>reject</code> â€“ è¿™äº›å‡½æ•°æ¥è‡ªJavaScriptå¼•æ“ã€‚æˆ‘ä»¬ä¸éœ€è¦å»åˆ›å»ºå®ƒä»¬ã€‚è€Œä¸”è¯¥ç”±æ‰§è¡Œè€…æ¥è°ƒç”¨å®ƒä»¬ã€‚</li>
</ol>
<p>1ç§’ä¹‹åï¼Œæ‰§è¡Œè€…è°ƒç”¨<code>resolve(&quot;done&quot;)</code>ç”Ÿæˆç»“æœï¼š</p>
<p><img src="http://ph762tedc.bkt.clouddn.com/Fkb1mvFfrG40vbZtFzZynEHdD0dP" alt=""></p>
<p>è¿™æ˜¯ä»»åŠ¡æˆåŠŸå®Œæˆçš„ä¸€ä¸ªä¾‹å­ã€‚</p>
<p>ç°åœ¨å†çœ‹ä¸€ä¸ªæ‰§è¡Œè€…æŠ›å‡ºå¼‚å¸¸çš„ä¾‹å­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 1ç§’ä¹‹åä»»åŠ¡ç»“æŸï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Whoops!"</span>)), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="http://ph762tedc.bkt.clouddn.com/FsOFGBP9V6xCF82MB9nEza1OQY4y" alt=""></p>
<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œæ‰§è¡Œè€…ä¼šæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼ˆé€šå¸¸æ˜¯éœ€è¦èŠ±è´¹ä¸€å®šæ—¶é—´çš„ï¼‰ï¼Œç„¶åè°ƒç”¨ <code>resolve</code> æˆ–è€… <code>reject</code>æ¥æ”¹å˜ç›¸åº”çš„promiseå¯¹è±¡çš„çŠ¶æ€ã€‚</p>
<p>ä¸ç®¡æ˜¯<code>resolve</code> è¿˜æ˜¯ <code>reject</code>éƒ½ä¼šè¢«å«åš â€œsettledâ€ï¼Œä¸ â€œpendingâ€ç›¸å¯¹åº”ã€‚</p>
<h4 id="åªèƒ½æœ‰ä¸€ä¸ªç»“æœæˆ–è€…å¼‚å¸¸"><a href="#åªèƒ½æœ‰ä¸€ä¸ªç»“æœæˆ–è€…å¼‚å¸¸" class="headerlink" title="åªèƒ½æœ‰ä¸€ä¸ªç»“æœæˆ–è€…å¼‚å¸¸"></a>åªèƒ½æœ‰ä¸€ä¸ªç»“æœæˆ–è€…å¼‚å¸¸</h4><p>æ‰§è¡Œè€…åªèƒ½è°ƒç”¨ä¸€ä¸ª<code>resolve</code> æˆ–è€… <code>reject</code>ã€‚promiseçš„çŠ¶æ€æ”¹å˜å°±æ˜¯æœ€ç»ˆå½¢æ€ã€‚<br>åé¢çš„ä»»ä½•è°ƒç”¨éƒ½æ˜¯æ— æ•ˆçš„ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  resolve(<span class="string">"done"</span>);</span><br><span class="line"></span><br><span class="line">  reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"â€¦"</span>)); <span class="comment">// æ— æ•ˆ</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(<span class="string">"â€¦"</span>)); <span class="comment">// æ— æ•ˆ</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è‡³äºä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆåªèƒ½æœ‰ä¸€ä¸ªç»“æœæˆ–è€…å¼‚å¸¸è¿™ä¸ªäº‹æƒ…æ¥è¯´ï¼Œåœ¨ç¼–ç¨‹é¢†åŸŸï¼Œè¿˜å­˜åœ¨å…¶å®ƒæ•°æ®ç»“æ„å…è®¸å¾ˆå¤šâ€œæµâ€ç»“æœï¼Œä¾‹å¦‚æ•°æ®æµï¼ˆstreamsï¼‰å’Œé˜Ÿåˆ—ï¼ˆqueuesï¼‰ã€‚ç›¸å¯¹äºpromiseï¼Œå®ƒä»¬ä¹Ÿæ˜¯å„æœ‰åˆ©å¼Šã€‚Javascriptæ ¸å¿ƒä¸æ”¯æŒå®ƒä»¬ï¼Œè€Œä¸”ç¼ºå°‘ä¸€äº›åªæœ‰promiseèƒ½æä¾›çš„è¯­è¨€ç‰¹æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸åšè¿‡å¤šçš„æ¶‰åŠã€‚</p>
<p>è¿˜æœ‰å°±æ˜¯å¦‚æœæˆ‘ä»¬è°ƒç”¨<code>resolve/reject</code>æ—¶ä¼ å…¥äº†å¤šä¸ªå‚æ•°ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªå‚æ•°æœ‰ç”¨ï¼Œåé¢çš„éƒ½ä¼šè¢«å¿½ç•¥çš„ã€‚</p>
<h4 id="Reject-ä½¿ç”¨-Error-å¯¹è±¡"><a href="#Reject-ä½¿ç”¨-Error-å¯¹è±¡" class="headerlink" title="Reject ä½¿ç”¨ Error å¯¹è±¡"></a>Reject ä½¿ç”¨ <code>Error</code> å¯¹è±¡</h4><p>é€šå¸¸æ¥è¯´æˆ‘ä»¬å¯ä»¥åƒè°ƒç”¨<code>resolve</code>ä¸€æ ·ä¼ å…¥ä»»ä½•å‚æ•°æ¥è°ƒç”¨<code>reject</code>ã€‚ä½†è¿˜æ˜¯æ¨èä½¿ç”¨<code>Error</code> å¯¹è±¡ã€‚åŸå› çš„è¯åé¢ä¼šæã€‚</p>
<h4 id="Resolve-reject-å¯ä»¥æ˜¯ç«‹å³æ‰§è¡Œçš„"><a href="#Resolve-reject-å¯ä»¥æ˜¯ç«‹å³æ‰§è¡Œçš„" class="headerlink" title="Resolve/reject å¯ä»¥æ˜¯ç«‹å³æ‰§è¡Œçš„"></a>Resolve/reject å¯ä»¥æ˜¯ç«‹å³æ‰§è¡Œçš„</h4><p>åœ¨ç»ƒä¹ ä¸­ï¼Œæ‰§è¡Œè€…é€šå¸¸æ˜¯åšä¸€äº›å¼‚æ­¥æ“ä½œï¼Œåœ¨ä¸€æ®µæ—¶é—´ä¹‹åæ‰è°ƒç”¨<code>resolve/reject</code>ï¼Œä½†å…¶å®å¹¶ä¸ä¸€å®šæ˜¯è¿™æ ·ã€‚æˆ‘ä»¬å¯ä»¥ç«‹å³è°ƒç”¨<code>resolve</code> or <code>reject</code>å‡½æ•°ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  resolve(<span class="number">123</span>); <span class="comment">// ç«‹å³ç»™å‡ºç»“æœï¼š123</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ï¼Œå½“æˆ‘ä»¬å¼€å§‹è¦æ‰§è¡Œä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œæ¥çœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯å¤šæœ‰çš„äº‹æƒ…éƒ½å‡†å¤‡å¥½äº†ã€‚ç„¶åå¾—åˆ°ä¸€ä¸ªresolvedpromiseè¡¨ç¤ºå¯ä»¥åšä¸‹é¢çš„äº‹æƒ…äº†ã€‚</p>
<h3 id="state-å’Œ-result-æ˜¯å†…éƒ¨å˜é‡"><a href="#state-å’Œ-result-æ˜¯å†…éƒ¨å˜é‡" class="headerlink" title="state å’Œ result æ˜¯å†…éƒ¨å˜é‡"></a><code>state</code> å’Œ <code>result</code> æ˜¯å†…éƒ¨å˜é‡</h3><p><code>state</code> å’Œ <code>result</code>å±æ€§æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡çš„å†…éƒ¨å˜é‡ã€‚æˆ‘ä»¬ä¸èƒ½åœ¨ä»£ç ä¸­ç›´æ¥è®¿é—®å®ƒä»¬ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨<code>.then/catch</code>æ–¹æ³•ï¼Œä¸‹é¢ä¼šè¯´ã€‚</p>
<h2 id="æ¶ˆè´¹è€…-â€œ-thenâ€-å’Œ-â€œ-catchâ€"><a href="#æ¶ˆè´¹è€…-â€œ-thenâ€-å’Œ-â€œ-catchâ€" class="headerlink" title="æ¶ˆè´¹è€…: â€œ.thenâ€ å’Œ â€œ.catchâ€"></a>æ¶ˆè´¹è€…: â€œ.thenâ€ å’Œ â€œ.catchâ€</h2><p>promiseå¯¹è±¡ä½œä¸ºç”Ÿäº§ä»£ç ï¼ˆæ‰§è¡Œè€…ï¼‰å’Œæ¶ˆè´¹å‡½æ•°ï¼ˆé‚£äº›æƒ³è¦æ¥æ”¶ç»“æœæˆ–è€…é”™è¯¯çš„å‡½æ•°ï¼‰ä¹‹é—´çš„è¿æ¥æ¡¥æ¢ï¼Œæ¶ˆè´¹å‡½æ•°å¯ä»¥ä½¿ç”¨æ–¹æ³•<code>promise.then</code> and <code>promise.catch</code>æ¥æ³¨å†Œã€‚</p>
<p><code>.then</code>çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">promise.then(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123; <span class="comment">/* å¤„ç†æˆåŠŸçš„ result */</span> &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123; <span class="comment">/* å¤„ç† error */</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>å¦‚æœpromiseæ‰§è¡ŒæˆåŠŸï¼Œå¾—åˆ°resultï¼Œå°±ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°ï¼Œå¦‚æœpromiseè¿”å›é”™è¯¯å°±ä¼šæ‰§è¡Œç¬¬äºŒä¸ªå‚æ•°å‡½æ•°</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(<span class="string">"done!"</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// resolve runs the first function in .then</span></span><br><span class="line">promise.then(</span><br><span class="line">  result =&gt; alert(result), <span class="comment">// 1ç§’ä¹‹åæ˜¾ç¤º "done!"</span></span><br><span class="line">  error =&gt; alert(error) <span class="comment">// ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>rejectçš„ä¾‹å­:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Whoops!"</span>)), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// reject runs the second function in .then</span></span><br><span class="line">promise.then(</span><br><span class="line">  result =&gt; alert(result), <span class="comment">// ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line">  error =&gt; alert(error) <span class="comment">// 1ç§’ä¹‹åæ˜¾ç¤º "done!" "Error: Whoops!"</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬åªéœ€è¦æˆåŠŸçš„æƒ…å†µï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥åªæä¾›ä¸€ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(<span class="string">"done!"</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(alert); <span class="comment">// 1ç§’ä¹‹åæ˜¾ç¤º "done!"</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœåªå¯¹errorsæ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>.then(null, function)</code>æˆ–è€…<code>.catch(function)</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Whoops!"</span>)), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// .catch(f) ä¸ promise.then(null, f)æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">promise.catch(alert); <span class="comment">// 1ç§’ä¹‹åæ˜¾ç¤º "done!" "Error: Whoops!"</span></span><br></pre></td></tr></table></figure>
<p><code>.catch(f)</code> ä¸ <code>.then(null, f)</code>æ˜¯å®Œå…¨ç­‰åŒçš„ã€‚</p>
<h3 id="settledçš„-promiseä¼šç«‹å³æ‰§è¡Œ-then"><a href="#settledçš„-promiseä¼šç«‹å³æ‰§è¡Œ-then" class="headerlink" title="settledçš„ promiseä¼šç«‹å³æ‰§è¡Œ then"></a>settledçš„ promiseä¼šç«‹å³æ‰§è¡Œ <code>then</code></h3><p>å¦‚æœä¸€ä¸ªpromiseåœ¨pendingï¼Œ<code>.then/catch</code>å¤„ç†å™¨ä¼šç­‰å¾…resultã€‚å¦å¤–ï¼Œå¦‚æœä¸€ä¸ªpromiseçŠ¶æ€å·²ç»æ˜¯settledï¼Œ å®ƒä»¬ä¼šç«‹å³æ‰§è¡Œã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€ä¸ªç«‹å³ resolved çš„ promise</span></span><br><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> resolve(<span class="string">"done!"</span>));</span><br><span class="line"></span><br><span class="line">promise.then(alert); <span class="comment">// done! (ç«‹å³æ˜¾ç¤ºå‡ºæ¥)</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºé‚£äº›æœ‰æ—¶éœ€è¦æ—¶é—´ï¼Œæœ‰æ—¶ç«‹å³å®Œæˆçš„ä»»åŠ¡ï¼Œè¿™æ ·å¤„ç†æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¿è¯ä¸¤ç§æƒ…å†µéƒ½èƒ½æ­£å¸¸è¿è¡Œã€‚</p>
<h3 id="then-catchçš„å¤„ç†å™¨æ°¸è¿œæ˜¯å¼‚æ­¥çš„"><a href="#then-catchçš„å¤„ç†å™¨æ°¸è¿œæ˜¯å¼‚æ­¥çš„" class="headerlink" title=".then/catchçš„å¤„ç†å™¨æ°¸è¿œæ˜¯å¼‚æ­¥çš„"></a><code>.then/catch</code>çš„å¤„ç†å™¨æ°¸è¿œæ˜¯å¼‚æ­¥çš„</h3><p>æ›´ä¸¥æ ¼æ¥è¯´ï¼Œå½“<code>.then/catch</code>å¤„ç†å™¨è¦æ‰§è¡Œçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåŠ å…¥ä¸€ä¸ªå†…éƒ¨åºåˆ—ã€‚å½“å½“å‰çš„ä»£ç æ‰§è¡Œå®Œæ¯•ä¹‹åï¼ŒJavaScriptå¼•æ“ä»åºåˆ—ä¸­å–å‡ºè¿™äº›å¤„ç†å™¨å¹¶æ‰§è¡Œï¼Œå’Œ<code>setTimeout(..., 0)</code>ç±»ä¼¼ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œå½“<code>.then(handler)</code>å°†è¦è§¦å‘çš„æ—¶å€™ï¼Œå®ƒçš„è¡Œä¸ºç±»ä¼¼äº<code>setTimeout(handler, 0)</code></p>
<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œpromiseç«‹å³resolvedï¼Œæ‰€ä»¥<code>.then(alert)</code>ä¹Ÿä¼šé©¬ä¸Šè§¦å‘ï¼š<code>alert</code>å›è°ƒåŠ å…¥åºåˆ—ï¼Œç„¶åç­‰åˆ°ä»£ç æ‰§è¡Œç»“æŸåï¼Œç«‹å³æ‰§è¡Œã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€ä¸ªç«‹å³resolvedçš„promise</span></span><br><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> resolve(<span class="string">"done!"</span>));</span><br><span class="line"></span><br><span class="line">promise.then(alert); <span class="comment">// done! (åœ¨å½“å‰ä»£ç è¿è¡Œç»“æŸä¹‹å)</span></span><br><span class="line"></span><br><span class="line">alert(<span class="string">"code finished"</span>); <span class="comment">// è¿™ä¸ªalertä¼šå…ˆæ˜¾ç¤ºå‡ºæ¥</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥åœ¨<code>.then</code>åé¢çš„ä»£ç é€šå¸¸æ˜¯å…ˆäºthenæ‰§è¡Œçš„ï¼Œå³ä½¿æ˜¯åœ¨ç«‹å³resolveçš„promiseæƒ…å†µä¸‹ã€‚é€šå¸¸è¿™ä¸æ˜¯å¾ˆé‡è¦ï¼Œåªæœ‰ä¸€äº›æƒ…å†µå¯èƒ½ä¼šæœ‰ç”¨ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€äº›æ›´å¤šçš„ä¾‹å­ï¼Œpromiseå¦‚ä½•å¸®åŠ©æˆ‘ä»¬ç¼–å†™å¼‚æ­¥ä»£ç </p>
<h2 id="ä¾‹å­-loadScript"><a href="#ä¾‹å­-loadScript" class="headerlink" title="ä¾‹å­: loadScript"></a>ä¾‹å­: loadScript</h2><p>æ¯”å¦‚ä¸‹é¢çš„<code>loadScript</code>å‡½æ•°ï¼Œç”¨çš„æ˜¯callbackå›è°ƒå‡½æ•°çš„å†™æ³•ï¼Œç”¨æ¥åŠ è½½ä¸€ä¸ªè„šæœ¬ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadScript</span>(<span class="params">src, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">  script.src = src;</span><br><span class="line"></span><br><span class="line">  script.onload = <span class="function"><span class="params">()</span> =&gt;</span> callback(<span class="literal">null</span>, script);</span><br><span class="line">  script.onerror = <span class="function"><span class="params">()</span> =&gt;</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Script load error `</span> + src));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">document</span>.head.append(script);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬ç”¨promiseé‡å†™ä¸€ä¸‹</p>
<p><code>loadScript</code>æ–°æ–¹æ³•ä¸éœ€è¦å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°äº†ã€‚å½“åŠ è½½æ–‡ä»¶å®Œæˆåï¼Œä¼šåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ã€‚å¤–é¢çš„ä»£ç å¯ä»¥ç”¨<code>.then</code>æ¥æ·»åŠ åç»­å¤„ç†çš„æ–¹æ³•ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadScript</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    script.src = src;</span><br><span class="line"></span><br><span class="line">    script.onload = <span class="function"><span class="params">()</span> =&gt;</span> resolve(script);</span><br><span class="line">    script.onerror = <span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Script load error: "</span> + src));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">document</span>.head.append(script);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = loadScript(<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.2.0/lodash.js"</span>);</span><br><span class="line"></span><br><span class="line">promise.then(</span><br><span class="line">  script =&gt; alert(<span class="string">`<span class="subst">$&#123;script.src&#125;</span> is loaded!`</span>),</span><br><span class="line">  error =&gt; alert(<span class="string">`Error: <span class="subst">$&#123;error.message&#125;</span>`</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">script</span> =&gt;</span> alert(<span class="string">'One more handler to do something else!'</span>));</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸è¿™ç§åŸºäºå›è°ƒå‡½æ•°è¯­æ³•çš„å¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³æ‰¾å‡ºä¸€äº›ä¼˜ç‚¹ï¼š</p>
<p>callbackï¼š</p>
<ul>
<li>æˆ‘ä»¬å¿…é¡»æå‰å‡†å¤‡å¥½<code>callback</code>å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¿…é¡»åœ¨<code>loadScript</code>è°ƒç”¨ä¹‹å‰å°±è¦å¤„ç†ç»“æœã€‚</li>
<li>åªèƒ½æœ‰ä¸€ä¸ªcallbackã€‚</li>
</ul>
<p>Promiseï¼š</p>
<ul>
<li>Promiseå¯ä»¥è®©æˆ‘ä»¬ç”¨ä¸€ç§éå¸¸è‡ªç„¶çš„é¡ºåºæ¥ç¼–å†™ä»£ç ã€‚é¦–å…ˆæˆ‘ä»¬è¿è¡Œ<code>loadScript</code>ï¼Œ ç„¶åå†ç»§ç»­å†™å¤„ç†ç»“æœçš„é€»è¾‘ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥äº‹åå¤šæ¬¡è°ƒç”¨<code>.then</code></li>
</ul>
<p>æ‰€ä»¥promiseç»™æˆ‘ä»¬å¸¦æ¥äº†æ›´å¥½çš„ä»£ç æµå’Œçµæ´»æ€§ã€‚ä½†æ˜¯ä¸åªæ˜¯è¿™äº›ï¼Œæˆ‘ä»¬ä¸‹ç« å†ç»§ç»­ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="é›¯å­" />
            
              <p class="site-author-name" itemprop="name">é›¯å­</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">27</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/athena0304" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://segmentfault.com/u/oxw" target="_blank" title="segmentfault"><i class="fa fa-fw fa-globe"></i>segmentfault</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://juejin.im/user/582419f30ce4630058b08dc0" target="_blank" title="æ˜é‡‘"><i class="fa fa-fw fa-globe"></i>æ˜é‡‘</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright"> &copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">é›¯å­</span>

  

  
</div>




  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ â€“ <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Pisces</a> v6.4.2</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  










  





  

  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
